"use strict";(self["webpackChunkmappitweb"]=self["webpackChunkmappitweb"]||[]).push([[7756],{15934:function(e,t,i){i.d(t,{Z:function(){return N}});var s=i(61445),r=i(39264),a=i(30374),n=i(18105),o=i(58006),l=(i(15055),i(81653),i(94315),i(77623)),d=i(66224),h=i(84989),c=i(34150),u=i(92162);class p extends u.Z{constructor(){super(...arguments),this.flowStyle=null}get requiresDedicatedFBO(){return!1}doRender(e){super.doRender(e)}prepareRenderPasses(e){const t=e.registerRenderPass({name:"flow",brushes:[h.Z],target:()=>this.children,drawPhase:c.jx.MAP});return[...super.prepareRenderPasses(e),t]}}i(80388);var _=i(92698),g=i(93622),m=i(67752),y=i(8693),f=i(92454),x=i(49304);const v=g.Z.getLogger("esri.views.2d.engine.flow.FlowDisplayData");class S{constructor(e,t,i,s){this.state={name:"created"},this.flowStyle=e,this.extent=t,this.size=i,this.pixelRatio=s}async load(){const e=new AbortController;this.state={name:"loading",abortController:e};const t=await this.flowStyle.loadResources({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},e.signal);this.state={name:"loaded",resources:t}}prepareForRendering(e){if("loaded"!==this.state.name)return void v.error("Only loaded resources can be attached.");const t=this.state.resources;t.prepareForRendering(e),this.state={name:"attached",resources:t}}destroy(){if("loading"===this.state.name)return this.state.abortController.abort(),void(this.state={name:"detached"});"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})}update(e){return!!this.flowStyle.areResourcesCompatible(e.flowStyle)&&(!(!this.extent.equals(e.extent)||this.size[0]!==e.size[0]||this.size[1]!==e.size[1]||this.pixelRatio!==e.pixelRatio)&&(this.flowStyle=e.flowStyle,!0))}}var w=i(18037),b=i(57409),D=i(75393);class C extends D.s{constructor(){super(...arguments),this._displayData=null}get displayData(){return this._displayData}set displayData(e){this._displayData=e,this.requestRender()}clear(){(0,y.pC)(this._displayData)&&(this._displayData.destroy(),this._displayData=null,this.requestRender())}setTransform(e){const{displayData:t}=this;if((0,y.Wi)(t))return;const i=t.extent.xmin,s=t.extent.ymax,r=[0,0];e.toScreen(r,[i,s]);const a=(t.extent.xmax-t.extent.xmin)/t.size[0]/e.resolution,n=(0,m.Vl)(e.rotation),{dvs:o}=this.transforms;(0,w.l)(o,[-1,1,0]),(0,w.d)(o,o,[2/(e.size[0]*e.pixelRatio),-2/(e.size[1]*e.pixelRatio),1]),(0,w.c)(o,o,[r[0],r[1],0]),(0,w.r)(o,o,n),(0,w.d)(o,o,[a*e.pixelRatio,a*e.pixelRatio,1])}_createTransforms(){return{dvs:(0,b.c)()}}}var R=i(50157);const V=1.15,A=g.Z.getLogger("esri.views.2d.engine.flow.FlowStrategy");let O=class extends _.Z{constructor(e){super(e),this._flowDisplayObject=new C,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(e){const{flowStyle:t}=this.flowContainer;if((0,y.Wi)(t))return void this._clear();const{extent:i,rotation:s,resolution:r,pixelRatio:a}=e.state,n=T(i,s);n.expand(V);const o=[Math.round((n.xmax-n.xmin)/r),Math.round((n.ymax-n.ymin)/r)],l=new S(t,n,o,a);if((0,y.pC)(this._loading)){if(this._loading.update(l))return;this._loading.destroy(),this._loading=null}!(0,y.Wi)(this._flowDisplayObject.displayData)&&this._flowDisplayObject.displayData.update(l)||(l.load().then((()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null}),(e=>{(0,f.D_)(e)||(A.error("A resource failed to load.",e),this._loading=null)})),this._loading=l)}_clear(){this._flowDisplayObject.clear(),(0,y.pC)(this._loading)&&(this._loading.destroy(),this._loading=null)}};(0,s._)([(0,o.Cb)()],O.prototype,"_loading",void 0),(0,s._)([(0,o.Cb)()],O.prototype,"flowContainer",void 0),(0,s._)([(0,o.Cb)()],O.prototype,"updating",null),O=(0,s._)([(0,l.j)("esri.views.2d.engine.flow.FlowStrategy")],O);const F=O;function T(e,t){const i=new x.Z({x:(e.xmax+e.xmin)/2,y:(e.ymax+e.ymin)/2,spatialReference:e.spatialReference}),s=e.xmax-e.xmin,r=e.ymax-e.ymin,a=Math.abs(Math.cos((0,m.Vl)(t))),n=Math.abs(Math.sin((0,m.Vl)(t))),o=a*s+n*r,l=n*s+a*r,d=new R.Z({xmin:i.x-o/2,ymin:i.y-l/2,xmax:i.x+o/2,ymax:i.y+l/2,spatialReference:e.spatialReference});return d.centerAt(i),d}var z=i(15625),I=i(17923),P=i(50659),k=i(64816);const L=new Map;L.set("a_positionAndSide",0),L.set("a_timeInfo",1),L.set("a_extrude",2),L.set("a_speed",3);const M={geometry:[new k.G("a_positionAndSide",3,I.g.FLOAT,0,36),new k.G("a_timeInfo",3,I.g.FLOAT,12,36),new k.G("a_extrude",2,I.g.FLOAT,24,36),new k.G("a_speed",1,I.g.FLOAT,32,36)]};class W{constructor(e,t,i){this.values=i,this._vertexData=e,this._indexData=t}prepareForRendering(e){const t=z.f.createVertex(e,I.l1.STATIC_DRAW,this._vertexData),i=z.f.createIndex(e,I.l1.STATIC_DRAW,this._indexData),s=new P.U(e,L,M,{geometry:t},i);this.vertexBuffer=t,this.indexBuffer=i,this.vertexArray=s,this._vertexData=null,this._indexData=null}detach(){this.vertexArray.dispose(),this.vertexBuffer.dispose(),this.indexBuffer.dispose()}get locations(){return L}}var E=i(30524);function j(e){const t=K(e),i=q(t),s=2*i,r=Math.round((0,E.F2)(e.maxPathLength)/s)+1,a=i,n=10,o=B(e),l=U(e),{flowSpeed:d,trailLength:h,density:c}=e;return{lineRenderWidth:t,segmentLength:s,verticesPerLine:r,lineCollisionWidth:a,lineSpacing:n,lineColor:o,lineOpacity:l,lineSpeed:d,fadeDuration:h,density:c,smoothing:(0,E.F2)(e.smoothing),velocityScale:"flow-from"===e.flowRepresentation?1:-1,minWeightThreshold:.001,minSpeedThreshold:.001,maxTurnAngle:1,mergeLines:!0,interpolate:!0,profile:!1}}function q(e){return"constant"===e.kind?e.value[0]:e.values[e.values.length-1]}function Z(e){const t=e.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function K(e){if(!e.hasVisualVariables("size"))return{kind:"constant",value:[(0,E.F2)(e.trailWidth)]};const t=e.getVisualVariablesForType("size")[0],i=[],s=[];let r;if(t.stops){for(const e of t.stops)i.push(e.value),s.push(e.size);r=t.stops.length}else i.push(t.minDataValue,t.maxDataValue),s.push(t.minSize,t.maxSize),r=2;return{kind:"ramp",stops:i,values:s,count:r}}function B(e){if(!e.hasVisualVariables("color"))return{kind:"constant",value:Z(e.color)};const t=e.getVisualVariablesForType("color")[0],i=[],s=[];for(const r of t.stops)i.push(r.value),Array.prototype.push.apply(s,Z(r.color));return{kind:"ramp",stops:i,values:s,count:t.stops.length}}function U(e){if(!e.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const t=e.getVisualVariablesForType("opacity")[0],i=[],s=[];for(const r of t.stops)i.push(r.value),s.push(r.opacity);return{kind:"ramp",stops:i,values:s,count:t.stops.length}}class G{constructor(e,t,i,s){this._loadImagery=e,this._createStreamlinesMesh=t,this._timeExtent=s,this._rendererSettings=j(i)}get animated(){return this._rendererSettings.lineSpeed>0}get renderSettings(){return this._rendererSettings}areResourcesCompatible(e){let t=!0;return t=t&&e._loadImagery===this._loadImagery,t=t&&e._createStreamlinesMesh===this._createStreamlinesMesh,t=t&&e._rendererSettings.verticesPerLine===this._rendererSettings.verticesPerLine,t=t&&e._rendererSettings.segmentLength===this._rendererSettings.segmentLength,t=t&&e._rendererSettings.lineSpacing===this._rendererSettings.lineSpacing,t=t&&e._rendererSettings.density===this._rendererSettings.density,t=t&&e._rendererSettings.smoothing===this._rendererSettings.smoothing,t=t&&e._rendererSettings.velocityScale===this._rendererSettings.velocityScale,t=t&&e._rendererSettings.minWeightThreshold===this._rendererSettings.minWeightThreshold,t=t&&e._rendererSettings.minSpeedThreshold===this._rendererSettings.minSpeedThreshold,t=t&&e._rendererSettings.mergeLines===this._rendererSettings.mergeLines,t=t&&e._rendererSettings.velocityScale===this._rendererSettings.velocityScale,t=t&&e._rendererSettings.interpolate===this._rendererSettings.interpolate,t=t&&e._rendererSettings.lineColor.kind===this._rendererSettings.lineColor.kind,t=t&&e._rendererSettings.lineOpacity.kind===this._rendererSettings.lineOpacity.kind,t=t&&e._rendererSettings.lineRenderWidth.kind===this._rendererSettings.lineRenderWidth.kind,t&&this._rendererSettings.mergeLines&&(t=e._rendererSettings.lineCollisionWidth===this._rendererSettings.lineCollisionWidth),t&&e._timeExtent!==this._timeExtent&&(t=!(!(0,y.pC)(e._timeExtent)||!(0,y.pC)(this._timeExtent))&&e._timeExtent.equals(this._timeExtent)),t}async loadResources(e,t){const{extent:i,size:s}=e;(0,f.k_)(t);const r=await this._loadImagery(i,s[0],s[1],this._timeExtent,t),{vertexData:a,indexData:n}=await this._createStreamlinesMesh(this._rendererSettings,r,t);return new W(a,n,{lineColor:this._rendererSettings.lineColor,lineOpacity:this._rendererSettings.lineOpacity,lineRenderWidth:this._rendererSettings.lineRenderWidth})}}let Y=class extends a.r{constructor(){super(...arguments),this._loadImagery=(e,t,i,s,r)=>(0,d.KK)(this.layer,e,t,i,s,r),this._createStreamlinesMesh=(e,t,i)=>this.layer.createStreamlinesMesh({flowData:t,rendererSettings:e},{signal:i}),this.attached=!1,this.container=null,this.layer=null,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this._strategy||this._strategy.updating}attach(){const{layer:e}=this,t=()=>{this._loadImagery=(t,i,s,r,a)=>(0,d.KK)(e,t,i,s,r,a),this._updateVisualization()};"multidimensionalDefinition"in e?this.handles.add((0,n.YP)((()=>e.multidimensionalDefinition),t)):this.handles.add([(0,n.YP)((()=>e.mosaicRule),t),(0,n.YP)((()=>e.renderingRule),t),(0,n.YP)((()=>e.definitionExpression),t)]),this.container=new p,this._strategy=new F({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container.removeAllChildren(),this.container=null,this.handles.removeAll()}update(e){e.stationary?this._strategy.update(e):this.layerView.requestUpdate()}hitTest(e){return new r.Z({attributes:{},geometry:e.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){if("flow"!==this.layer.renderer.type)return;const e=new G(this._loadImagery,this._createStreamlinesMesh,this.layer.renderer,this.timeExtent);this.container.flowStyle=e,this.layerView.requestUpdate()}};(0,s._)([(0,o.Cb)()],Y.prototype,"_strategy",void 0),(0,s._)([(0,o.Cb)()],Y.prototype,"attached",void 0),(0,s._)([(0,o.Cb)()],Y.prototype,"container",void 0),(0,s._)([(0,o.Cb)()],Y.prototype,"layer",void 0),(0,s._)([(0,o.Cb)()],Y.prototype,"layerView",void 0),(0,s._)([(0,o.Cb)()],Y.prototype,"type",void 0),(0,s._)([(0,o.Cb)()],Y.prototype,"updating",null),(0,s._)([(0,o.Cb)()],Y.prototype,"timeExtent",void 0),Y=(0,s._)([(0,l.j)("esri.views.2d.engine.flow.FlowView2D")],Y);const N=Y},37501:function(e,t,i){i.d(t,{F:function(){return p}});i(48675),i(3462),i(81653);var s=i(8693),r=i(18037),a=i(57409),n=i(20282),o=i(45982),l=i(75393),d=i(1385),h=i(15625),c=i(17923),u=i(50659);class p extends l.s{constructor(e=null){super(),this._source=null,this._symbolizerParameters=null,this._vaoInvalidated=!0,this.coordScale=[1,1],this.height=null,this.stencilRef=0,this.resolution=null,this.pixelRatio=1,this.x=0,this.y=0,this.rotation=0,this.rawPixelData=null,this.width=null,this.source=e}destroy(){var e,t;(0,s.pC)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null)}get symbolizerParameters(){return this._symbolizerParameters}set symbolizerParameters(e){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(e)&&(this._symbolizerParameters=e,this.invalidateVAO())}get source(){return this._source}set source(e){this._source=e,this.invalidateVAO()}invalidateVAO(){var e,t;!this._vaoInvalidated&&(0,s.pC)(this.vaoData)&&(null==(e=this.vaoData.magdir)||e.vao.dispose(),null==(t=this.vaoData.scalar)||t.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())}updateVectorFieldVAO(e){if(this._vaoInvalidated){if(this._vaoInvalidated=!1,(0,s.pC)(this.source)&&!(0,s.pC)(this.vaoData)){const{style:t}=this.symbolizerParameters;switch(t){case"beaufort_ft":case"beaufort_km":case"beaufort_kn":case"beaufort_m":case"beaufort_mi":case"classified_arrow":case"ocean_current_kn":case"ocean_current_m":case"single_arrow":{const t=(0,o.wF)(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={magdir:i}}break;case"simple_scalar":{const t=(0,o.K)(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t);this.vaoData={scalar:i}}break;case"wind_speed":{const t=(0,o.wF)(this.source,this.symbolizerParameters),i=this._createVectorFieldVAO(e.context,t),s=(0,o.K)(this.source,this.symbolizerParameters),r=this._createVectorFieldVAO(e.context,s);this.vaoData={magdir:i,scalar:r}}}}this.ready(),this.requestRender()}}_createTransforms(){return{dvs:(0,a.c)()}}setTransform(e){const t=(0,r.b)(this.transforms.dvs),[i,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),a=this.resolution/this.pixelRatio/e.resolution,o=a*this.width,l=a*this.height,d=Math.PI*this.rotation/180;(0,r.c)(t,t,(0,n.f)(i,s)),(0,r.c)(t,t,(0,n.f)(o/2,l/2)),(0,r.r)(t,t,-d),(0,r.c)(t,t,(0,n.f)(-o/2,-l/2)),(0,r.j)(t,t,(0,n.f)(o,l)),(0,r.m)(this.transforms.dvs,e.displayViewMat3,t)}onAttach(){this.invalidateVAO()}onDetach(){this.invalidateVAO()}_createVectorFieldVAO(e,t){const{vertexData:i,indexData:s}=t,r=h.f.createVertex(e,c.l1.STATIC_DRAW,new Float32Array(i)),a=h.f.createIndex(e,c.l1.STATIC_DRAW,new Uint32Array(s)),n=(0,d.cM)("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:c.g.FLOAT,normalized:!1},{location:1,name:"a_offset",count:2,type:c.g.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:c.g.FLOAT,normalized:!1}]});return{vao:new u.U(e,n.attributes,n.bufferLayouts,{geometry:r},a),elementCount:s.length}}}},23319:function(e,t,i){i.d(t,{V:function(){return n},e:function(){return a}});i(26699);var s=i(8693),r=i(71062);async function a(e,t=e.popupTemplate){if(!(0,s.pC)(t))return[];const i=await t.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:a}=t,{objectIdField:n,typeIdField:o,globalIdField:l,relationships:d}=e;if(i.includes("*"))return["*"];const h=a?await(0,r.CH)(e):[],c=(0,r.Q0)(e.fieldsIndex,[...i,...h]);return o&&c.push(o),c&&n&&e.fieldsIndex.has(n)&&-1===c.indexOf(n)&&c.push(n),c&&l&&e.fieldsIndex.has(l)&&-1===c.indexOf(l)&&c.push(l),d&&d.forEach((t=>{const{keyField:i}=t;c&&i&&e.fieldsIndex.has(i)&&-1===c.indexOf(i)&&c.push(i)})),c}function n(e,t){return e.popupTemplate?e.popupTemplate:(0,s.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,s.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=7756.df7ef101.js.map