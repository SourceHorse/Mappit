"use strict";(self["webpackChunkmappitweb"]=self["webpackChunkmappitweb"]||[]).push([[4342],{18548:function(t,e,i){i.d(e,{Z:function(){return r}});var s=i(8693);class r{constructor(t){this.size=0,this._start=0,this.maxSize=t,this._buffer=new Array(t)}get entries(){return this._buffer}enqueue(t){if(this.size===this.maxSize){const e=this._buffer[this._start];return this._buffer[this._start]=t,this._start=(this._start+1)%this.maxSize,e}return this._buffer[(this._start+this.size++)%this.maxSize]=t,null}dequeue(){if(0===this.size)return null;const t=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,t}peek(){return 0===this.size?null:this._buffer[this._start]}find(t){if(0===this.size)return null;for(const e of this._buffer)if((0,s.pC)(e)&&t(e))return e;return null}clear(t){let e=this.dequeue();for(;(0,s.pC)(e);)t&&t(e),e=this.dequeue()}}},50740:function(t,e,i){i.d(e,{t:function(){return r}});var s=i(94848);async function r(t,e){const{data:i}=await(0,s["default"])(t,{responseType:"image",...e});return i}},66544:function(t,e,i){i.d(e,{Z:function(){return l}});i(48675),i(3462);var s=i(21),r=i(11633),n=i(6640),a=i(79913);const o=512;class l{constructor(t){this._resourceManager=t}dispose(){this._rasterizationCanvas=null}rasterizeJSONResource(t,e,i){if(this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),"simple-fill"===t.type||"esriSFS"===t.type){const[i,r,n]=s.fN.rasterizeSimpleFill(this._rasterizationCanvas,t.style,e);return{size:[r,n],image:new Uint32Array(i.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0}}if("simple-line"===t.type||"esriSLS"===t.type||"line"===t.type&&t.dashTemplate){let e,i;if("simple-line"===t.type||"esriSLS"===t.type)switch(e=(0,s.U1)(t.style,t.cap),t.cap){case"butt":i="Butt";break;case"square":i="Square";break;default:i="Round"}else e=t.dashTemplate,i=t.cim.capStyle;const[r,n,a]=s.fN.rasterizeSimpleLine(e,i);return{size:[n,a],image:new Uint32Array(r.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}let a,o,l;if("simple-marker"===t.type||"esriSMS"===t.type||"line-marker"===t.type?(a=s.B$.fromSimpleMarker(t),l=(0,n.Fp)(a)):t.cim&&"CIMHatchFill"===t.cim.type?(a=s.B$.fromCIMHatchFill(t.cim),o=new r.Z(a.frame.xmin,-a.frame.ymax,a.frame.xmax-a.frame.xmin,a.frame.ymax-a.frame.ymin)):t.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===t.cim.markerPlacement.type?(a=s.B$.fromCIMInsidePolygon(t.cim),o=new r.Z(a.frame.xmin,-a.frame.ymax,a.frame.xmax-a.frame.xmin,a.frame.ymax-a.frame.ymin)):(a=t.cim,l=(0,n.Fp)(a)),l&&!i){const[t,e,i]=(0,n.RL)(l);return t?{size:[e,i],image:new Uint32Array(t.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}:null}const[h,u,c,d,_]=s.B$.rasterize(this._rasterizationCanvas,a,o,this._resourceManager,!i);return h?{size:[u,c],image:new Uint32Array(h.buffer),sdf:!1,simplePattern:!1,anchorX:d,anchorY:_}:null}rasterizeImageResource(t,e,i,s){this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas")),this._rasterizationCanvas.width=t,this._rasterizationCanvas.height=e;const r=this._rasterizationCanvas.getContext("2d");i instanceof ImageData?r.putImageData(i,0,0):(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`),r.drawImage(i,0,0,t,e));const n=r.getImageData(0,0,t,e),l=new Uint8Array(n.data);if(s)for(const a of s)if(a&&a.oldColor&&4===a.oldColor.length&&a.newColor&&4===a.newColor.length){const[t,e,i,s]=a.oldColor,[r,n,o,h]=a.newColor;if(t===r&&e===n&&i===o&&s===h)continue;for(let a=0;a<l.length;a+=4)t===l[a]&&e===l[a+1]&&i===l[a+2]&&s===l[a+3]&&(l[a]=r,l[a+1]=n,l[a+2]=o,l[a+3]=h)}let h;for(let a=0;a<l.length;a+=4)h=l[a+3]/255,l[a]=l[a]*h,l[a+1]=l[a+1]*h,l[a+2]=l[a+2]*h;let u=l,c=t,d=e;const _=o;if(c>=_||d>=_){const i=c/d;i>1?(c=_,d=Math.round(_/i)):(d=_,c=Math.round(_*i)),u=new Uint8Array(4*c*d);const s=new Uint8ClampedArray(u.buffer);(0,a.TT)(l,t,e,s,c,d,!1)}return{size:[c,d],image:new Uint32Array(u.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}},41839:function(t,e,i){var s,r,n,a,o;i.d(e,{Fr:function(){return o},_K:function(){return a},al:function(){return r}}),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.FILL_VERTEX=1]="FILL_VERTEX",t[t.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",t[t.FILL_INDEX=3]="FILL_INDEX",t[t.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",t[t.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",t[t.OUTLINE_INDEX=6]="OUTLINE_INDEX",t[t.LINE_VERTEX=7]="LINE_VERTEX",t[t.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",t[t.LINE_INDEX=9]="LINE_INDEX",t[t.ICON_VERTEX=10]="ICON_VERTEX",t[t.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",t[t.ICON_INDEX=12]="ICON_INDEX",t[t.TEXT_VERTEX=13]="TEXT_VERTEX",t[t.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",t[t.TEXT_INDEX=15]="TEXT_INDEX",t[t.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",t[t.CIRCLE_INDEX=17]="CIRCLE_INDEX"}(s||(s={})),function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"}(r||(r={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.OPAQUE=1]="OPAQUE",t[t.TRANSLUCENT=2]="TRANSLUCENT",t[t.SYMBOLS=3]="SYMBOLS",t[t.HITTEST=4]="HITTEST"}(n||(n={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(a||(a={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(o||(o={}))},57914:function(t,e,i){i.d(e,{Z:function(){return n}});var s=i(34150),r=i(21486);class n extends r.Z{renderChildren(t){this.attributeView.bindTextures(t.context,!1),this.children.some((t=>t.hasData))&&(super.renderChildren(t),t.drawPhase===s.jx.MAP&&this._renderChildren(t),this.hasHighlight()&&t.drawPhase===s.jx.HIGHLIGHT&&this._renderHighlight(t),this._boundsRenderer&&this._boundsRenderer.doRender(t))}_renderHighlight(t){const{painter:e}=t,i=e.effects.highlight;i.bind(t),this._renderChildren(t,i.defines),i.draw(t),i.unbind()}}},34342:function(t,e,i){i.r(e),i.d(e,{GraphicContainer:function(){return Qs.Z},GraphicsView2D:function(){return $s.Z},LabelManager:function(){return Ks},MagnifierView2D:function(){return zr},MapViewNavigation:function(){return Or},Stage:function(){return us}});i(48675),i(3462);var s=i(22130),r=i(48674),n=i(81653),a=i(8693),o=i(3047),l=i(44234),h=i(73288),u=i(90675),c=i(27198),d=i(57409),_=i(47001),f=i(12686),p=i(96770),m=i(32988),g=i(34150),b=i(45929),v=i(41839);const E={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}};var T=i(19755);function w(t){let e=E;return t.split("/").forEach((t=>{e&&(e=e[t])})),e}const x=new T.B(w);function y(t){return x.resolveIncludes(t)}var R=i(38991);const F=t=>(0,R.K)({ID:t.id,PATTERN:t.pattern}),B={shaders:t=>({vertexShader:F(t)+y("background/background.vert"),fragmentShader:F(t)+y("background/background.frag")})},C=t=>(0,R.K)({ID:t.id}),A={shaders:t=>({vertexShader:C(t)+y("circle/circle.vert"),fragmentShader:C(t)+y("circle/circle.frag")})},S=t=>(0,R.K)({ID:t.id,PATTERN:t.pattern}),O={shaders:t=>({vertexShader:S(t)+y("fill/fill.vert"),fragmentShader:S(t)+y("fill/fill.frag")})},M=t=>(0,R.K)({ID:t.id}),I={shaders:t=>({vertexShader:M(t)+y("outline/outline.vert"),fragmentShader:M(t)+y("outline/outline.frag")})},P=t=>(0,R.K)({ID:t.id,SDF:t.sdf}),D={shaders:t=>({vertexShader:P(t)+y("icon/icon.vert"),fragmentShader:P(t)+y("icon/icon.frag")})},N=t=>(0,R.K)({ID:t.id,PATTERN:t.pattern,SDF:t.sdf}),U={shaders:t=>({vertexShader:N(t)+y("line/line.vert"),fragmentShader:N(t)+y("line/line.frag")})},L=t=>(0,R.K)({ID:t.id}),z={shaders:t=>({vertexShader:L(t)+y("text/text.vert"),fragmentShader:L(t)+y("text/text.frag")})};class G{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach((t=>t.dispose())),this._programByKey.clear()}getMaterialProgram(t,e,i){const s=e.key<<3|this._getMaterialOptionsValue(e.type,i);if(this._programByKey.has(s))return this._programByKey.get(s);const r=this._getProgramTemplate(e.type),{shaders:n}=r,{vertexShader:a,fragmentShader:o}=n(i),l=e.getShaderHeader(),h=e.getShaderMain(),u=a.replace("#pragma header",l).replace("#pragma main",h),c=t.programCache.acquire(u,o,e.getAttributeLocations());return this._programByKey.set(s,c),c}_getMaterialOptionsValue(t,e){switch(t){case v._K.BACKGROUND:{const t=e;return(t.pattern?1:0)<<1|(t.id?1:0)}case v._K.FILL:{const t=e;return(t.pattern?1:0)<<1|(t.id?1:0)}case v._K.OUTLINE:return e.id?1:0;case v._K.LINE:{const t=e;return(t.sdf?1:0)<<2|(t.pattern?1:0)<<1|(t.id?1:0)}case v._K.ICON:{const t=e;return(t.sdf?1:0)<<1|(t.id?1:0)}case v._K.CIRCLE:return e.id?1:0;case v._K.TEXT:return e.id?1:0;default:return 0}}_getProgramTemplate(t){switch(t){case v._K.BACKGROUND:return B;case v._K.CIRCLE:return A;case v._K.FILL:return O;case v._K.ICON:return D;case v._K.LINE:return U;case v._K.OUTLINE:return I;case v._K.TEXT:return z;default:return null}}}var k=i(68917),V=i(65421);const W={shaders:{vertexShader:(0,V.w)("bitBlit/bitBlit.vert"),fragmentShader:(0,V.w)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])};var X=i(15625),H=i(17923),q=i(78026),Z=i(50659);class Y{constructor(){this._initialized=!1}dispose(){this._program=(0,a.O3)(this._program),this._vertexArrayObject=(0,a.O3)(this._vertexArrayObject)}render(t,e,i,s){t&&(this._initialized||this._initialize(t),t.setBlendFunctionSeparate(H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA,H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA),t.bindVAO(this._vertexArrayObject),t.useProgram(this._program),e.setSamplingMode(i),t.bindTexture(e,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",s),t.drawArrays(H.MX.TRIANGLE_STRIP,0,4),t.bindTexture(null,0),t.bindVAO())}_initialize(t){if(this._initialized)return!0;const e=(0,q.H)(t,W);if(!e)return!1;const i=new Int8Array(16);i[0]=-1,i[1]=-1,i[2]=0,i[3]=0,i[4]=1,i[5]=-1,i[6]=1,i[7]=0,i[8]=-1,i[9]=1,i[10]=0,i[11]=1,i[12]=1,i[13]=1,i[14]=1,i[15]=1;const s=W.attributes,r=new Z.U(t,s,k.As,{geometry:X.f.createVertex(t,H.l1.STATIC_DRAW,i)});return this._program=e,this._vertexArrayObject=r,this._initialized=!0,!0}}i(21703);const j=t=>{let e="";e+=t[0].toUpperCase();for(let i=1;i<t.length;i++){const s=t[i];s===s.toUpperCase()?(e+="_",e+=s):e+=s.toUpperCase()}return e},K=t=>{const e={};for(const i in t)e[j(i)]=t[i];return(0,R.K)(e)},$=(t,e,i,s)=>{const r=t+t.substring(t.lastIndexOf("/")),n=e+e.substring(e.lastIndexOf("/"));return{attributes:i,shaders:{vertexShader:K(s)+(0,V.w)(`${r}.vert`),fragmentShader:K(s)+(0,V.w)(`${n}.frag`)}}},Q=t=>t===g.jx.HITTEST||t===g.jx.LABEL_ALPHA,J=t=>(Q(t)?1:0)|(t===g.jx.HIGHLIGHT?2:0),tt=({rendererInfo:t,drawPhase:e},i,s,r)=>`${i.getVariationHash()}-${r.join(".")}-${J(e)}-${t.getVariationHash()}-${(0,a.pC)(s)&&s.join(".")}`,et=(t,e,i,s)=>{const r=s.reduce(((e,i)=>({...e,[i]:t.context.driverTest[i]})),{}),n={...e.getVariation(),...t.rendererInfo.getVariation(),highlight:t.drawPhase===g.jx.HIGHLIGHT,id:Q(t.drawPhase),...r};if((0,a.pC)(i))for(const a of i)n[a]=!0;return n};class it{constructor(t){this._rctx=t,this._programByKey=new Map}dispose(){this._programByKey.forEach((t=>t.dispose())),this._programByKey.clear()}getProgram(t,e,i=[],s=[]){const r=e.vsPath+"."+e.fsPath+JSON.stringify(i)+s.join(".");if(this._programByKey.has(r))return this._programByKey.get(r);const n=s.reduce(((e,i)=>({...e,[i]:t.context.driverTest[i]})),{}),a={...i.map((t=>"string"==typeof t?{name:t,value:!0}:t)).reduce(((t,e)=>({...t,[e.name]:e.value})),{}),...n},{vsPath:o,fsPath:l,attributes:h}=e,u=$(o,l,h,a),c=this._rctx.programCache.acquire(u.shaders.vertexShader,u.shaders.fragmentShader,u.attributes);if(!c)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(r,c),c}getMaterialProgram(t,e,i,s,r,n=["ignoresSamplerPrecision"]){const a=tt(t,e,r,n);if(this._programByKey.has(a))return this._programByKey.get(a);const o=et(t,e,r,n),l=$(i,i,s,o),h=this._rctx.programCache.acquire(l.shaders.vertexShader,l.shaders.fragmentShader,l.attributes);if(!h)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(a,h),h}}i(26699),i(82801);var st=i(21383),rt=i(94848),nt=i(34658),at=i(93622),ot=i(92454),lt=i(30524),ht=i(20282),ut=i(66544),ct=i(19440),dt=i(54781),_t=i(30638);class ft{constructor(t,e){this._width=0,this._height=0,this._free=[],this._width=t,this._height=e,this._free.push(new _t.Z(0,0,t,e))}get width(){return this._width}get height(){return this._height}allocate(t,e){if(t>this._width||e>this._height)return new _t.Z;let i=null,s=-1;for(let r=0;r<this._free.length;++r){const n=this._free[r];t<=n.width&&e<=n.height&&(null===i||n.y<=i.y&&n.x<=i.x)&&(i=n,s=r)}return null===i?new _t.Z:(this._free.splice(s,1),i.width<i.height?(i.width>t&&this._free.push(new _t.Z(i.x+t,i.y,i.width-t,e)),i.height>e&&this._free.push(new _t.Z(i.x,i.y+e,i.width,i.height-e))):(i.width>t&&this._free.push(new _t.Z(i.x+t,i.y,i.width-t,i.height)),i.height>e&&this._free.push(new _t.Z(i.x,i.y+e,t,i.height-e))),new _t.Z(i.x,i.y,t,e))}release(t){for(let e=0;e<this._free.length;++e){const i=this._free[e];if(i.y===t.y&&i.height===t.height&&i.x+i.width===t.x)i.width+=t.width;else if(i.x===t.x&&i.width===t.width&&i.y+i.height===t.y)i.height+=t.height;else if(t.y===i.y&&t.height===i.height&&t.x+t.width===i.x)i.x=t.x,i.width+=t.width;else{if(t.x!==i.x||t.width!==i.width||t.y+t.height!==i.y)continue;i.y=t.y,i.height+=t.height}this._free.splice(e,1),this.release(t)}this._free.push(t)}}var pt=i(29964);const mt=256,gt=t=>Math.floor(t/256);function bt(t){const e=new Set;for(const i of t)e.add(gt(i));return e}function vt(t,e,i){return t.has(e)||t.set(e,i().then((()=>{t.delete(e)})).catch((i=>{t.delete(e),(0,ot.H9)(i)}))),t.get(e)}const Et=t=>({rect:new _t.Z(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:t,sdf:!0});class Tt{constructor(t,e,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=e,this._glyphSource=i,this._binPack=new ft(t-4,e-4),this._glyphData.push(new Uint8Array(t*e)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph()}dispose(){this._binPack=null;for(const t of this._textures)t&&t.dispose();this._textures.length=0,this._glyphData.length=0}_initDecorationGlyph(){const t=[117,149,181,207,207,181,149,117],e=[];for(let s=0;s<t.length;s++){const i=t[s];for(let t=0;t<11;t++)e.push(i)}const i={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(e)};this._recordGlyph(i)}async getGlyphItems(t,e,i){const s=this._getGlyphCache(t);return await this._fetchRanges(t,e,i),e.map((e=>this._getMosaicItem(s,t,e)))}bind(t,e,i,s){const r=this._getTexture(t,i);r.setSamplingMode(e),this._dirties[i]&&(r.setData(this._glyphData[i]),this._dirties[i]=!1),t.bindTexture(r,s)}_getGlyphCache(t){return this._glyphCache[t]||(this._glyphCache[t]={}),this._glyphCache[t]}_getTexture(t,e){return this._textures[e]||(this._textures[e]=new pt.x(t,{pixelFormat:H.VI.ALPHA,dataType:H.Br.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height))),this._textures[e]}_invalidate(){this._dirties[this._currentPage]=!0}async _fetchRanges(t,e,i){const s=bt(e),r=[];s.forEach((e=>{r.push(this._fetchRange(t,e,i))})),await Promise.all(r)}async _fetchRange(t,e,i){if(e>mt)return null;const s=t+e;return vt(this._rangePromises,s,(()=>this._glyphSource.getRange(t,e,i)))}_getMosaicItem(t,e,i){if(!t[i]){const s=this._glyphSource.getGlyph(e,i);if(!s||!s.metrics)return Et(i);const r=this._recordGlyph(s),n=this._currentPage,a=s.metrics;t[i]={rect:r,page:n,metrics:a,code:i,sdf:!0},this._invalidate()}return t[i]}_recordGlyph(t){const e=t.metrics;let i;if(0===e.width)i=new _t.Z(0,0,0,0);else{const s=3,r=e.width+2*s,a=e.height+2*s;i=this._binPack.allocate(r,a),i.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyph(),this._binPack=new ft(this.width-4,this.height-4),i=this._binPack.allocate(r,a));const o=this._glyphData[this._currentPage],l=t.bitmap;let h,u;if(l)for(let t=0;t<a;t++){h=r*t,u=this.width*(i.y+t)+i.x;for(let t=0;t<r;t++)o[u+t]=l[h+t]}(0,n.Z)("esri-glyph-debug")&&this._showDebugPage(o)}return i}_showDebugPage(t){const e=document.createElement("canvas"),i=e.getContext("2d"),s=new ImageData(this.width,this.height),r=s.data;e.width=this.width,e.height=this.height,e.style.border="1px solid black";for(let n=0;n<t.length;++n)r[4*n+0]=t[n],r[4*n+1]=0,r[4*n+2]=0,r[4*n+3]=255;i.putImageData(s,0,0),document.body.appendChild(e)}}var wt=i(46354);class xt{constructor(t){for(this._metrics=[],this._bitmaps=[];t.next();)switch(t.tag()){case 1:{const e=t.getMessage();for(;e.next();)switch(e.tag()){case 3:{const t=e.getMessage();let i,s,r,n,a,o,l;for(;t.next();)switch(t.tag()){case 1:i=t.getUInt32();break;case 2:s=t.getBytes();break;case 3:r=t.getUInt32();break;case 4:n=t.getUInt32();break;case 5:a=t.getSInt32();break;case 6:o=t.getSInt32();break;case 7:l=t.getUInt32();break;default:t.skip()}t.release(),i&&(this._metrics[i]={width:r,height:n,left:a,top:o,advance:l},this._bitmaps[i]=s);break}default:e.skip()}e.release();break}default:t.skip()}}getMetrics(t){return this._metrics[t]}getBitmap(t){return this._bitmaps[t]}}class yt{constructor(){this._ranges=[]}getRange(t){return this._ranges[t]}addRange(t,e){this._ranges[t]=e}}class Rt{constructor(t){this._glyphInfo={},this._baseURL=t}getRange(t,e,i){const s=this._getFontStack(t);if(s.getRange(e))return Promise.resolve();const r=256*e,n=r+255,a=this._baseURL.replace("{fontstack}",t).replace("{range}",r+"-"+n);return(0,rt["default"])(a,{responseType:"array-buffer",...i}).then((t=>{s.addRange(e,new xt(new wt.Z(new Uint8Array(t.data),new DataView(t.data))))}))}getGlyph(t,e){const i=this._getFontStack(t);if(!i)return;const s=Math.floor(e/256);if(s>256)return;const r=i.getRange(s);return r?{metrics:r.getMetrics(e),bitmap:r.getBitmap(e)}:void 0}_getFontStack(t){let e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new yt),e}}var Ft=i(16509);const Bt=1e20;class Ct{constructor(t){this.size=t;const e=document.createElement("canvas");e.width=e.height=t,this._context=e.getContext("2d"),this._gridOuter=new Float64Array(t*t),this._gridInner=new Float64Array(t*t),this._f=new Float64Array(t),this._d=new Float64Array(t),this._z=new Float64Array(t+1),this._v=new Int16Array(t)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}draw(t,e,i=31){this._initSVG();const s=this.createSVGString(t);return new Promise(((t,r)=>{const n=new Image;n.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(s),n.onload=()=>{n.onload=null,this._context.clearRect(0,0,this.size,this.size),this._context.drawImage(n,0,0,this.size,this.size);const e=this._context.getImageData(0,0,this.size,this.size),s=new Uint8Array(this.size*this.size*4);for(let t=0;t<this.size*this.size;t++){const i=e.data[4*t+3]/255;this._gridOuter[t]=1===i?0:0===i?Bt:Math.max(0,.5-i)**2,this._gridInner[t]=1===i?Bt:0===i?0:Math.max(0,i-.5)**2}this._edt(this._gridOuter,this.size,this.size),this._edt(this._gridInner,this.size,this.size);for(let t=0;t<this.size*this.size;t++){const e=this._gridOuter[t]-this._gridInner[t];(0,Ft.I)(.5-e/(2*i),s,4*t)}t(s)};const a=e&&e.signal;a&&(0,ot.fu)(a,(()=>r((0,ot.zE)())))}))}_initSVG(){if(!this._svg){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),this._svg=t}}createSVGString(t){this._initSVG();const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d",t),this._svg.appendChild(e);const i=e.getBBox(),s=i.width/i.height,r=this.size/2;let n,a,o,l;if(s>1){a=n=r/i.width;const t=r*(1/s);o=this.size/4,l=r-t/2}else n=a=r/i.height,o=r-r*s/2,l=this.size/4;const h=-i.x*n+o,u=-i.y*a+l;e.setAttribute("style",`transform: matrix(${n}, 0, 0, ${a}, ${h}, ${u})`);const c=`<svg style="fill:red;" height="${this.size}" width="${this.size}" xmlns="http://www.w3.org/2000/svg">${this._svg.innerHTML}</svg>`;return this._svg.removeChild(e),c}_edt(t,e,i){const s=this._f,r=this._d,n=this._v,a=this._z;for(let o=0;o<e;o++){for(let r=0;r<i;r++)s[r]=t[r*e+o];this._edt1d(s,r,n,a,i);for(let s=0;s<i;s++)t[s*e+o]=r[s]}for(let o=0;o<i;o++){for(let i=0;i<e;i++)s[i]=t[o*e+i];this._edt1d(s,r,n,a,e);for(let i=0;i<e;i++)t[o*e+i]=Math.sqrt(r[i])}}_edt1d(t,e,i,s,r){i[0]=0,s[0]=-Bt,s[1]=+Bt;for(let n=1,a=0;n<r;n++){let e=(t[n]+n*n-(t[i[a]]+i[a]*i[a]))/(2*n-2*i[a]);for(;e<=s[a];)a--,e=(t[n]+n*n-(t[i[a]]+i[a]*i[a]))/(2*n-2*i[a]);a++,i[a]=n,s[a]=e,s[a+1]=+Bt}for(let n=0,a=0;n<r;n++){for(;s[a+1]<n;)a++;e[n]=(n-i[a])*(n-i[a])+t[i[a]]}}}var At=i(72558);function St(t){return t&&"static"===t.type}class Ot{constructor(t,e,i,s=0){this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(e<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=i,this._requestRender=t,s>0&&(this._maxItemSize=s),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new ft(this._pageWidth,this._pageHeight);const r=Math.floor(this._pageWidth),n=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(r*n)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[0]}getHeight(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[1]}getPageTexture(t){return t<this._mosaicPages.length?this._mosaicPages[t].texture:null}has(t){return this._mosaicRects.has(t)}get itemCount(){return this._mosaicRects.size}getSpriteItem(t){return this._mosaicRects.get(t)}addSpriteItem(t,e,i,s,r,n){if(this._mosaicRects.has(t))return this._mosaicRects.get(t);let a,o,l;if(St(i))[a,o,l]=this._allocateImage(e[0],e[1]);else{a=new _t.Z(0,0,e[0],e[1]),o=this._mosaicPages.length;const t=void 0;this._mosaicPages.push({mosaicsData:i,size:e,dirty:!0,texture:t})}if(a.width<=0||a.height<=0)return null;const h={rect:a,width:e[0],height:e[1],sdf:r,simplePattern:n,pixelRatio:1,page:o};return this._mosaicRects.set(t,h),St(i)&&this._copy({rect:a,spriteSize:e,spriteData:i.data,page:o,pageSize:l,repeat:s,sdf:r}),h}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const t=this._spriteCopyQueue.pop();t&&this._copy(t)}getSpriteItems(t){const e={};for(const i of t)e[i]=this.getSpriteItem(i);return e}getMosaicItemPosition(t){const e=this.getSpriteItem(t),i=e&&e.rect;if(!i)return null;i.width=e.width,i.height=e.height;const s=e.width,r=e.height,n=ct.fL,a=this._mosaicPages[e.page];return{size:[e.width,e.height],tl:[(i.x+n)/a[0],(i.y+n)/a[1]],br:[(i.x+n+s)/a[0],(i.y+n+r)/a[1]],page:e.page}}bind(t,e,i=0,s=0){const r=this._mosaicPages[i],n=r.mosaicsData;let o=r.texture;if(o||(o=Mt(t,n,r.size),r.texture=o),o.setSamplingMode(e),St(n))t.bindTexture(o,s),r.dirty&&(o.setData(new Uint8Array(n.data.buffer)),o.generateMipmap());else{const e=n.data,i=e.bindFrame(t,o,s);(0,a.pC)(this._requestRender)&&i&&e.frameCount>0&&this._requestRender.requestRender(),e.bindFrame(t,o,s)}r.dirty=!1}static _copyBits(t,e,i,s,r,n,a,o,l,h,u){let c=s*e+i,d=o*n+a;if(u){d-=n;for(let a=-1;a<=h;a++,c=((a+h)%h+s)*e+i,d+=n)for(let e=-1;e<=l;e++)r[d+e]=t[c+(e+l)%l]}else for(let _=0;_<h;_++){for(let e=0;e<l;e++)r[d+e]=t[c+e];c+=e,d+=n}}_copy(t){if(t.page>=this._mosaicPages.length)return;const e=this._mosaicPages[t.page],i=e.mosaicsData;if(!St(e.mosaicsData))throw new s.Z("mapview-invalid-resource","unsuitable data type!");const r=t.spriteData,n=i.data;n&&r||console.error("Source or target images are uninitialized!"),Ot._copyBits(r,t.spriteSize[0],0,0,n,t.pageSize[0],t.rect.x+ct.fL,t.rect.y+ct.fL,t.spriteSize[0],t.spriteSize[1],t.repeat),e.dirty=!0}_allocateImage(t,e){t+=2*ct.fL,e+=2*ct.fL;const i=Math.max(t,e);if(this._maxItemSize&&this._maxItemSize<i){const i=2**Math.ceil((0,At.k3)(t)),s=2**Math.ceil((0,At.k3)(e)),r=new _t.Z(0,0,t,e);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(i*s)},size:[i,s],dirty:!0,texture:void 0}),[r,this._mosaicPages.length-1,[i,s]]}const s=this._binPack.allocate(t,e);if(s.width<=0){const i=this._mosaicPages[this._currentPage];return!i.dirty&&St(i.mosaicsData)&&(i.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new ft(this._pageWidth,this._pageHeight),this._allocateImage(t,e)}return[s,this._currentPage,[this._pageWidth,this._pageHeight]]}dispose(){this._binPack=null;for(const t of this._mosaicPages){const e=t.texture;e&&e.dispose();const i=t.mosaicsData;St(i)||i.data.pause()}this._mosaicPages=null,this._mosaicRects.clear()}}function Mt(t,e,i){return St(e)?new pt.x(t,{pixelFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,width:i[0],height:i[1]},new Uint8Array(e.data.buffer)):new pt.x(t,{pixelFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,samplingMode:H.cw.LINEAR,wrapMode:H.e8.CLAMP_TO_EDGE,width:i[0],height:i[1]},null)}var It=i(1385);const Pt=new Uint32Array(256);for(let Gr=0;Gr<256;Gr++){let t=Gr;for(let e=0;e<8;e++)t=0!=(1&t)?3988292384^t>>>1:t>>>1;Pt[Gr]=t}function Dt(t,e=0,i=t.length-e){let s=-1;for(let r=e,n=e+i;r<n;r++)s=s>>>8^Pt[255&(s^t[r])];return-1^s}const Nt=new s.Z("Not a PNG"),Ut=new s.Z("Not an animated PNG"),Lt=new Uint8Array([137,80,78,71,13,10,26,10]);function zt(t){const e=t.constructor===Uint8Array?t:new Uint8Array(t);return!Lt.some(((t,i)=>t!==e[i]))}function Gt(t){const e=new Uint8Array(t);if(!zt(e))return!1;let i=!1;return Ht(e,(t=>!(i="acTL"===t))),i}class kt{constructor(){this.width=0,this.height=0,this.numPlays=0,this.playTime=0,this.frames=[],this.paused=!1,this.playing=!1,this.playSpeed=1,this.currentFrameNumber=0,this._lastUsedFrame=-1}static async create(t,e){const i=new kt;try{await i._load(t,e)}catch(r){if(!(0,ot.D_)(r))return new s.Z("invalid-resource",`Could not load PNG: ${r.message}`)}return i}play(){this.playing||(this.paused=!1,this.playing=!0,this._play())}pause(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}togglePlay(){this.paused||!this.playing?this.play():this.pause()}bindFrame(t,e,i){t.bindTexture(e,i);const s=this.frameChanged();if(!s)return!1;const r=this.currentFrame,n=r.frameData,a=e.descriptor;return(r.left||r.top||r.width!==a.width||r.height!==a.height)&&e.setData(null),e.updateData(0,r.left,r.top,r.width,r.height,n),this.updateUsedFrame(),s}frameChanged(){return this._lastUsedFrame!==this.currentFrameNumber}updateUsedFrame(){this._lastUsedFrame=this.currentFrameNumber}async _load(t,e){try{const e=Xt(this,t);if(e!==this)return e;this._resizeCanvas=document.createElement("canvas"),this._resizeCanvas.width=this.width,this._resizeCanvas.height=this.height,await Promise.all(this.frames.map((t=>t.createImage(this._resizeCanvas))))}catch(A){if(!(0,ot.D_)(A))return new s.Z("invalid-resource","Could not parse PNG")}this.play()}_play(){let t,e;if(0===this.playSpeed)return void this.pause();this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),e=this.currentFrameNumber,e-=1,e<0&&(e=this.frames.length-1),t=1*-this.frames[e].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,t=1*this.frames[this.currentFrameNumber].delay/this.playSpeed);const i=this.frames[this.currentFrameNumber];this.currentFrame={frameData:i.imageData,top:i.top,left:i.left,width:i.width,height:i.height},this.timerID=window.setTimeout((()=>this._play()),t)}}class Vt{constructor(){this.left=0,this.top=0,this.width=0,this.height=0,this.delay=0,this.disposeOp=0,this.blendOp=0,this.data=null,this.imageData=null}async createImage(t){if(null===this.imageData)return new Promise(((e,i)=>{const s=URL.createObjectURL(this.data),r=document.createElement("img");r.onload=()=>{URL.revokeObjectURL(s),this.imageData=Wt(r,t),e()},r.onerror=()=>{URL.revokeObjectURL(s),this.imageData=null,i(new Error("Image creation error"))},r.src=s}))}}function Wt(t,e){e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const s=i.getImageData(0,0,t.width,t.height),r=new Uint8Array(s.data);let n;for(let a=0;a<r.length;a+=4)n=r[a+3]/255,r[a]=r[a]*n,r[a+1]=r[a+1]*n,r[a+2]=r[a+2]*n;return new ImageData(new Uint8ClampedArray(r.buffer),t.width,t.height)}function Xt(t,e){const i=new Uint8Array(e);if(Lt.some(((t,e)=>t!==i[e])))return Nt;let s=!1;if(Ht(i,(t=>!(s="acTL"===t))),!s)return Ut;const r=[],n=[];let a=null,o=null,l=0;if(Ht(i,((e,i,s,h)=>{const u=new DataView(i.buffer);switch(e){case"IHDR":a=i.subarray(s+8,s+8+h),t.width=u.getUint32(s+8),t.height=u.getUint32(s+12);break;case"acTL":t.numPlays=u.getUint32(s+8+4);break;case"fcTL":{o&&(t.frames.push(o),l++),o=new Vt,o.width=u.getUint32(s+8+4),o.height=u.getUint32(s+8+8),o.left=u.getUint32(s+8+12),o.top=u.getUint32(s+8+16);const e=u.getUint16(s+8+20);let i=u.getUint16(s+8+22);0===i&&(i=100),o.delay=1e3*e/i,o.delay<=10&&(o.delay=100),t.playTime+=o.delay,o.disposeOp=u.getUint8(s+8+24),o.blendOp=u.getUint8(s+8+25),o.dataParts=[],0===l&&2===o.disposeOp&&(o.disposeOp=1);break}case"fdAT":o&&o.dataParts.push(i.subarray(s+8+4,s+8+h));break;case"IDAT":o&&o.dataParts.push(i.subarray(s+8,s+8+h));break;case"IEND":n.push(Yt(i,s,12+h));break;default:r.push(Yt(i,s,12+h))}})),0===t.frames.length)return Ut;t.frameCount=t.frames.length;const h=new Blob(r),u=new Blob(n);return t.frames.forEach((t=>{let e=[];e.push(Lt),a.set(Kt(t.width),0),a.set(Kt(t.height),4),e.push(jt("IHDR",a)),e.push(h),t.dataParts.forEach((t=>e.push(jt("IDAT",t)))),e.push(u),t.data=new Blob(e,{type:"image/png"}),delete t.dataParts,e=null})),t}function Ht(t,e){const i=new DataView(t.buffer);let s,r,n,a=8;do{r=i.getUint32(a),s=qt(t,a+4,4),n=e(s,t,a,r),a+=12+r}while(!1!==n&&"IEND"!==s&&a<t.length)}function qt(t,e,i){const s=Array.prototype.slice.call(t.subarray(e,e+i));return String.fromCharCode.apply(String,s)}function Zt(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}function Yt(t,e,i){const s=new Uint8Array(i);return s.set(t.subarray(e,e+i)),s}function jt(t,e){const i=t.length+e.length,s=new Uint8Array(i+8),r=new DataView(s.buffer);r.setUint32(0,e.length),s.set(Zt(t),4),s.set(e,8);const n=Dt(s,4,i);return r.setUint32(i+4,n),s}function Kt(t){return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,255&t])}const $t={GCExt:249,COMMENT:254,APPExt:255,UNKNOWN:1,IMAGE:44,EOF:59,EXT:33};function Qt(t){if(!t||0===t.byteLength)return!1;const e=t.constructor===Uint8Array?t:new Uint8Array(t);return 71===e[0]&&73===e[1]&&70===e[2]&&56===e[3]}function Jt(t){if(!t||0===t.byteLength)return!1;const e=new Uint8Array(t);if(!Qt(e))return!1;let i=0;for(let s=0,r=e.length-9;s<r;++s)if(0===e[s]&&33===e[s+1]&&249===e[s+2]&&4===e[s+3]&&0===e[s+8]&&(44===e[s+9]||33===e[s+9])&&(i++,i>1))return!0;return!1}class te{constructor(){this.paused=!1,this.playing=!1,this.waitTillDone=!0,this.loading=!1,this.firstFrameOnly=!1,this.frames=[],this.comment="",this.length=0,this.currentFrameNumber=0,this.frameCount=0,this.playSpeed=1,this.lastFrame=null,this.playOnLoad=!0,this.complete=!1,this.interlaceOffsets=[0,4,2,1],this.interlaceSteps=[8,8,4,2],this._lastUsedFrame=-1}static async create(t,e){const i=new te;try{await i._load(t,e)}catch(Pt){if(!(0,ot.D_)(Pt))return new s.Z("invalid-resource",`Could not load PNG: ${Pt.message}`)}return i}play(){this.playing||(this.paused=!1,this.playing=!0,this._play())}pause(){this.paused=!0,this.playing=!1,clearTimeout(this.timerID)}togglePlay(){this.paused||!this.playing?this.play():this.pause()}bindFrame(t,e,i){t.bindTexture(e,i);const s=this.frameChanged();if(s){const t=this.currentFrame,i=t.frameData;e.updateData(0,0,0,t.width,t.height,i),this.updateUsedFrame()}return s}seekFrame(t){clearTimeout(this.timerID),this.currentFrameNumber=t%this.frames.length,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}seek(t){clearTimeout(this.timerID),t<0&&(t=0),t*=1e3,t%=this.length;let e=0;for(;t>this.frames[e].time+this.frames[e].delay&&e<this.frames.length;)e+=1;this.currentFrameNumber=e,this.playing?this._play():this._setCurrentFrame(this.currentFrameNumber)}frameChanged(){return this._lastUsedFrame!==this.currentFrameNumber}updateUsedFrame(){this._lastUsedFrame=this.currentFrameNumber}async _load(t,e){try{this.loading=!0,await this._parse(t,e),this.loading=!1,this.play()}catch(B){if(!(0,ot.D_)(B))return new s.Z("invalid-resource","Could not parse gif!")}}_parse(t,e){const i=new ee(t);i.pos+=6,this.width=i.data[i.pos++]+(i.data[i.pos++]<<8),this.height=i.data[i.pos++]+(i.data[i.pos++]<<8);const s=i.data[i.pos++];return this.globalColourCount=1<<1+(7&s),i.pos++,i.pos++,128&s&&(this.globalColourTable=this._parseColourTable(this.globalColourCount,i)),new Promise(((t,s)=>{setTimeout((()=>this._parseBlock(i,t,s,e)),0)}))}async _parseBlock(t,e,i,s){if(s&&s.signal&&(0,ot.Hc)(s.signal))return void i((0,ot.zE)());const r=t.data[t.pos++];if(r===$t.IMAGE){if(this._parseImg(t),this.firstFrameOnly)return this._finishedLoading(),void e()}else{if(r===$t.EOF)return this._finishedLoading(),void e();this._parseExt(t)}"function"==typeof this.onprogress&&this.onprogress({bytesRead:t.pos,totalBytes:t.data.length,frame:this.frames.length}),setTimeout((()=>this._parseBlock(t,e,i,s)),0)}_parseColourTable(t,e){const i=[];for(let s=0;s<t;s++)i.push([e.data[e.pos++],e.data[e.pos++],e.data[e.pos++]]);return i}_parseImg(t){const e=t=>{const e=this.pixelBufSize/t;this.interlacedBufSize!==this.pixelBufSize&&(this.deinterlaceBuf=new Uint8Array(this.pixelBufSize),this.interlacedBufSize=this.pixelBufSize);let i=0;for(let s=0;s<4;s++)for(let r=this.interlaceOffsets[s];r<e;r+=this.interlaceSteps[s])this.deinterlaceBuf.set(this.pixelBuf.subarray(i,i+t),r*t),i+=t},i={};this.frames.push(i),i.disposalMethod=this.disposalMethod,i.time=this.length,i.delay=10*this.delayTime,this.length+=i.delay,this.transparencyGiven?i.transparencyIndex=this.transparencyIndex:i.transparencyIndex=void 0,i.leftPos=t.data[t.pos++]+(t.data[t.pos++]<<8),i.topPos=t.data[t.pos++]+(t.data[t.pos++]<<8),i.width=t.data[t.pos++]+(t.data[t.pos++]<<8),i.height=t.data[t.pos++]+(t.data[t.pos++]<<8);const s=t.data[t.pos++];i.localColourTableFlag=!!(128&s),i.localColourTableFlag&&(i.localColourTable=this._parseColourTable(1<<1+(7&s),t)),this.pixelBufSize!==i.width*i.height&&(this.pixelBuf=new Uint8Array(i.width*i.height),this.pixelBufSize=i.width*i.height),this._lzwDecode(t.data[t.pos++],t.readSubBlocksB()),64&s?(i.interlaced=!0,e(i.width)):i.interlaced=!1,this._processFrame(i)}_lzwDecode(t,e){let i,s,r,n,a,o,l,h,u;r=s=0;let c=[];const d=1<<t,_=d+1;for(n=t+1,u=!1;!u;){for(o=a,a=0,i=0;i<n;i++)e[r>>3]&1<<(7&r)&&(a|=1<<i),r++;if(a===d){for(c=[],n=t+1,i=0;i<d;i++)c[i]=[i];c[d]=[],c[_]=null}else{if(a===_)return void(u=!0);for(a>=c.length?c.push(c[o].concat(c[o][0])):o!==d&&c.push(c[o].concat(c[a][0])),l=c[a],h=l.length,i=0;i<h;i++)this.pixelBuf[s++]=l[i];c.length===1<<n&&n<12&&n++}}}_processFrame(t){t.image=document.createElement("canvas"),t.image.width=this.width,t.image.height=this.height,t.ctx=t.image.getContext("2d");const e=t.localColourTableFlag?t.localColourTable:this.globalColourTable;null===this.lastFrame&&(this.lastFrame=t);const i=2===this.lastFrame.disposalMethod||3===this.lastFrame.disposalMethod;i||t.ctx.drawImage(this.lastFrame.image,0,0,this.width,this.height);const s=t.ctx.getImageData(t.leftPos,t.topPos,t.width,t.height),r=t.transparencyIndex,n=s.data,a=t.interlaced?this.deinterlaceBuf:this.pixelBuf,o=a.length;let l,h,u=0;for(let c=0;c<o;c++)l=a[c],h=e[l],r!==l?(n[u++]=h[0],n[u++]=h[1],n[u++]=h[2],n[u++]=255):i?(n[u+3]=0,u+=4):u+=4;t.ctx.putImageData(s,t.leftPos,t.topPos),this.lastFrame=t}_parseExt(t){const e=t.data[t.pos++];e===$t.GCExt?this._parseGCExt(t):e===$t.COMMENT?this.comment+=t.readSubBlocks():e===$t.APPExt?this._parseAppExt(t):(e===$t.UNKNOWN&&(t.pos+=13),t.readSubBlocks())}_parseAppExt(t){t.pos+=1,"NETSCAPE"===t.getString(8)?t.pos+=8:(t.pos+=3,t.readSubBlocks())}_parseGCExt(t){t.pos++;const e=t.data[t.pos++];this.disposalMethod=(28&e)>>2,this.transparencyGiven=!!(1&e),this.delayTime=t.data[t.pos++]+(t.data[t.pos++]<<8),this.transparencyIndex=t.data[t.pos++],t.pos++}_finishedLoading(){this.loading=!1,this.frameCount=this.frames.length,this.lastFrame=null,this.complete=!0,this.disposalMethod=void 0,this.transparencyGiven=void 0,this.delayTime=void 0,this.transparencyIndex=void 0,this.waitTillDone=void 0,this.pixelBuf=void 0,this.deinterlaceBuf=void 0,this.pixelBufSize=void 0,this.deinterlaceBuf=void 0,this.currentFrameNumber=0,this.frames.length>0&&this._setCurrentFrame(0),this.playOnLoad&&this.play()}_play(){let t,e;0!==this.playSpeed?(this.playSpeed<0?(this.currentFrameNumber-=1,this.currentFrameNumber<0&&(this.currentFrameNumber=this.frames.length-1),e=this.currentFrameNumber,e-=1,e<0&&(e=this.frames.length-1),t=1*-this.frames[e].delay/this.playSpeed):(this.currentFrameNumber+=1,this.currentFrameNumber%=this.frames.length,t=1*this.frames[this.currentFrameNumber].delay/this.playSpeed),this._setCurrentFrame(this.currentFrameNumber),this.timerID=window.setTimeout((()=>this._play()),t)):this.pause()}_setCurrentFrame(t){const e=this.frames[t];this.currentFrame={frameData:e.image,top:0,left:0,width:this.width,height:this.height}}}class ee{constructor(t){this.pos=0,this.data=new Uint8ClampedArray(t),this.len=this.data.length}getString(t){let e="";for(;t--;)e+=String.fromCharCode(this.data[this.pos++]);return e}readSubBlocks(){let t,e,i="";do{for(e=t=this.data[this.pos++];e--;)i+=String.fromCharCode(this.data[this.pos++])}while(0!==t&&this.pos<this.len);return i}readSubBlocksB(){let t,e;const i=[];do{for(e=t=this.data[this.pos++];e--;)i.push(this.data[this.pos++])}while(0!==t&&this.pos<this.len);return i}}var ie=i(25481);function se(t){switch(t.type){case"esriSMS":return`${t.style}.${t.path}`;case"esriSLS":return`${t.style}.${t.cap}`;case"esriSFS":return`${t.style}`;case"esriPFS":case"esriPMS":return t.imageData?`${t.imageData}${t.width}${t.height}`:`${t.url}${t.width}${t.height}`;default:return"mosaicHash"in t?t.mosaicHash:JSON.stringify(t)}}var re=i(13686);const ne=(0,ht.c)(),ae="arial-unicode-ms-regular",oe=126,le=at.Z.getLogger("esri.views.2d.engine.webgl.TextureManager");async function he(t,e){const i=(0,It.Gr)(t);let r;const n=";base64,";if(i.includes(n)){const t=i.indexOf(n)+n.length,e=i.substring(t),s=atob(e),a=new Uint8Array(s.length);for(let i=0;i<s.length;i++)a[i]=s.charCodeAt(i);r=a.buffer}else try{const{data:t}=await(0,rt["default"])(i,{responseType:"array-buffer",...e});r=t}catch(B){if(!(0,ot.D_)(B))return new s.Z("mapview-invalid-resource",`Could not fetch requested resource at ${i}`)}return r}function ue(t,e){const i=Math.round((0,lt.F2)(e)*window.devicePixelRatio),s=i>=128?2:4;return Math.min(t,i*s)}const ce=(t,e,i)=>le.error(new s.Z(t,e,i));class de{constructor(t,e,i){this.mosaicType=t,this.page=e,this.sdf=i}static fromMosaic(t,e){return new de(t,e.page,e.sdf)}}class _e{constructor(t,e){this.resourceManager=e,this._invalidFontsMap=new Map,this._sdfConverter=new Ct(oe),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new re.e({concurrency:10,process:async(t,i)=>{(0,ot.k_)(i);try{return await(0,rt["default"])(t,{responseType:"image",signal:i})}catch(e){if(!(0,ot.D_)(e))throw new s.Z("mapview-invalid-resource",`Could not fetch requested resource at ${t}`,e);throw e}}}),this._spriteMosaic=new Ot(t,2048,2048,500),this._glyphSource=new Rt(`${st.Z.fontsUrl}/{fontstack}/{range}.pbf`),this._glyphMosaic=new Tt(1024,1024,this._glyphSource),this._rasterizer=new ut.Z(e)}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}async rasterizeItem(t,e,i,s){if((0,a.Wi)(t))return ce("mapview-null-resource","Unable to rasterize null resource"),null;switch(t.type){case"text":case"esriTS":{const e=await this._rasterizeText(t,i,s);return e.forEach((t=>this._setTextureBinding(g.Un.GLYPH,t))),{glyphMosaicItems:e}}default:{if((0,It.Ll)(t))return ce("mapview-invalid-type",`MapView does not support symbol type: ${t.type}`,t),null;const i=await this._rasterizeSpriteSymbol(t,e,s);return(0,ie.ok)(i)&&i&&this._setTextureBinding(g.Un.SPRITE,i),{spriteMosaicItem:i}}}}bindTextures(t,e,i,s=!1){if(0===i.textureBinding)return;const r=this._bindingInfos[i.textureBinding-1],n=r.page,a=s?H.cw.LINEAR_MIPMAP_LINEAR:H.cw.LINEAR;switch(r.mosaicType){case g.Un.SPRITE:{const i=this.sprites.getWidth(n),s=this.sprites.getHeight(n),r=(0,_.s)(ne,i,s);return this._spriteMosaic.bind(t,a,n,ct.D3),e.setUniform1i("u_texture",ct.D3),void e.setUniform2fv("u_mosaicSize",r)}case g.Un.GLYPH:{const i=this.glyphs.width,s=this.glyphs.height,r=(0,_.s)(ne,i,s);return this._glyphMosaic.bind(t,a,n,ct.Al),e.setUniform1i("u_texture",ct.Al),void e.setUniform2fv("u_mosaicSize",r)}default:le.error("mapview-texture-manager",`Cannot handle unknown type ${r.mosaicType}`)}}_hashMosaic(t,e){return 1|t<<1|(e.sdf?1:0)<<2|e.page<<3}_setTextureBinding(t,e){const i=this._hashMosaic(t,e);if(!this._hashToBindingIndex.has(i)){const s=de.fromMosaic(t,e),r=this._bindingInfos.length+1;this._hashToBindingIndex.set(i,r),this._bindingInfos.push(s)}e.textureBinding=this._hashToBindingIndex.get(i)}async _rasterizeText(t,e,i){let s,r;if("cim"in t){const e=t;s=e.fontName,r=e.text}else{const e=t;s=(0,dt.Yc)(e.font),r=e.text}const n=this._invalidFontsMap.has(s),a=e||(0,It.Jq)((0,nt.E)(r)[0]);try{return await this._glyphMosaic.getGlyphItems(n?ae:s,a,i)}catch(P){return ce("mapview-invalid-resource",`Couldn't find font ${s}. Falling back to Arial Unicode MS Regular`),this._invalidFontsMap.set(s,!0),this._glyphMosaic.getGlyphItems(ae,a,i)}}async _rasterizeSpriteSymbol(t,e,i){if((0,It.Gg)(t))return null;const r=se(t);if(this._spriteMosaic.has(r))return this._spriteMosaic.getSpriteItem(r);if((0,It.sG)(t)||(0,It.HX)(t))return this._handleAsyncResource(r,t,i);const n=1,a=this._rasterizer.rasterizeJSONResource(t,n);if(a){const{size:e,image:i,sdf:s,simplePattern:n}=a;return this._addItemToMosaic(r,e,{type:"static",data:i},(0,It.js)(t),s,n)}return new s.Z("TextureManager","unrecognized or null rasterized image")}async _handleAsyncResource(t,e,i){if(this._ongoingRasterizations.has(t))return this._ongoingRasterizations.get(t);let s;s=(0,It.sG)(e)?this._handleSVG(e,t,i):this._handleImage(e,t,i),this._ongoingRasterizations.set(t,s);try{await s,this._ongoingRasterizations.delete(t)}catch{this._ongoingRasterizations.delete(t)}return s}async _handleSVG(t,e,i){const s=[oe,oe],r=await this._sdfConverter.draw(t.path,i);return this._addItemToMosaic(e,s,{type:"static",data:new Uint32Array(r.buffer)},!1,!0,!0)}async _handleGIFOrPNG(t,e,i){const r=await he(t,i);if((0,ie.ok)(r)){const n=Qt(r),a=zt(r);if(!n&&!a)return new s.Z("mapview-invalid-resource","Image data is neither GIF nor PNG!");let o;try{n&&Jt(r)?o=await te.create(r,i):a&&Gt(r)&&(o=await kt.create(r,i))}catch(y){if(!(0,ot.D_)(y))return new s.Z("mapview-invalid-resource","Could not fetch requested resource!")}if(o&&(0,ie.ok)(o))return this._addItemToMosaic(e,[o.width,o.height],{type:"animated",data:o},(0,It.js)(t),!1,!1);const l=new Blob([r],{type:n?"image/gif":"image/png"}),h=await this._imageFromBlob(l);if(h&&h instanceof HTMLImageElement){let i=h.width,s=h.height;"esriPMS"===t.type&&(i=Math.round(ue(h.width,(0,It.Ub)(t))),s=Math.round(h.height*(i/h.width)));const r="cim"in t?t.cim.colorSubstitutions:void 0,{size:n,sdf:a,image:o}=this._rasterizer.rasterizeImageResource(i,s,h,r);return this._addItemToMosaic(e,n,{type:"static",data:o},(0,It.js)(t),a,!1)}}return new s.Z("mapview-invalid-resource","Could not handle resource!")}async _handleImage(t,e,i){if((0,It.DQ)(t)||(0,It.iw)(t))return this._handleGIFOrPNG(t,e,i);const r=(0,It.Gr)(t);try{let s;const o=this.resourceManager.getResource(r);if((0,a.pC)(o))s=o;else{const{data:t}=await this._imageRequestQueue.push(r,{...i});s=t}if((0,It.TB)(r))if("width"in t&&"height"in t)s.width=(0,lt.F2)(t.width),s.height=(0,lt.F2)(t.height);else if("cim"in t){var n;const e=t.cim;s.width=(0,lt.F2)(null!=(n=e.width)?n:e.scaleX*e.size),s.height=(0,lt.F2)(e.size)}if(!s.width||!s.height)return null;let l=s.width,h=s.height;"esriPMS"===t.type&&(l=Math.round(ue(s.width,(0,It.Ub)(t))),h=Math.round(s.height*(l/s.width)));const u="cim"in t?t.cim.colorSubstitutions:void 0,{size:c,sdf:d,image:_}=this._rasterizer.rasterizeImageResource(l,h,s,u);return this._addItemToMosaic(e,c,{type:"static",data:_},(0,It.js)(t),d,!1)}catch(B){if(!(0,ot.D_)(B))return new s.Z("mapview-invalid-resource",`Could not fetch requested resource at ${r}. ${B.message}`)}}async _imageFromBlob(t){const e=window.URL.createObjectURL(t);try{const{data:t}=await this._imageRequestQueue.push(e);return window.URL.revokeObjectURL(e),t}catch(A){if(window.URL.revokeObjectURL(e),!(0,ot.D_)(A))return new s.Z("mapview-invalid-resource",`Could not fetch requested resource at ${e}`);throw A}}_addItemToMosaic(t,e,i,s,r,n){return this._spriteMosaic.addSpriteItem(t,e,i,s,r,n)}}var fe=i(78268);class pe{constructor(){this.name=this.constructor.name}createOptions(t,e){return null}}class me extends pe{constructor(){super(...arguments),this.defines=[],this._desc={vsPath:"fx/integrate",fsPath:"fx/integrate",attributes:new Map([["a_position",0]])}}dispose(){this._quad&&this._quad.dispose()}bind(){}unbind(){}draw(t,e){if(!e.size)return;const{context:i,renderingOptions:s}=t;this._quad||(this._quad=new fe.Z(i,[0,0,1,0,0,1,1,1]));const r=i.getBoundFramebufferObject(),{x:n,y:o,width:l,height:h}=i.getViewport();e.bindTextures(i);const u=e.getBlock(ct.xl);if((0,a.Wi)(u))return;const c=u.getFBO(i),d=u.getFBO(i,1);i.setViewport(0,0,e.size,e.size),this._computeDelta(t,d,s.labelsAnimationTime),this._updateAnimationState(t,d,c),i.bindFramebuffer(r),i.setViewport(n,o,l,h)}_computeDelta(t,e,i){const{context:s,painter:r,displayLevel:n}=t,a=r.materialManager.getProgram(t,this._desc,["delta"]);s.bindFramebuffer(e),s.setClearColor(0,0,0,0),s.clear(s.gl.COLOR_BUFFER_BIT),s.useProgram(a),a.setUniform1i("u_maskTexture",ct.iJ),a.setUniform1i("u_sourceTexture",ct.nM),a.setUniform1f("u_timeDelta",t.deltaTime),a.setUniform1f("u_animationTime",i),a.setUniform1f("u_zoomLevel",Math.round(10*n)),this._quad.draw()}_updateAnimationState(t,e,i){const{context:s,painter:r}=t,n=r.materialManager.getProgram(t,this._desc,["update"]);s.bindTexture(e.colorTexture,1),s.useProgram(n),n.setUniform1i("u_sourceTexture",1),s.bindFramebuffer(i),s.setClearColor(0,0,0,0),s.clear(s.gl.COLOR_BUFFER_BIT),this._quad.draw()}}const ge=t=>t.replace("-","_").toUpperCase(),be=t=>`#define ${ge(t)}\n`;function ve(t){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:be(t)+(0,V.w)("blend/blend.vert"),fragmentShader:be(t)+(0,V.w)("blend/blend.frag")}}}const Ee=at.Z.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect");class Te{constructor(){this._size=[0,0]}dispose(t){this._backBufferTexture=(0,a.O3)(this._backBufferTexture),this._quad=(0,a.O3)(this._quad)}draw(t,e,i,r,n){const{context:a,drawPhase:o}=t;if(this._setupShader(a),r&&"normal"!==r&&o!==g.jx.LABEL)return void this._drawBlended(t,e,i,r,n);const l=ve("normal"),h=a.programCache.acquire(l.shaders.vertexShader,l.shaders.fragmentShader,l.attributes);if(!h)return void Ee.error(new s.Z("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'));a.useProgram(h),e.setSamplingMode(i),a.bindTexture(e,0),h.setUniform1i("u_layerTexture",0),h.setUniform1f("u_opacity",n),a.setBlendingEnabled(!0),a.setBlendFunction(H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA);const u=this._quad;u.draw(),u.unbind(),h.dispose()}_drawBlended(t,e,i,r,n){const{context:o,state:l,pixelRatio:h,inFadeTransition:u}=t,{size:c}=l,d=o.getBoundFramebufferObject();let _,f;if((0,a.pC)(d)){const t=d.descriptor;_=t.width,f=t.height}else _=Math.round(h*c[0]),f=Math.round(h*c[1]);this._createOrResizeTexture(t,_,f);const p=this._backBufferTexture;d.copyToTexture(0,0,_,f,0,0,p),o.setStencilTestEnabled(!1),o.setStencilWriteMask(0),o.setBlendingEnabled(!0),o.setDepthTestEnabled(!1),o.setDepthWriteEnabled(!1);const m=ve(r),g=o.programCache.acquire(m.shaders.vertexShader,m.shaders.fragmentShader,m.attributes);if(!g)return void Ee.error(new s.Z("mapview-BlendEffect",`Error creating shader program for blend mode ${r}`));o.useProgram(g),p.setSamplingMode(i),o.bindTexture(p,0),g.setUniform1i("u_backbufferTexture",0),e.setSamplingMode(i),o.bindTexture(e,1),g.setUniform1i("u_layerTexture",1),g.setUniform1f("u_opacity",n),g.setUniform1f("u_inFadeOpacity",u?1:0),o.setBlendFunction(H.zi.ONE,H.zi.ZERO);const b=this._quad;b.draw(),b.unbind(),g.dispose(),o.setBlendFunction(H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA)}_setupShader(t){this._quad||(this._quad=new fe.Z(t,[-1,-1,1,-1,-1,1,1,1]))}_createOrResizeTexture(t,e,i){const{context:s}=t;null!==this._backBufferTexture&&e===this._size[0]&&i===this._size[1]||(this._backBufferTexture?this._backBufferTexture.resize(e,i):this._backBufferTexture=new pt.x(s,{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,internalFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.LINEAR,flipped:!1,width:e,height:i}),this._size[0]=e,this._size[1]=i)}}class we extends pe{constructor(t){super(),this.name=this.constructor.name,this.defines=[t]}dispose(){}bind({context:t,painter:e}){this._prev=t.getBoundFramebufferObject();const{width:i,height:s}=t.getViewport(),r=e.getFbos(i,s).effect0;t.bindFramebuffer(r),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}unbind(){}draw(t,e){const{context:i,painter:s}=t,r=s.getPostProcessingEffects(e),n=i.getBoundFramebufferObject();for(const{postProcessingEffect:a,effect:o}of r)a.draw(t,n,o);i.bindFramebuffer(this._prev),i.setStencilTestEnabled(!1),s.blitTexture(i,n.colorTexture,H.cw.NEAREST),i.setStencilTestEnabled(!0)}}const xe=1,ye=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],Re=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Fe=256,Be={outlineWidth:.7,outerHaloWidth:.7,innerHaloWidth:.7,outlinePosition:0},Ce=at.Z.getLogger("esri.views.2d.engine.webgl.painter.highlight.HighlightGradient");function Ae(t,e){e.fillColor[0]=t.color.r/255,e.fillColor[1]=t.color.g/255,e.fillColor[2]=t.color.b/255,e.fillColor[3]=t.color.a,t.haloColor?(e.outlineColor[0]=t.haloColor.r/255,e.outlineColor[1]=t.haloColor.g/255,e.outlineColor[2]=t.haloColor.b/255,e.outlineColor[3]=t.haloColor.a):(e.outlineColor[0]=e.fillColor[0],e.outlineColor[1]=e.fillColor[1],e.outlineColor[2]=e.fillColor[2],e.outlineColor[3]=e.fillColor[3]),e.fillColor[3]*=t.fillOpacity,e.outlineColor[3]*=t.haloOpacity,e.fillColor[0]*=e.fillColor[3],e.fillColor[1]*=e.fillColor[3],e.fillColor[2]*=e.fillColor[3],e.outlineColor[0]*=e.outlineColor[3],e.outlineColor[1]*=e.outlineColor[3],e.outlineColor[2]*=e.outlineColor[3],e.outlineWidth=Be.outlineWidth,e.outerHaloWidth=Be.outerHaloWidth,e.innerHaloWidth=Be.innerHaloWidth,e.outlinePosition=Be.outlinePosition}const Se=[0,0,0,0];class Oe{constructor(){this._convertedHighlightOptions={fillColor:[.2*.75,.6*.75,.675,.75],outlineColor:[.2*.9,.54,.81,.9],outlinePosition:Be.outlinePosition,outlineWidth:Be.outlineWidth,innerHaloWidth:Be.innerHaloWidth,outerHaloWidth:Be.outerHaloWidth},this.shadeTexChanged=!0,this.texelData=new Uint8Array(4*Fe),this.minMaxDistance=[0,0]}setHighlightOptions(t){const e=this._convertedHighlightOptions;Ae(t,e);const i=e.outlinePosition-e.outlineWidth/2-e.outerHaloWidth,s=e.outlinePosition-e.outlineWidth/2,r=e.outlinePosition+e.outlineWidth/2,n=e.outlinePosition+e.outlineWidth/2+e.innerHaloWidth,a=Math.sqrt(Math.PI/2)*xe,o=Math.abs(i)>a?Math.round(10*(Math.abs(i)-a))/10:0,l=Math.abs(n)>a?Math.round(10*(Math.abs(n)-a))/10:0;let h;o&&!l?Ce.error("The outer rim of the highlight is "+o+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!o&&l?Ce.error("The inner rim of the highlight is "+l+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):o&&l&&Ce.error("The highlight is "+Math.max(o,l)+"px away from the edge of the feature; consider reducing some width values.");const u=[void 0,void 0,void 0,void 0];function c(t,e,i){u[0]=(1-i)*t[0]+i*e[0],u[1]=(1-i)*t[1]+i*e[1],u[2]=(1-i)*t[2]+i*e[2],u[3]=(1-i)*t[3]+i*e[3]}const{texelData:d}=this;for(let _=0;_<Fe;++_)h=i+_/(Fe-1)*(n-i),h<i?(u[4*_+0]=0,u[4*_+1]=0,u[4*_+2]=0,u[4*_+3]=0):h<s?c(Se,e.outlineColor,(h-i)/(s-i)):h<r?[u[0],u[1],u[2],u[3]]=e.outlineColor:h<n?c(e.outlineColor,e.fillColor,(h-r)/(n-r)):[u[4*_+0],u[4*_+1],u[4*_+2],u[4*_+3]]=e.fillColor,d[4*_+0]=255*u[0],d[4*_+1]=255*u[1],d[4*_+2]=255*u[2],d[4*_+3]=255*u[3];this.minMaxDistance[0]=i,this.minMaxDistance[1]=n,this.shadeTexChanged=!0}applyHighlightOptions(t,e){this.shadeTex||(this.shadeTex=new pt.x(t,{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,width:Fe,height:1,samplingMode:H.cw.LINEAR})),this.shadeTexChanged&&(this.shadeTex.updateData(0,0,0,Fe,1,this.texelData),this.shadeTexChanged=!1),t.bindTexture(this.shadeTex,ct.Jw),e.setUniform2fv("u_minMaxDistance",this.minMaxDistance)}destroy(){this.shadeTex&&(this.shadeTex.dispose(),this.shadeTex=null)}}const Me={shaders:{vertexShader:(0,V.w)("highlight/textured.vert"),fragmentShader:(0,V.w)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},Ie={shaders:{vertexShader:(0,V.w)("highlight/textured.vert"),fragmentShader:(0,V.w)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])};var Pe=i(64816);class De{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(t,e){t.bindTexture(e,ct.QU),t.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",ye),t.bindVAO(this._resources.quadVAO),t.drawArrays(H.MX.TRIANGLE_STRIP,0,4),t.bindVAO()}finalBlur(t,e){t.bindTexture(e,ct.QU),t.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",Re),t.bindVAO(this._resources.quadVAO),t.drawArrays(H.MX.TRIANGLE_STRIP,0,4),t.bindVAO()}renderHighlight(t,e,i){t.bindTexture(e,ct.QU),t.useProgram(this._resources.highlightProgram),i.applyHighlightOptions(t,this._resources.highlightProgram),t.bindVAO(this._resources.quadVAO),t.setBlendingEnabled(!0),t.setBlendFunction(H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA),t.drawArrays(H.MX.TRIANGLE_STRIP,0,4),t.bindVAO()}_initialize(t,e,i){this._width=e,this._height=i;const s=X.f.createVertex(t,H.l1.STATIC_DRAW,new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),r=new Z.U(t,new Map([["a_position",0],["a_texcoord",1]]),{geometry:[new Pe.G("a_position",2,H.g.BYTE,0,4),new Pe.G("a_texcoord",2,H.g.UNSIGNED_BYTE,2,4)]},{geometry:s}),n=(0,q.H)(t,Me),a=(0,q.H)(t,Ie);t.useProgram(n),n.setUniform1i("u_texture",ct.QU),n.setUniform1i("u_shade",ct.Jw),n.setUniform1f("u_sigma",xe),t.useProgram(a),a.setUniform1i("u_texture",ct.QU),a.setUniform1f("u_sigma",xe),this._resources={quadGeometry:s,quadVAO:r,highlightProgram:n,blurProgram:a}}setup(t,e,i){this._resources?(this._width=e,this._height=i):this._initialize(t,e,i)}}var Ne=i(98473);function Ue(t,e,i){const s=new pt.x(t,{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,width:e,height:i,samplingMode:H.cw.LINEAR});return[s,new Ne.X(t,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.STENCIL_RENDER_BUFFER},s)]}class Le{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}_initialize(t,e,i){this._width=e,this._height=i;const[s,r]=Ue(t,e,i),[n,a]=Ue(t,e,i);this._resources={sharedBlur1Tex:s,sharedBlur1Fbo:r,sharedBlur2Tex:n,sharedBlur2Fbo:a}}setup(t,e,i){!this._resources||this._width===e&&this._height===i||this.dispose(),this._resources||this._initialize(t,e,i)}get sharedBlur1Tex(){return this._resources.sharedBlur1Tex}get sharedBlur1Fbo(){return this._resources.sharedBlur1Fbo}get sharedBlur2Tex(){return this._resources.sharedBlur2Tex}get sharedBlur2Fbo(){return this._resources.sharedBlur2Fbo}}const ze=4,Ge=4/ze;class ke extends pe{constructor(){super(...arguments),this.defines=["highlight"],this._hlRenderer=new De,this._hlGradient=new Oe,this._width=void 0,this._height=void 0,this._hlSurfaces=new Le,this._adjustedWidth=void 0,this._adjustedHeight=void 0,this._blitRenderer=new Y}dispose(){this._hlSurfaces&&this._hlSurfaces.dispose(),this._hlRenderer&&this._hlRenderer.dispose(),this._hlGradient&&this._hlGradient.destroy(),this._boundFBO=null}bind(t){const{context:e,painter:i}=t,{width:s,height:r}=e.getViewport(),n=i.getFbos(s,r).effect0;this.setup(t,s,r),e.bindFramebuffer(n),e.setColorMask(!0,!0,!0,!0),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT)}unbind(){}setup({context:t},e,i){this._width=e,this._height=i;const s=e%ze,r=i%ze;e+=s<ze/2?-s:ze-s,i+=r<ze/2?-r:ze-r,this._adjustedWidth=e,this._adjustedHeight=i,this._boundFBO=t.getBoundFramebufferObject();const n=Math.round(e*Ge),a=Math.round(i*Ge);this._hlRenderer.setup(t,n,a),this._hlSurfaces.setup(t,n,a)}draw({context:t}){const e=t.getBoundFramebufferObject();t.setViewport(0,0,this._adjustedWidth*Ge,this._adjustedHeight*Ge),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setStencilTestEnabled(!1),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._blitRenderer.render(t,e.colorTexture,H.cw.NEAREST,1),t.setStencilTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!0),t.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.preBlur(t,this._hlSurfaces.sharedBlur1Tex),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(t,this._hlSurfaces.sharedBlur2Tex),t.bindFramebuffer(this._boundFBO),t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(t,this._hlSurfaces.sharedBlur1Tex,this._hlGradient),this._boundFBO=null}setHighlightOptions(t){this._hlGradient.setHighlightOptions(t)}}class Ve extends pe{constructor(){super(...arguments),this.name=this.constructor.name,this.defines=["hittest"]}dispose(){(0,a.pC)(this._fbo)&&this._fbo.dispose()}createOptions({pixelRatio:t},e,i=ct.dn){if(!e.length)return null;const s=e.shift(),r=s.point.x,n=s.point.y;return this._outstanding=s,{type:"hittest",distance:i*t,position:[r,n]}}bind(t){const{context:e,attributeView:i}=t;if(!i.size)return;const s=i.getBlock(ct.pU);if((0,a.Wi)(s))return;const r=s.getFBO(e);e.setViewport(0,0,i.size,i.size),e.bindFramebuffer(r),e.setColorMask(!0,!0,!0,!0),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT)}unbind(t){}draw(t){const{context:e,attributeView:i}=t,s=i.getBlock(ct.pU);if((0,a.Wi)(this._outstanding))return;const r=this._outstanding.resolver;if((0,a.Wi)(s))return r.resolve([]),void(this._outstanding=null);const n=s.getFBO(e),o=new Uint8Array(n.width*n.height*4);n.readPixels(0,0,n.width,n.height,H.VI.RGBA,H.Br.UNSIGNED_BYTE,o);const l=[];for(let a=0;a<o.length;a+=4)o[a]&&l.push(a/4);this._outstanding=null,r.resolve(l)}}class We extends pe{constructor(){super(...arguments),this.name=this.constructor.name,this.defines=["id"],this._lastSize=0}dispose(){(0,a.pC)(this._fbo)&&this._fbo.dispose()}bind({context:t,painter:e}){const{width:i,height:s}=t.getViewport();this._boundFBO=t.getBoundFramebufferObject();const r=e.getFbos(i,s).effect0;t.bindFramebuffer(r),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(t.gl.COLOR_BUFFER_BIT)}unbind({context:t}){t.bindFramebuffer(this._boundFBO),this._boundFBO=null}draw({context:t,state:e,pixelRatio:i},s,r=2*ct.dn){const n=t.getBoundFramebufferObject(),a=e.size[1]*i,o=Math.round(r*i),l=o/2,h=o/2;this._ensureBuffer(o),s.forEach(((t,e)=>{const r=new Map,u=Math.floor(e.x*i-o/2),c=Math.floor(a-e.y*i-o/2);n.readPixels(u,c,o,o,H.VI.RGBA,H.Br.UNSIGNED_BYTE,this._buf);for(let i=0;i<this._buf32.length;i++){const t=this._buf32[i];if(4294967295!==t&&0!==t){const e=i%o,s=o-Math.floor(i/o),n=(l-e)*(l-e)+(h-s)*(h-s),a=r.has(t)?r.get(t):4294967295;r.set(t,Math.min(n,a))}}const d=Array.from(r).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]));t.resolve(d),s.delete(e)}))}_ensureBuffer(t){this._lastSize!==t&&(this._lastSize=t,this._buf=new Uint8Array(4*t*t),this._buf32=new Uint32Array(this._buf.buffer))}}const Xe=5,He=[1,0],qe=[0,1],Ze=[1,.8,.6,.4,.2],Ye=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];class je{constructor(){this._intensityFBO=null,this._compositeFBO=null,this._mipsFBOs=new Array(Xe),this._nMips=Xe,this._kernelSizeArray=[3,5,7,9,11],this._size=[0,0],this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",attributes:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){if(this._quad&&(this._quad.dispose(),this._quad=null),this._intensityFBO&&(this._intensityFBO.dispose(),this._intensityFBO=null),this._compositeFBO&&(this._compositeFBO.dispose(),this._compositeFBO=null),this._mipsFBOs){for(let t=0;t<this._nMips;t++)this._mipsFBOs[t]&&(this._mipsFBOs[t].horizontal.dispose(),this._mipsFBOs[t].vertical.dispose());this._mipsFBOs=null}}draw(t,e,i){const{width:s,height:r}=e,{context:n,painter:a}=t,{materialManager:o}=a,l=n.gl,h=this._programDesc,{strength:u,radius:c,threshold:d}=i;this._quad||(this._quad=new fe.Z(n,[-1,-1,1,-1,-1,1,1,1])),this._createOrResizeResources(t,s,r),n.setStencilTestEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunction(H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA),n.setStencilWriteMask(0);const _=this._quad;_.bind(),n.bindFramebuffer(this._intensityFBO);const f=o.getProgram(t,h.luminosityHighPass);n.useProgram(f),n.bindTexture(e.colorTexture,0),f.setUniform1i("u_texture",0),f.setUniform3fv("u_defaultColor",[0,0,0]),f.setUniform1f("u_defaultOpacity",0),f.setUniform1f("u_luminosityThreshold",d),f.setUniform1f("u_smoothWidth",.01);const p=[Math.round(s/2),Math.round(r/2)];n.setViewport(0,0,p[0],p[1]),n.setClearColor(0,0,0,0),n.clear(l.COLOR_BUFFER_BIT),_.draw(),n.setBlendingEnabled(!1);let m=this._intensityFBO.colorTexture;for(let v=0;v<this._nMips;v++){const e=o.getProgram(t,h.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[v]}]);n.useProgram(e),n.bindTexture(m,v+1),e.setUniform1i("u_colorTexture",v+1),e.setUniform2fv("u_texSize",p),e.setUniform2fv("u_direction",He),n.setViewport(0,0,p[0],p[1]);const i=this._mipsFBOs[v];n.bindFramebuffer(i.horizontal),_.draw(),m=i.horizontal.colorTexture,n.bindFramebuffer(i.vertical),n.bindTexture(m,v+1),e.setUniform2fv("u_direction",qe),_.draw(),m=i.vertical.colorTexture,p[0]=Math.round(p[0]/2),p[1]=Math.round(p[1]/2)}n.setViewport(0,0,s,r);const g=o.getProgram(t,h.composite,[{name:"nummips",value:Xe}]);n.bindFramebuffer(this._compositeFBO),n.useProgram(g),g.setUniform1f("u_bloomStrength",u),g.setUniform1f("u_bloomRadius",c),g.setUniform1fv("u_bloomFactors",Ze),g.setUniform3fv("u_bloomTintColors",Ye),n.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1),g.setUniform1i("u_blurTexture1",1),n.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2),g.setUniform1i("u_blurTexture2",2),n.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3),g.setUniform1i("u_blurTexture3",3),n.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4),g.setUniform1i("u_blurTexture4",4),n.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5),g.setUniform1i("u_blurTexture5",5),_.draw(),n.bindFramebuffer(e),n.setBlendingEnabled(!0);const b=o.getProgram(t,h.blit);n.useProgram(b),n.bindTexture(this._compositeFBO.colorTexture,6),b.setUniform1i("u_texture",6),n.setBlendFunction(H.zi.ONE,H.zi.ONE),_.draw(),_.unbind(),n.setBlendFunction(H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA),n.setStencilTestEnabled(!0)}_createOrResizeResources(t,e,i){const{context:s}=t;if(this._compositeFBO&&this._size[0]===e&&this._size[1]===i)return;this._size[0]=e,this._size[1]=i;const r=[Math.round(e/2),Math.round(i/2)];this._compositeFBO?this._compositeFBO.resize(e,i):this._compositeFBO=new Ne.X(s,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.NONE,width:e,height:i}),this._intensityFBO?this._intensityFBO.resize(r[0],r[1]):this._intensityFBO=new Ne.X(s,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.NONE,width:r[0],height:r[1]},{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,internalFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.LINEAR,flipped:!1,width:r[0],height:r[1]});for(let n=0;n<this._nMips;n++)this._mipsFBOs[n]?(this._mipsFBOs[n].horizontal.resize(r[0],r[1]),this._mipsFBOs[n].vertical.resize(r[0],r[1])):this._mipsFBOs[n]={horizontal:new Ne.X(s,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.NONE,width:r[0],height:r[1]},{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,internalFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.LINEAR,flipped:!1,width:r[0],height:r[1]}),vertical:new Ne.X(s,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.NONE,width:r[0],height:r[1]},{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,internalFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.LINEAR,flipped:!1,width:r[0],height:r[1]})},r[0]=Math.round(r[0]/2),r[1]=Math.round(r[1]/2)}}const Ke=[1,0],$e=[0,1];class Qe{constructor(){this._blurFBO=null,this._size=[0,0],this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}draw(t,e,i){const{context:s}=t,{type:r,radius:n}=i;if(0===n)return;this._createOrResizeResources(t),this._quad||(this._quad=new fe.Z(s,[-1,-1,1,-1,-1,1,1,1]));const a=this._quad;a.bind(),"blur"===r?this._gaussianBlur(t,e,n):this._radialBlur(t,e),a.unbind()}_gaussianBlur(t,e,i){const{context:s,state:r,painter:n,pixelRatio:a}=t,{size:o}=r,{materialManager:l}=n,h=this._programDesc,u=this._quad,c=[Math.round(a*o[0]),Math.round(a*o[1])],d=this._blurFBO,_=l.getProgram(t,h.gaussianBlur,[{name:"radius",value:Math.ceil(i)}]);s.useProgram(_),s.setBlendingEnabled(!1),s.bindFramebuffer(d),s.bindTexture(e.colorTexture,4),_.setUniform1i("u_colorTexture",4),_.setUniform2fv("u_texSize",c),_.setUniform2fv("u_direction",Ke),_.setUniform1f("u_sigma",i),u.draw(),s.bindFramebuffer(e),s.setStencilWriteMask(0),s.setStencilTestEnabled(!1),s.setDepthWriteEnabled(!1),s.setDepthTestEnabled(!1),s.bindTexture(d.colorTexture,5),_.setUniform1i("u_colorTexture",5),_.setUniform2fv("u_direction",$e),u.draw(),s.setBlendingEnabled(!0),s.setBlendFunction(H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA),s.setStencilTestEnabled(!0)}_radialBlur(t,e){const{context:i,painter:s}=t,{materialManager:r}=s,n=this._programDesc,a=this._quad,o=this._blurFBO;i.bindFramebuffer(o);const l=r.getProgram(t,n.radialBlur);i.useProgram(l),i.setBlendingEnabled(!1),i.bindTexture(e.colorTexture,4),l.setUniform1i("u_colorTexture",4),a.draw(),i.bindFramebuffer(e),i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1),i.setBlendingEnabled(!0);const h=r.getProgram(t,n.blit);i.useProgram(h),i.bindTexture(o.colorTexture,5),h.setUniform1i("u_texture",5),i.setBlendFunction(H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA),a.draw()}_createOrResizeResources(t){const{context:e,state:i,pixelRatio:s}=t,{size:r}=i,n=Math.round(s*r[0]),a=Math.round(s*r[1]);this._blurFBO&&this._size[0]===n&&this._size[1]===a||(this._size[0]=n,this._size[1]=a,this._blurFBO?this._blurFBO.resize(n,a):this._blurFBO=new Ne.X(e,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.NONE,width:n,height:a},{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,internalFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.LINEAR,flipped:!1,width:n,height:a}))}}class Je{constructor(){this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",attributes:new Map([["a_position",0]])}}dispose(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null)}draw(t,e,i){const{width:s,height:r}=e;this._createOrResizeResources(t,s,r);const{context:n,painter:a}=t,{materialManager:o}=a,l=this._programDesc,h=this._quad,u=i.colorMatrix;h.bind();const c=this._layerFBOTexture;n.bindFramebuffer(e),e.copyToTexture(0,0,s,r,0,0,c),n.setBlendingEnabled(!1),n.setStencilTestEnabled(!1);const d=o.getProgram(t,l);n.useProgram(d),n.bindTexture(c,2),d.setUniformMatrix4fv("u_coefficients",u),d.setUniform1i("u_colorTexture",2),h.draw(),n.setBlendingEnabled(!0),n.setBlendFunction(H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA),n.setStencilTestEnabled(!0),h.unbind()}_createOrResizeResources(t,e,i){const{context:s}=t;this._layerFBOTexture&&this._size[0]===e&&this._size[1]===i||(this._size[0]=e,this._size[1]=i,this._layerFBOTexture?this._layerFBOTexture.resize(e,i):this._layerFBOTexture=new pt.x(s,{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,internalFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.LINEAR,flipped:!1,width:e,height:i}),this._quad||(this._quad=new fe.Z(s,[-1,-1,1,-1,-1,1,1,1])))}}const ti=[1,0],ei=[0,1];class ii{constructor(){this._horizontalBlurFBO=null,this._verticalBlurFBO=null,this._size=[0,0],this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}dispose(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null),this._horizontalBlurFBO&&(this._horizontalBlurFBO.dispose(),this._horizontalBlurFBO=null),this._verticalBlurFBO&&(this._verticalBlurFBO.dispose(),this._verticalBlurFBO=null)}draw(t,e,i){const{context:s,state:r,painter:n}=t,{materialManager:a}=n,o=this._programDesc,l=e.width,h=e.height,u=[Math.round(l/2),Math.round(h/2)],{blurRadius:c,offsetX:d,offsetY:_,color:f}=i,p=[(0,lt.F2)(d/2),(0,lt.F2)(_/2)];this._createOrResizeResources(t,l,h,u);const m=this._horizontalBlurFBO,g=this._verticalBlurFBO;s.setStencilWriteMask(0),s.setStencilTestEnabled(!1),s.setDepthWriteEnabled(!1),s.setDepthTestEnabled(!1);const b=this._layerFBOTexture;e.copyToTexture(0,0,l,h,0,0,b),this._quad||(this._quad=new fe.Z(s,[-1,-1,1,-1,-1,1,1,1])),s.setViewport(0,0,u[0],u[1]);const v=this._quad;v.bind(),s.setBlendingEnabled(!1);const E=a.getProgram(t,o.blur,[{name:"radius",value:Math.ceil(c)}]);s.useProgram(E),s.bindFramebuffer(m),s.bindTexture(e.colorTexture,4),E.setUniform1i("u_colorTexture",4),E.setUniform2fv("u_texSize",u),E.setUniform2fv("u_direction",ti),E.setUniform1f("u_sigma",c),v.draw(),s.bindFramebuffer(g),s.bindTexture(m.colorTexture,5),E.setUniform1i("u_colorTexture",5),E.setUniform2fv("u_direction",ei),v.draw(),s.bindFramebuffer(e),s.setViewport(0,0,l,h);const T=a.getProgram(t,o.composite);s.useProgram(T),s.bindTexture(g.colorTexture,2),T.setUniform1i("u_blurTexture",2),s.bindTexture(b,3),T.setUniform1i("u_layerFBOTexture",3),T.setUniform4fv("u_shadowColor",[f[3]*(f[0]/255),f[3]*(f[1]/255),f[3]*(f[2]/255),f[3]]),T.setUniformMatrix3fv("u_displayViewMat3",r.displayMat3),T.setUniform2fv("u_shadowOffset",p),v.draw(),s.setBlendingEnabled(!0),s.setStencilTestEnabled(!0),s.setBlendFunction(H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA),v.unbind()}_createOrResizeResources(t,e,i,s){const{context:r}=t;this._horizontalBlurFBO&&this._size[0]===e&&this._size[1]===i||(this._size[0]=e,this._size[1]=i,this._horizontalBlurFBO?this._horizontalBlurFBO.resize(s[0],s[1]):this._horizontalBlurFBO=new Ne.X(r,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.NONE,width:s[0],height:s[1]},{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,internalFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.LINEAR,flipped:!1,width:s[0],height:s[1]}),this._verticalBlurFBO?this._verticalBlurFBO.resize(s[0],s[1]):this._verticalBlurFBO=new Ne.X(r,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.NONE,width:s[0],height:s[1]},{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,internalFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.LINEAR,flipped:!1,width:s[0],height:s[1]}),this._layerFBOTexture?this._layerFBOTexture.resize(e,i):this._layerFBOTexture=new pt.x(r,{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,internalFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.LINEAR,flipped:!1,width:e,height:i}))}}class si{constructor(){this._size=[0,0]}dispose(){this._layerFBOTexture&&(this._layerFBOTexture.dispose(),this._layerFBOTexture=null)}draw(t,e,i){const{width:s,height:r}=e;this._createOrResizeResources(t,s,r);const{context:n,painter:a}=t,{amount:o}=i,l=n.gl,h=this._layerFBOTexture;n.bindFramebuffer(e),e.copyToTexture(0,0,s,r,0,0,h),n.setBlendingEnabled(!0),n.setStencilTestEnabled(!1),n.setDepthTestEnabled(!1),n.setClearColor(0,0,0,0),n.clear(l.COLOR_BUFFER_BIT),a.blitTexture(n,h,H.cw.NEAREST,o)}_createOrResizeResources(t,e,i){const{context:s}=t;this._layerFBOTexture&&this._size[0]===e&&this._size[1]===i||(this._size[0]=e,this._size[1]=i,this._layerFBOTexture?this._layerFBOTexture.resize(e,i):this._layerFBOTexture=new pt.x(s,{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,internalFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.NEAREST,flipped:!1,width:e,height:i}))}}function ri(t){switch(t){case"bloom":case"blur":case"opacity":case"drop-shadow":return t;default:return"colorize"}}const ni={colorize:()=>new Je,blur:()=>new Qe,bloom:()=>new je,opacity:()=>new si,"drop-shadow":()=>new ii};class ai{constructor(t){this._requestRender=t,this._effectMap=new Map}dispose(){this._requestRender&&(this._requestRender=null),this._effectMap.forEach((t=>t.dispose())),this._effectMap.clear()}getPostProcessingEffects(t){if(!t||0===t.length)return[];const e=[];for(const i of t){const t=ri(i.type);let s=this._effectMap.get(t);s||(s=ni[t](),this._effectMap.set(t,s)),e.push({postProcessingEffect:s,effect:i})}return e}}var oi=i(15055);class li{constructor(t,e){var i;this.brushes=t,this.name=e.name,this.drawPhase=e.drawPhase||g.jx.MAP,this._targetFn=e.target,this.effects=e.effects||[],this.enableDefaultDraw=null!=(i=e.enableDefaultDraw)?i:()=>!0}render(t){const{context:e,profiler:i}=t,s=this._targetFn(),r=this.drawPhase&t.drawPhase;if(i.recordPassStart(this.name),r){this.enableDefaultDraw()&&this._doRender(t,s),i.recordPassEnd();for(const r of this.effects){if(!r.enable())continue;const n=r.apply;i.recordPassStart(this.name+"."+n.name),i.recordBrushStart(n.name);const a=r.args&&r.args(),{x:o,y:l,width:h,height:u}=e.getViewport(),c=e.getBoundFramebufferObject();n.bind(t,a);const d=n.createOptions(t,a),_=t.passOptions;t.passOptions=d,this._doRender(t,s,n.defines),t.passOptions=_,n.draw(t,a),n.unbind(t,a),e.bindFramebuffer(c),e.setViewport(o,l,h,u),i.recordBrushEnd(),i.recordPassEnd()}}}_doRender(t,e,i){if(!(0,a.Wi)(e))if((0,oi.zG)(e)){for(const s of e)if(s.visible)for(const e of this.brushes)t.profiler.recordBrushStart(e.name),e.prepareState(t,s,i),e.draw(t,s,i),t.profiler.recordBrushEnd()}else for(const s of this.brushes)t.profiler.recordBrushStart(s.name),s.prepareState(t,e,i),s.draw(t,e,i),t.profiler.recordBrushEnd()}}var hi=i(5802);const ui={[g.LW.FILL]:b.U.fill,[g.LW.LINE]:b.U.line,[g.LW.MARKER]:b.U.marker,[g.LW.TEXT]:b.U.text};class ci{constructor(t,e,i){this.context=t,this._blitRenderer=new Y,this._brushCache=new Map,this._vtlMaterialManager=new G,this._blendEffect=new Te,this._fboPool=[],this.effects={highlight:new ke,hittest:new Ve,hittestVTL:new We,integrate:new me,insideEffect:new we("inside"),outsideEffect:new we("outside")},this.materialManager=new it(t),this.textureManager=new _e(e,i),this._effectsManager=new ai(e)}get vectorTilesMaterialManager(){return this._vtlMaterialManager}getRenderTarget(){return this._renderTarget}setRenderTarget(t){this._renderTarget=t}getFbos(t,e){if(t!==this._lastWidth||e!==this._lastHeight){if(this._lastWidth=t,this._lastHeight=e,this._fbos){for(const i in this._fbos)this._fbos[i].resize(t,e);return this._fbos}const i={target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,samplingMode:H.cw.NEAREST,wrapMode:H.e8.CLAMP_TO_EDGE,width:t,height:e},s={colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.DEPTH_STENCIL_RENDER_BUFFER},r=new hi.r(this.context,{width:t,height:e,internalFormat:H.Tg.DEPTH_STENCIL});this._stencilBuf=r,this._fbos={output:new Ne.X(this.context,s,i,r),blend:new Ne.X(this.context,s,i,r),effect0:new Ne.X(this.context,s,i,r)}}return this._fbos}acquireFbo(t,e){let i;i=this._fboPool.length>0?this._fboPool.pop():new Ne.X(this.context,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.DEPTH_STENCIL_RENDER_BUFFER},{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,samplingMode:H.cw.NEAREST,wrapMode:H.e8.CLAMP_TO_EDGE,width:t,height:e},this._stencilBuf);const s=i.descriptor;return s.width===t&&s.height===e||i.resize(t,e),i}releaseFbo(t){this._fboPool.push(t)}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderLayers(t,e=null){const{width:i,height:s}=t.getViewport();this._prevFBO=t.getBoundFramebufferObject();const r=this.getFbos(i,s);if(t.bindFramebuffer(r.output),t.setColorMask(!0,!0,!0,!0),t.setDepthWriteEnabled(!0),(0,a.pC)(e)){const{r:i,g:s,b:r,a:n}=e.color;t.setClearColor(n*i/255,n*s/255,n*r/255,n)}else t.setClearColor(0,0,0,0);t.setClearDepth(1),t.clear(t.gl.COLOR_BUFFER_BIT|t.gl.DEPTH_BUFFER_BIT),t.setDepthWriteEnabled(!1)}beforeRenderLayer(t,e,i){const{context:s,blendMode:r,effects:n,requireFBO:a,drawPhase:o}=t;if(a||di(o,r,n,i))s.bindFramebuffer(this._fbos.blend),s.setColorMask(!0,!0,!0,!0),s.setClearColor(0,0,0,0),s.setDepthWriteEnabled(!0),s.setClearDepth(1),s.clear(s.gl.COLOR_BUFFER_BIT|s.gl.DEPTH_BUFFER_BIT),s.setDepthWriteEnabled(!1);else{const t=this._getOutputFBO();s.bindFramebuffer(t)}s.setDepthWriteEnabled(!1),s.setDepthTestEnabled(!1),s.setStencilTestEnabled(!0),s.setClearStencil(e),s.setStencilWriteMask(255),s.clear(s.gl.STENCIL_BUFFER_BIT)}compositeLayer(t,e){const{context:i,blendMode:s,effects:r,requireFBO:n,drawPhase:o}=t;if(n||di(o,s,r,e)){(0,a.pC)(r)&&r.length>0&&o===g.jx.MAP&&this._applyEffects(t,r);const n=this._getOutputFBO();i.bindFramebuffer(n),i.setStencilTestEnabled(!1),i.setStencilWriteMask(0),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA,H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA),i.setColorMask(!0,!0,!0,!0);const l=(0,a.Wi)(s)||o===g.jx.HIGHLIGHT?"normal":s;this._blendEffect.draw(t,this._fbos.blend.colorTexture,H.cw.NEAREST,l,e)}}renderLayers(t){if(t.bindFramebuffer(this._prevFBO),!this._fbos)return;const e=this._getOutputFBO();t.setStencilTestEnabled(!1),t.setStencilWriteMask(0),this.blitTexture(t,e.colorTexture,H.cw.NEAREST)}dispose(){if(this.materialManager.dispose(),this.textureManager.dispose(),this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null),this._brushCache&&(this._brushCache.forEach((t=>t.dispose())),this._brushCache.clear(),this._brushCache=null),this._fbos)for(const t in this._fbos)this._fbos[t]&&this._fbos[t].dispose();for(const t of this._fboPool)t.dispose();if(this._fboPool.length=0,this.effects)for(const t in this.effects)this.effects[t]&&this.effects[t].dispose();this._effectsManager.dispose(),this._vtlMaterialManager&&(this._vtlMaterialManager.dispose(),this._vtlMaterialManager=null),this._prevFBO=null}getGeometryBrush(t){const e=ui[t];let i=this._brushCache.get(e);return void 0===i&&(i=new e,this._brushCache.set(e,i)),this._brushCache.get(e)}renderObject(t,e,i,s){const r=b.U[i];if(!r)return null;let n=this._brushCache.get(r);void 0===n&&(n=new r,this._brushCache.set(r,n)),n.prepareState(t,e,s),n.draw(t,e,s)}renderObjects(t,e,i,s){const r=b.U[i];if(!r)return null;let n=this._brushCache.get(r);void 0===n&&(n=new r,this._brushCache.set(r,n)),n.drawMany(t,e,s)}registerRenderPass(t){const e=t.brushes.map((t=>(this._brushCache.has(t)||this._brushCache.set(t,new t),this._brushCache.get(t))));return new li(e,t)}setHighlightOptions(t){this.effects.highlight.setHighlightOptions(t)}blitTexture(t,e,i,s=1){t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA,H.zi.ONE,H.zi.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(t,e,i,s)}getPostProcessingEffects(t){return this._effectsManager.getPostProcessingEffects(t)}_getOutputFBO(){return null!=this._renderTarget?this._renderTarget:this._fbos.output}_applyEffects(t,e){const{context:i}=t,s=this._effectsManager.getPostProcessingEffects(e);for(const{postProcessingEffect:r,effect:n}of s)i.bindFramebuffer(this._fbos.blend),r.draw(t,this._fbos.blend,n)}}function di(t,e,i,s){return t!==g.jx.HIGHLIGHT&&(1!==s||(0,a.pC)(e)&&"normal"!==e||(0,a.pC)(i)&&i.length>0)}var _i=i(18548),fi=i(96545),pi=i(79235);class mi{constructor(t,e,i,s,r,n,a,o){this.createQuery=t,this.resultAvailable=e,this.getResult=i,this.disjoint=s,this.beginTimeElapsed=r,this.endTimeElapsed=n,this.createTimestamp=a,this.timestampBits=o}}function gi(t,e){if(e.disjointTimerQuery)return null;let i=t.getExtension("EXT_disjoint_timer_query_webgl2");return i&&(0,pi.Z)(t)?new mi((()=>t.createQuery()),(e=>t.getQueryParameter(e,t.QUERY_RESULT_AVAILABLE)),(e=>t.getQueryParameter(e,t.QUERY_RESULT)),(()=>t.getParameter(i.GPU_DISJOINT_EXT)),(e=>t.beginQuery(i.TIME_ELAPSED_EXT,e)),(()=>t.endQuery(i.TIME_ELAPSED_EXT)),(t=>i.queryCounterEXT(t,i.TIMESTAMP_EXT)),(()=>t.getQuery(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT))):(i=t.getExtension("EXT_disjoint_timer_query"),i?new mi((()=>i.createQueryEXT()),(t=>i.getQueryObjectEXT(t,i.QUERY_RESULT_AVAILABLE_EXT)),(t=>i.getQueryObjectEXT(t,i.QUERY_RESULT_EXT)),(()=>t.getParameter(i.GPU_DISJOINT_EXT)),(t=>i.beginQueryEXT(i.TIME_ELAPSED_EXT,t)),(()=>i.endQueryEXT(i.TIME_ELAPSED_EXT)),(t=>i.queryCounterEXT(t,i.TIMESTAMP_EXT)),(()=>i.getQueryEXT(i.TIMESTAMP_EXT,i.QUERY_COUNTER_BITS_EXT))):null)}const bi=(0,n.Z)("esri-2d-profiler");class vi{constructor(t,e){if(this._events=new fi.Z,this._entries=new Map,this._timings=new _i.Z(10),!bi)return;this._ext=gi(t.gl,{}),this._debugOutput=e;const i=t.gl;if(this.enableCommandLogging)for(const s in i)if("function"==typeof i[s]){const t=i[s],e=-1!==s.indexOf("draw");i[s]=(...r)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:s,args:r,isDrawCommand:e}),this._currentSummary&&(this._currentSummary.commands++,e&&this._currentSummary.drawCommands++),t.apply(i,r))}}get enableCommandLogging(){return!("object"==typeof bi&&bi.disableCommands)}recordContainerStart(t){bi&&(this._currentContainer=t)}recordContainerEnd(){bi&&(this._currentContainer=null)}recordPassStart(t){bi&&(this._currentPass=t,this._initSummary())}recordPassEnd(){bi&&(this._currentPass=null,this._emitSummary())}recordBrushStart(t){bi&&(this._currentBrush=t)}recordBrushEnd(){bi&&(this._currentBrush=null)}recordStart(t){if(bi&&(0,a.pC)(this._ext)){if(this._entries.has(t)){const e=this._entries.get(t),i=this._ext.resultAvailable(e.query),s=this._ext.disjoint();if(i&&!s){const i=this._ext.getResult(e.query)/1e6;let s=0;if((0,a.pC)(this._timings.enqueue(i))){const t=this._timings.entries,e=t.length;let i=0;for(const s of t)i+=s;s=i/e}const r=i.toFixed(2),n=s?s.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${t}, ${r} ms (${n} last 10 avg)\n${e.commandsLen} Commands (${e.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(e.summaries),console.log("Commands: ",e.commands),console.groupEnd()):console.log(`Frame report for ${t}, ${r} ms (${n} last 10 avg)`),this._debugOutput.innerHTML=`${r} (${n})`}for(const t of e.handles)t.remove();this._entries.delete(t)}const e={name:t,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(e.handles.push(this._events.on("command",(t=>{e.commandsLen++,e.commands.push(t),t.isDrawCommand&&e.drawCommands++}))),e.handles.push(this._events.on("summary",(t=>{e.summaries.push(t)})))),this._ext.beginTimeElapsed(e.query),this._entries.set(t,e)}}recordEnd(t){bi&&(0,a.pC)(this._ext)&&this._entries.has(t)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._events.emit("summary",this._currentSummary)}}const Ei={shaders:{vertexShader:(0,V.w)("stencil/stencil.vert"),fragmentShader:(0,V.w)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])};var Ti=i(61736),wi=i(80886),xi=i(24522),yi=i(130),Ri=i(58523),Fi=(i(81479),i(14843));class Bi{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:H.zi.ONE,dstRGB:H.zi.ZERO,srcAlpha:H.zi.ONE,dstAlpha:H.zi.ZERO},this.blendEquation={mode:H.db.ADD,modeAlpha:H.db.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=H.LR.BACK,this.frontFace=H.Wf.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=H.wb.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:H.LR.FRONT_AND_BACK,func:H.wb.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:H.LR.FRONT_AND_BACK,fail:H.xS.KEEP,zFail:H.xS.KEEP,zPass:H.xS.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class Ci{constructor(t){this._allocations=new Map,t?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(t){this._allocations.set(t,(new Error).stack)}remove(t){this._allocations.delete(t)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const t=new Map;this._allocations.forEach((e=>{var i;t.set(e,(null!=(i=t.get(e))?i:0)+1)})),t.forEach(((t,e)=>{const i=e.split("\n");i.shift(),i.shift(),console.log(`${t}: ${i.shift()}`),i.forEach((t=>console.log("   ",t)))}))}}}class Ai{constructor(){this.RECORD_ALLOCATIONS=!1}}const Si=new Ai;class Oi{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new Ci(Si.RECORD_ALLOCATIONS);this._current.length<H._g.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(t,e){const i=++this._current[t];this._max[t]=Math.max(i,this._max[t]),this._allocations.add(e)}decrement(t,e){--this._current[t],this._allocations.remove(e)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce(((t,e)=>t+e),0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let t=0;t<H._g.COUNT;++t){const e=this._current[t];e>0&&console.log(`${H._g[t]}: ${e}`)}}this._allocations.print()}}var Mi=i(9408),Ii=i(33900),Pi=i(74674),Di=i(12470);function Ni(t,e){const i=new Ne.X(t,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.NONE},{target:H.No.TEXTURE_2D,wrapMode:H.e8.CLAMP_TO_EDGE,pixelFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,samplingMode:H.cw.NEAREST,width:1,height:1});function s(i,s){const r=`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,n="\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",a=t.programCache.acquire(r,n,new Map([["position",0]])),o=new Float32Array(6);(0,Di.LF)(i,o,3);const l=new Float32Array(6);return(0,Di.LF)(s,l,3),t.useProgram(a),a.setUniform3f("u_highA",o[0],o[2],o[4]),a.setUniform3f("u_lowA",o[1],o[3],o[5]),a.setUniform3f("u_highB",l[0],l[2],l[4]),a.setUniform3f("u_lowB",l[1],l[3],l[5]),a}const r=X.f.createVertex(t,H.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),n=new Z.U(t,new Map([["position",0]]),{geometry:[new Pe.G("position",2,H.g.UNSIGNED_SHORT,0,4)]},{geometry:r}),a=(0,Pi.f)(5633261.287538229,2626832.878767164,1434988.0495278358),o=(0,Pi.f)(5633271.46742708,2626873.6381334523,1434963.231608387),l=s(a,o),h=t.getBoundFramebufferObject(),{x:u,y:c,width:d,height:_}=t.getViewport();t.bindFramebuffer(i),t.setViewport(0,0,1,1),t.bindVAO(n),t.drawArrays(H.MX.TRIANGLE_STRIP,0,4);const f=new Uint8Array(4);i.readPixels(0,0,1,1,H.VI.RGBA,H.Br.UNSIGNED_BYTE,f),l.dispose(),n.dispose(!1),r.dispose(),i.dispose(),t.setViewport(u,c,d,_),t.bindFramebuffer(h);const p=(a[2]-o[2])/25,m=(0,Ft.v)(f);return Math.abs(p-m)}var Ui,Li,zi,Gi=i(25749),ki={exports:{}};function Vi(t){var e,i,s,r,n;if(!t.gl)return!1;if(t.type===xi.zO.WEBGL1)return!(null==(r=t.capabilities.textureFloat)||!r.textureFloat||null==(n=t.capabilities.colorBufferFloat)||!n.textureFloat);if(!((null==(e=t.capabilities.textureFloat)?void 0:e.textureFloat)&&(null==(i=t.capabilities.colorBufferFloat)?void 0:i.textureFloat)&&(null==(s=t.capabilities.colorBufferFloat)?void 0:s.floatBlend)))return!1;const a=new Ne.X(t,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.NONE},{target:H.No.TEXTURE_2D,wrapMode:H.e8.CLAMP_TO_EDGE,pixelFormat:H.VI.RGBA,dataType:H.Br.FLOAT,internalFormat:H.lP.RGBA32F,samplingMode:H.cw.NEAREST,width:1,height:1}),o=X.f.createVertex(t,H.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),l=new Z.U(t,new Map([["a_pos",0]]),{geometry:[new Pe.G("a_pos",2,H.g.UNSIGNED_SHORT,0,4)]},{geometry:o}),h="\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ",u="\n   precision highp float;\n\n   void main() {\n    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",c=t.programCache.acquire(h,u,new Map([["a_pos",0]]));t.useProgram(c);const d=t.getBoundFramebufferObject(),{x:_,y:f,width:p,height:m}=t.getViewport();t.bindFramebuffer(a),t.setViewport(0,0,1,1),t.bindVAO(l),t.drawArrays(H.MX.TRIANGLE_STRIP,0,4);const g=(0,Mi.sm)({blending:Gi.IB});t.setPipelineState(g),t.drawArrays(H.MX.TRIANGLE_STRIP,0,4),ki.exports.init(t);const b=t.gl.getError();return t.setViewport(_,f,p,m),t.bindFramebuffer(d),c.dispose(),l.dispose(!1),o.dispose(),a.dispose(),1282!==b||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}Ui=ki,Li=function(){var t=function(t){window.console&&window.console.log&&window.console.log(t)},e=function(e){window.console&&window.console.error?window.console.error(e):t(e)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},s=null,r=null;function n(t){if(null==s)for(var e in s={},r={},t)"number"==typeof t[e]&&(s[t[e]]=e,r[e]=t[e])}function a(){if(null==s)throw"WebGLDebugUtils.init(ctx) not called"}function o(t){return a(),void 0!==s[t]}function l(t){a();var e=s[t];return void 0!==e?"gl."+e:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function h(t,e,s,n){var a;if(void 0!==(a=i[t])&&void 0!==(a=a[e])&&a[s]){if("object"==typeof a[s]&&void 0!==a[s].enumBitwiseOr){for(var o=a[s].enumBitwiseOr,h=0,u=[],c=0;c<o.length;++c){var d=r[o[c]];0!=(n&d)&&(h|=d,u.push(l(d)))}return h===n?u.join(" | "):l(n)}return l(n)}return null===n?"null":void 0===n?"undefined":n.toString()}function u(t,e){for(var i="",s=e.length,r=0;r<s;++r)i+=(0==r?"":", ")+h(t,s,r,e[r]);return i}function c(t,e,i){t.__defineGetter__(i,(function(){return e[i]})),t.__defineSetter__(i,(function(t){e[i]=t}))}function d(t,i,s,r){r=r||t,n(t),i=i||function(t,i,s){for(var r="",n=s.length,a=0;a<n;++a)r+=(0==a?"":", ")+h(i,n,a,s[a]);e("WebGL error "+l(t)+" in "+i+"("+r+")")};var a={};function o(t,e){return function(){s&&s(e,arguments);var n=t[e].apply(t,arguments),o=r.getError();return 0!=o&&(a[o]=!0,i(o,e,arguments)),n}}var u={};for(var _ in t)if("function"==typeof t[_])if("getExtension"!=_)u[_]=o(t,_);else{var f=o(t,_);u[_]=function(){return d(f.apply(t,arguments),i,s,r)}}else c(u,t,_);return u.getError=function(){for(var e in a)if(a.hasOwnProperty(e)&&a[e])return a[e]=!1,e;return t.NO_ERROR},u}function _(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);for(var s=0;s<e;++s)t.disableVertexAttribArray(s),t.vertexAttribPointer(s,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(s,0);t.deleteBuffer(i);var r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);for(s=0;s<r;++s)t.activeTexture(t.TEXTURE0+s),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}function f(t){var e,i,s=[],r=[],n={},a=1,o=!1,l=[],h=0,u=0,d=!1,f=0,p={};function m(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}t.getContext=(i=t.getContext,function(){var s=i.apply(t,arguments);if(s instanceof WebGLRenderingContext){if(s!=e){if(e)throw"got different context";n=R(e=s)}return n}return s});var g=function(t){s.push(m(t))},b=function(t){r.push(m(t))};function v(t){var e=t.addEventListener;t.addEventListener=function(i,s,r){switch(i){case"webglcontextlost":g(s);break;case"webglcontextrestored":b(s);break;default:e.apply(t,arguments)}}}function E(){for(var t=Object.keys(p),e=0;e<t.length;++e)delete p[t]}function T(){++u,o||h==u&&t.loseContext()}function w(t,e){var i=t[e];return function(){if(T(),!o)return i.apply(t,arguments)}}function x(){for(var t=0;t<l.length;++t){var i=l[t];i instanceof WebGLBuffer?e.deleteBuffer(i):i instanceof WebGLFramebuffer?e.deleteFramebuffer(i):i instanceof WebGLProgram?e.deleteProgram(i):i instanceof WebGLRenderbuffer?e.deleteRenderbuffer(i):i instanceof WebGLShader?e.deleteShader(i):i instanceof WebGLTexture&&e.deleteTexture(i)}}function y(t){return{statusMessage:t,preventDefault:function(){d=!0}}}return v(t),t.loseContext=function(){if(!o){for(o=!0,h=0,++a;e.getError(););E(),p[e.CONTEXT_LOST_WEBGL]=!0;var i=y("context lost"),r=s.slice();setTimeout((function(){for(var e=0;e<r.length;++e)r[e](i);f>=0&&setTimeout((function(){t.restoreContext()}),f)}),0)}},t.restoreContext=function(){o&&r.length&&setTimeout((function(){if(!d)throw"can not restore. webglcontestlost listener did not call event.preventDefault";x(),_(e),o=!1,u=0,d=!1;for(var t=r.slice(),i=y("context restored"),s=0;s<t.length;++s)t[s](i)}),0)},t.loseContextInNCalls=function(t){if(o)throw"You can not ask a lost contet to be lost";h=u+t},t.getNumCalls=function(){return u},t.setRestoreTimeout=function(t){f=t},t;function R(t){for(var i in t)"function"==typeof t[i]?n[i]=w(t,i):c(n,t,i);n.getError=function(){if(T(),!o)for(;t=e.getError();)p[t]=!0;for(var t in p)if(p[t])return delete p[t],t;return n.NO_ERROR};for(var s=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],r=0;r<s.length;++r){var h=s[r];n[h]=function(e){return function(){if(T(),o)return null;var i=e.apply(t,arguments);return i.__webglDebugContextLostId__=a,l.push(i),i}}(t[h])}var u=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(r=0;r<u.length;++r)h=u[r],n[h]=function(e){return function(){return T(),o?null:e.apply(t,arguments)}}(n[h]);var d=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(r=0;r<d.length;++r)h=d[r],n[h]=function(e){return function(){return T(),!o&&e.apply(t,arguments)}}(n[h]);return n.checkFramebufferStatus=function(e){return function(){return T(),o?n.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(n.checkFramebufferStatus),n.getAttribLocation=function(e){return function(){return T(),o?-1:e.apply(t,arguments)}}(n.getAttribLocation),n.getVertexAttribOffset=function(e){return function(){return T(),o?0:e.apply(t,arguments)}}(n.getVertexAttribOffset),n.isContextLost=function(){return o},n}}return{init:n,mightBeEnum:o,glEnumToString:l,glFunctionArgToString:h,glFunctionArgsToString:u,makeDebugContext:d,makeLostContextSimulatingCanvas:f,resetToInitialState:_}},void 0!==(zi=Li())&&(Ui.exports=zi);const Wi=at.Z.getLogger("esri.views.WebGLDriverTest");function Xi(t){const e=new Ne.X(t,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.NONE},{target:H.No.TEXTURE_2D,wrapMode:H.e8.CLAMP_TO_EDGE,pixelFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,samplingMode:H.cw.NEAREST,width:1,height:1}),i="\nprecision highp float;\nattribute vec2 a_pos;\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset = pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value = texture2D(u_texture, vec2(0.0));\n  float bit = getBit(value.x * 255.0, 1);\n\n  v_color = bit * vec4(1.0);\n  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n",s="\nprecision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}\n",r=new Uint8Array(4),n=X.f.createVertex(t,H.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new Z.U(t,new Map([["a_position",0]]),{geometry:[new Pe.G("a_position",2,H.g.SHORT,0,4)]},{geometry:n}),o=t.programCache.acquire(i,s,new Map([["a_pos",0]]));t.useProgram(o);const l=new pt.x(t,{target:H.No.TEXTURE_2D,wrapMode:H.e8.CLAMP_TO_EDGE,pixelFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,samplingMode:H.cw.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));o.setUniform1i("u_texture",0),t.bindTexture(l,0);const h=t.getBoundFramebufferObject();t.bindFramebuffer(e),t.useProgram(o);const{x:u,y:c,width:d,height:_}=t.getViewport();t.setViewport(0,0,1,1),t.bindVAO(a),t.drawArrays(H.MX.TRIANGLE_STRIP,0,4),t.setViewport(u,c,d,_),e.readPixels(0,0,1,1,H.VI.RGBA,H.Br.UNSIGNED_BYTE,r),o.dispose(),a.dispose(!1),n.dispose(),e.dispose();const f=255!==r[0]||255!==r[1]||255!==r[2]||255!==r[3];return f&&Wi.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${r[0]}.${r[1]}.${r[2]}.${r[3]}]`),t.bindFramebuffer(h),f}async function Hi(t){const e=new Image;if(e.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",e.width=5,e.height=5,await e.decode(),!t.gl)return!0;const i=new Ne.X(t,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.NONE},{target:H.No.TEXTURE_2D,wrapMode:H.e8.CLAMP_TO_EDGE,pixelFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,samplingMode:H.cw.NEAREST,width:1,height:1}),s=X.f.createVertex(t,H.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),r=new Z.U(t,new Map([["a_pos",0]]),k.cD,{geometry:s}),n="\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ",a="\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",o=t.programCache.acquire(n,a,new Map([["a_pos",0]]));t.useProgram(o);const l=new pt.x(t,{dataType:H.Br.UNSIGNED_BYTE,pixelFormat:H.VI.RGBA,preMultiplyAlpha:!1,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.LINEAR},e);t.bindTexture(l,0),o.setUniform1i("u_texture",0);const h=t.getBoundFramebufferObject(),{x:u,y:c,width:d,height:_}=t.getViewport();t.bindFramebuffer(i),t.setViewport(0,0,1,1),t.setClearColor(0,0,0,0),t.setBlendingEnabled(!1),t.clearSafe(H.lk.COLOR_BUFFER_BIT),t.bindVAO(r),t.drawArrays(H.MX.TRIANGLE_STRIP,0,4);const f=new Uint8Array(4);return i.readPixels(0,0,1,1,H.VI.RGBA,H.Br.UNSIGNED_BYTE,f),o.dispose(),r.dispose(!1),s.dispose(),i.dispose(),l.dispose(),t.setViewport(u,c,d,_),t.bindFramebuffer(h),e.src="",255===f[0]}class qi{constructor(t){this.context=t,this._floatBufferBlendWorking=Vi(t),Hi(t).then((t=>this._svgAlwaysPremultipliesAlpha=!t))}get floatBufferBlendWorking(){if((0,a.Wi)(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if((0,a.Wi)(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if((0,a.Wi)(this._doublePrecisionRequiresObfuscation)){const t=Ni(this.context,!1),e=Ni(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==t&&(0===e||t/e>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return(0,a.Wi)(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=Xi(this.context)),this._ignoresSamplerPrecision}}function Zi(t,e){if(e.disjointTimerQuery)return null;if((0,pi.Z)(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const i=t.getExtension("WEBGL_draw_buffers");return i?{drawBuffers:i.drawBuffersWEBGL.bind(i),MAX_DRAW_BUFFERS:i.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:i.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function Yi(t){if((0,pi.Z)(t))return{drawArraysInstanced:t.drawArraysInstanced.bind(t),drawElementsInstanced:t.drawElementsInstanced.bind(t),vertexAttribDivisor:t.vertexAttribDivisor.bind(t)};const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function ji(t,e){if(e.compressedTextureETC)return null;const i=t.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function Ki(t,e){if(e.compressedTextureS3TC)return null;const i=t.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function $i(t,e){if((0,pi.Z)(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const e=t.getExtension("EXT_blend_minmax");return e?{MIN:e.MIN_EXT,MAX:e.MAX_EXT}:null}}function Qi(t,e){if(e.textureFilterAnisotropic)return null;const i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null}function Ji(t,e){if((0,pi.Z)(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const i=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!i,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:i?i.HALF_FLOAT_OES:void 0}}return null}function ts(t,e){if((0,pi.Z)(t)){const i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_half_float"),s=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),r=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||s||r?{textureFloat:!!s,textureHalfFloat:!!i,floatBlend:!!r,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_half_float"),s=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),r=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return i||s||r?{textureFloat:!!s,textureHalfFloat:!!i,floatBlend:!!r,RGBA16F:i?i.RGBA16F_EXT:void 0,RGB16F:i?i.RGB16F_EXT:void 0,RGBA32F:s?s.RGBA32F_EXT:void 0}:null}return null}function es(t,e,i,s,r){if(s&&(0,pi.Z)(t))return!0;if(e[i])return!1;for(const n of r)if(t.getExtension(n))return!0;return!1}function is(t,e){if(!(0,pi.Z)(t))return null;if(e.textureNorm16)return null;const i=t.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null}function ss(t,e){const i=e.loseContext&&t.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null}function rs(t,e){if((0,pi.Z)(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const i=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return i?{createVertexArray:i.createVertexArrayOES.bind(i),deleteVertexArray:i.deleteVertexArrayOES.bind(i),bindVertexArray:i.bindVertexArrayOES.bind(i)}:null}class ns{constructor(t,e){this.gl=t,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._disabledExtensions=e.disabledExtensions||{},this._debugWebGLExtensions=e.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=Zi(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=Yi(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=rs(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=ji(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=Ki(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=Qi(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=gi(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=Ji(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=ts(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=$i(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return null===this._depthTexture&&(this._depthTexture=es(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return null===this._standardDerivatives&&(this._standardDerivatives=es(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return null===this._shaderTextureLOD&&(this._shaderTextureLOD=es(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return null===this._fragDepth&&(this._fragDepth=es(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=ss(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=is(this.gl,this._disabledExtensions)),this._textureNorm16}enable(t){return this[t]}}class as{constructor(t,e){this.gl=t,this.instanceCounter=new Oi,this.programCache=new Fi.G(this),this._state=new Bi,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=(0,pi.Z)(t)?xi.zO.WEBGL2:xi.zO.WEBGL1,this._loadExtensions(),this.configure(e)}configure(t){this._capabilities=new ns(this.gl,t),this._parameters=this._loadParameters(t);const e=this.gl.getParameter(this.gl.VIEWPORT);this._state=new Bi,this._state.viewport={x:e[0],y:e[1],width:e[2],height:e[3]},this._stateTracker=new Mi.jp({setBlending:t=>{if(t){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(t.opRgb,t.opAlpha),this.setBlendFunctionSeparate(t.srcRgb,t.dstRgb,t.srcAlpha,t.dstAlpha);const e=t.color;this.setBlendColor(e.r,e.g,e.b,e.a)}else this.setBlendingEnabled(!1)},setCulling:t=>{t?(this.setFaceCullingEnabled(!0),this.setCullFace(t.face),this.setFrontFace(t.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:t=>{t?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(t.factor,t.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:t=>{t?(this.setDepthTestEnabled(!0),this.setDepthFunction(t.func)):this.setDepthTestEnabled(!1)},setStencilTest:t=>{if(t){this.setStencilTestEnabled(!0);const e=t.function;this.setStencilFunction(e.func,e.ref,e.mask);const i=t.operation;this.setStencilOp(i.fail,i.zFail,i.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:t=>{t?(this.setDepthWriteEnabled(!0),this.setDepthRange(t.zNear,t.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:t=>{t?this.setColorMask(t.r,t.g,t.b,t.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:t=>{t?this.setStencilWriteMask(t.mask):this.setStencilWriteMask(0)}}),this.enforceState(),this._driverTest=new qi(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(H.w0.ARRAY_BUFFER),this.unbindBuffer(H.w0.ELEMENT_ARRAY_BUFFER),(0,pi.Z)(this.gl)&&(this.unbindBuffer(H.w0.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(H.w0.PIXEL_PACK_BUFFER),this.unbindBuffer(H.w0.PIXEL_UNPACK_BUFFER),this.unbindBuffer(H.w0.COPY_READ_BUFFER),this.unbindBuffer(H.w0.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,(0,Ri.hZ)()&&this.instanceCounter.printResourceCount()}setPipelineState(t){this._stateTracker.setPipeline(t)}setBlendingEnabled(t){this._state.blend!==t&&(!0===t?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=t,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var t;null==(t=this._state.program)||t.stop(),this._state.program=null}externalTextureUnitUpdate(t,e){for(let i=0;i<t.length;++i)this._state.textureUnitMap[t[i]]=null;e>=0&&(this._state.activeTexture=e)}externalVertexArrayObjectUpdate(){const t=this.capabilities.vao;t&&(t.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(t,e,i,s){t===this._state.blendColor.r&&e===this._state.blendColor.g&&i===this._state.blendColor.b&&s===this._state.blendColor.a||(this.gl.blendColor(t,e,i,s),this._state.blendColor.r=t,this._state.blendColor.g=e,this._state.blendColor.b=i,this._state.blendColor.a=s,this._stateTracker.invalidateBlending())}setBlendFunction(t,e){t===this._state.blendFunction.srcRGB&&e===this._state.blendFunction.dstRGB||(this.gl.blendFunc(t,e),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=t,this._state.blendFunction.dstRGB=e,this._state.blendFunction.dstAlpha=e,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(t,e,i,s){this._state.blendFunction.srcRGB===t&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===e&&this._state.blendFunction.dstAlpha===s||(this.gl.blendFuncSeparate(t,e,i,s),this._state.blendFunction.srcRGB=t,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=e,this._state.blendFunction.dstAlpha=s,this._stateTracker.invalidateBlending())}setBlendEquation(t){this._state.blendEquation.mode!==t&&(this.gl.blendEquation(t),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(t,e){this._state.blendEquation.mode===t&&this._state.blendEquation.modeAlpha===e||(this.gl.blendEquationSeparate(t,e),this._state.blendEquation.mode=t,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setColorMask(t,e,i,s){this._state.colorMask.r===t&&this._state.colorMask.g===e&&this._state.colorMask.b===i&&this._state.colorMask.a===s||(this.gl.colorMask(t,e,i,s),this._state.colorMask.r=t,this._state.colorMask.g=e,this._state.colorMask.b=i,this._state.colorMask.a=s,this._stateTracker.invalidateColorWrite())}setClearColor(t,e,i,s){this._state.clearColor.r===t&&this._state.clearColor.g===e&&this._state.clearColor.b===i&&this._state.clearColor.a===s||(this.gl.clearColor(t,e,i,s),this._state.clearColor.r=t,this._state.clearColor.g=e,this._state.clearColor.b=i,this._state.clearColor.a=s)}setFaceCullingEnabled(t){this._state.faceCulling!==t&&(!0===t?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=t,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(t){this._state.polygonOffsetFill!==t&&(!0===t?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=t,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(t,e){this._state.polygonOffset[0]===t&&this._state.polygonOffset[1]===e||(this._state.polygonOffset[0]=t,this._state.polygonOffset[1]=e,this.gl.polygonOffset(t,e),this._stateTracker.invalidatePolygonOffset())}setCullFace(t){this._state.cullFace!==t&&(this.gl.cullFace(t),this._state.cullFace=t,this._stateTracker.invalidateCulling())}setFrontFace(t){this._state.frontFace!==t&&(this.gl.frontFace(t),this._state.frontFace=t,this._stateTracker.invalidateCulling())}setScissorTestEnabled(t){this._state.scissorTest!==t&&(!0===t?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=t)}setScissorRect(t,e,i,s){this._state.scissorRect.x===t&&this._state.scissorRect.y===e&&this._state.scissorRect.width===i&&this._state.scissorRect.height===s||(this.gl.scissor(t,e,i,s),this._state.scissorRect.x=t,this._state.scissorRect.y=e,this._state.scissorRect.width=i,this._state.scissorRect.height=s)}setDepthTestEnabled(t){this._state.depthTest!==t&&(!0===t?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=t,this._stateTracker.invalidateDepthTest())}setClearDepth(t){this._state.clearDepth!==t&&(this.gl.clearDepth(t),this._state.clearDepth=t)}setDepthFunction(t){this._state.depthFunction!==t&&(this.gl.depthFunc(t),this._state.depthFunction=t,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(t){this._state.depthWrite!==t&&(this.gl.depthMask(t),this._state.depthWrite=t,this._stateTracker.invalidateDepthWrite())}setDepthRange(t,e){this._state.depthRange.zNear===t&&this._state.depthRange.zFar===e||(this.gl.depthRange(t,e),this._state.depthRange.zNear=t,this._state.depthRange.zFar=e,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(t){this._state.stencilTest!==t&&(!0===t?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=t,this._stateTracker.invalidateStencilTest())}setClearStencil(t){t!==this._state.clearStencil&&(this.gl.clearStencil(t),this._state.clearStencil=t)}setStencilFunction(t,e,i){this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===e&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(t,e,i),this._state.stencilFunction.face=H.LR.FRONT_AND_BACK,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=e,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(t,e,i,s){this._state.stencilFunction.face===t&&this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===s||(this.gl.stencilFuncSeparate(t,e,i,s),this._state.stencilFunction.face=t,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=s,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(t){this._state.stencilWriteMask!==t&&(this.gl.stencilMask(t),this._state.stencilWriteMask=t,this._stateTracker.invalidateStencilWrite())}setStencilOp(t,e,i){this._state.stencilOperation.face===H.LR.FRONT_AND_BACK&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===e&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(t,e,i),this._state.stencilOperation.face=H.LR.FRONT_AND_BACK,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=e,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(t,e,i,s){this._state.stencilOperation.face===t&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===s||(this.gl.stencilOpSeparate(t,e,i,s),this._state.stencilOperation.face=t,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=s,this._stateTracker.invalidateStencilTest())}setActiveTexture(t,e=!1){const i=this._state.activeTexture;return t>=0&&(e||t!==this._state.activeTexture)&&(this.gl.activeTexture(H.Ld+t),this._state.activeTexture=t),i}clear(t){t&&this.gl.clear(t)}clearSafe(t,e=255){t&&(t&H.lk.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),t&H.lk.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),t&H.lk.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(e),this.gl.clear(t))}drawArrays(t,e,i){if((0,Ri.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=ls(t,i)),this.gl.drawArrays(t,e,i),(0,Ri.hZ)()){const t=(0,Ii.HH)(this);t&&console.error("drawArrays:",t)}}drawElements(t,e,i,s){if((0,Ri.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=ls(t,e)),this.gl.drawElements(t,e,i,s),(0,Ri.hZ)()){const n=(0,Ii.HH)(this);if(n){var r;const o=this.getBoundVAO(),l=null==o?void 0:o.indexBuffer,h={indexBuffer:l,vertexBuffers:null==o?void 0:o.vertexBuffers},u={mode:t,count:e,type:i,offset:s},c=null!=(r=(0,a.yw)(l,(t=>t.size)))?r:0,d=s+e,_=c<d?`. Buffer is too small. Attempted to draw index ${d} of ${c}`:"";console.error(`drawElements: ${n}${_}`,{args:u,vao:h})}}}logIno(){(0,Ri.hZ)()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}get capabilities(){return this._capabilities}setViewport(t,e,i,s){i=Math.max(Math.round(i),1),s=Math.max(Math.round(s),1);const r=this._state.viewport;r.x===t&&r.y===e&&r.width===i&&r.height===s||(r.x=t,r.y=e,r.width=i,r.height=s,this.gl.viewport(t,e,i,s))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(t){var e,i;this._state.program!==t&&(null==(e=this._state.program)||e.stop(),this._state.program=t,this.gl.useProgram(null!=(i=null==t?void 0:t.glName)?i:null))}bindTexture(t,e,i=!1){(e>=this.parameters.maxTextureImageUnits||e<0)&&console.error("Input texture unit is out of range of available units!");const s=this._state.textureUnitMap[e];return(0,a.Wi)(t)||null==t.glName?((0,a.pC)(s)&&(this.setActiveTexture(e,i),this.gl.bindTexture(s.descriptor.target,null)),this._state.textureUnitMap[e]=null,s):i||s!==t?(this.setActiveTexture(e,i),this.gl.bindTexture(t.descriptor.target,t.glName),t.applyChanges(),this._state.textureUnitMap[e]=t,s):(t.isDirty&&(this.setActiveTexture(e,i),t.applyChanges()),s)}unbindTextureAllUnits(t){for(let e=0;e<this.parameters.maxTextureImageUnits;e++)this._state.textureUnitMap[e]===t&&(this.bindTexture(null,e),this._state.textureUnitMap[e]=null)}bindFramebuffer(t,e=!1){if(e||this._state.readFramebuffer!==t||this._state.drawFramebuffer!==t){if((0,a.Wi)(t))return this.gl.bindFramebuffer(H.qi.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);t.initializeAndBind(H.qi.FRAMEBUFFER),this._state.readFramebuffer=t,this._state.drawFramebuffer=t}}bindFramebufferSeparate(t,e,i=!1){const s=e===H.qi.READ_FRAMEBUFFER,r=s?this._state.readFramebuffer:this._state.drawFramebuffer;(i||r!==t)&&((0,a.Wi)(t)?this.gl.bindFramebuffer(e,null):t.initializeAndBind(e),s?this._state.readFramebuffer=(0,a.Pt)(t,null):this._state.drawFramebuffer=(0,a.Pt)(t,null))}blitFramebuffer(t,e,i=0,s=0,r=t.width,n=t.height,a=0,o=0,l=e.width,h=e.height,u=H.lk.COLOR_BUFFER_BIT,c=H.cw.NEAREST){this.bindFramebufferSeparate(t,H.qi.READ_FRAMEBUFFER),this.bindFramebufferSeparate(e,H.qi.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,s,r,n,a,o,l,h,u,c)}bindBuffer(t,e){if(t)switch(null!=e||(e=t.bufferType),e){case H.w0.ARRAY_BUFFER:this._state.vertexBuffer=os(this.gl,t,e,this._state.vertexBuffer);break;case H.w0.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=os(this.gl,t,e,this._state.indexBuffer);break;case H.w0.UNIFORM_BUFFER:this._state.uniformBuffer=os(this.gl,t,e,this._state.uniformBuffer);break;case H.w0.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=os(this.gl,t,e,this._state.pixelPackBuffer);break;case H.w0.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=os(this.gl,t,e,this._state.pixelUnpackBuffer);break;case H.w0.COPY_READ_BUFFER:this._state.copyReadBuffer=os(this.gl,t,e,this._state.copyReadBuffer);break;case H.w0.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=os(this.gl,t,e,this._state.copyWriteBuffer)}}bindRenderbuffer(t){const e=this.gl;t||(e.bindRenderbuffer(e.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==t&&(e.bindRenderbuffer(e.RENDERBUFFER,t.glName),this._state.renderbuffer=t)}_getBufferBinding(t,e){if(e>=this.parameters.maxUniformBufferBindings||e<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let s=i[e];return(0,a.Wi)(s)&&(s={buffer:null,offset:0,size:0},i[e]=s),s}bindBufferBase(t,e,i){const s=this._getBufferBinding(t,e);(0,a.Wi)(s)||s.buffer===i&&0===s.offset&&0===s.size||(this.gl.bindBufferBase(t,e,i?i.glName:null),s.buffer=i,s.offset=0,s.size=0)}bindBufferRange(t,e,i,s,r){const n=this._getBufferBinding(t,e);(0,a.Wi)(n)||n.buffer===i&&n.offset===s&&n.size===r||(s%this._parameters.uniformBufferOffsetAlignment==0?(this.gl.bindBufferRange(t,e,i.glName,s,r),n.buffer=i,n.offset=s,n.size=r):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"))}bindUBO(t,e,i,s){(0,a.Wi)(e)?this.bindBufferBase(H.w0.UNIFORM_BUFFER,t,null):((0,Ri.hZ)()&&(null!=s?s:e.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),e.initialize(),void 0!==i&&void 0!==s?this.bindBufferRange(H.w0.UNIFORM_BUFFER,t,e.buffer,i,s):this.bindBufferBase(H.w0.UNIFORM_BUFFER,t,e.buffer))}unbindUBO(t){for(let e=0,i=this._state.uniformBufferBindingPoints.length;e<i;e++){const i=this._state.uniformBufferBindingPoints[e];(0,a.pC)(i)&&i.buffer===t.buffer&&this.bindBufferBase(H.w0.UNIFORM_BUFFER,e,null)}}unbindBuffer(t){switch(t){case H.w0.ARRAY_BUFFER:this._state.vertexBuffer=os(this.gl,null,t,this._state.vertexBuffer);break;case H.w0.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=os(this.gl,null,t,this._state.indexBuffer);break;case H.w0.UNIFORM_BUFFER:this._state.uniformBuffer=os(this.gl,null,t,this._state.uniformBuffer);break;case H.w0.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=os(this.gl,null,t,this._state.pixelPackBuffer);break;case H.w0.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=os(this.gl,null,t,this._state.pixelUnpackBuffer);break;case H.w0.COPY_READ_BUFFER:this._state.copyReadBuffer=os(this.gl,null,t,this._state.copyReadBuffer);break;case H.w0.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=os(this.gl,null,t,this._state.copyWriteBuffer)}}bindVAO(t=null){(0,a.Wi)(t)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==t&&(t.bind(),this._state.vertexArrayObject=t)}async clientWaitAsync(t=(0,yi.HA)(10)){const e={};this.instanceCounter.increment(H._g.Sync,e);const i=this.gl,s=i.fenceSync(H.V7.SYNC_GPU_COMMANDS_COMPLETE,0);let r;i.flush();do{await(0,ot.e4)(t),r=i.clientWaitSync(s,0,0)}while(r===H.Y5.TIMEOUT_EXPIRED);if(i.deleteSync(s),this.instanceCounter.decrement(H._g.Sync,e),r===H.Y5.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(t=H.qi.FRAMEBUFFER){return t===H.qi.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(H.w0.ARRAY_BUFFER),this.unbindBuffer(H.w0.ELEMENT_ARRAY_BUFFER),(0,pi.Z)(this.gl)&&(this.unbindBuffer(H.w0.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(H.w0.PIXEL_PACK_BUFFER),this.unbindBuffer(H.w0.PIXEL_UNPACK_BUFFER),this.unbindBuffer(H.w0.COPY_READ_BUFFER),this.unbindBuffer(H.w0.COPY_WRITE_BUFFER));for(let t=0;t<this.parameters.maxTextureImageUnits;++t)this.bindTexture(null,t);this.setBlendingEnabled(!1),this.setBlendFunction(H.zi.ONE,H.zi.ZERO),this.setBlendEquation(H.db.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(H.LR.BACK),this.setFrontFace(H.Wf.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(H.wb.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(H.wb.ALWAYS,0,0),this.setStencilOp(H.xS.KEEP,H.xS.KEEP,H.xS.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var t,e;const i=this.gl,s=this.capabilities.vao;s&&s.bindVertexArray(null);for(let a=0;a<this.parameters.maxVertexAttributes;a++)i.disableVertexAttribArray(a);if(this._state.vertexBuffer?i.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):i.bindBuffer(H.w0.ARRAY_BUFFER,null),this._state.indexBuffer?i.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):i.bindBuffer(H.w0.ELEMENT_ARRAY_BUFFER,null),(0,pi.Z)(i)){var r,n;this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(H.w0.UNIFORM_BUFFER,null);for(let t=0;t<this._parameters.maxUniformBufferBindings;t++){const e=this._state.uniformBufferBindingPoints[t];if((0,a.pC)(e)&&null!==e.buffer){const{buffer:s,offset:r,size:n}=e;0===r&&0===n?i.bindBufferBase(H.w0.UNIFORM_BUFFER,t,s.glName):i.bindBufferRange(H.w0.UNIFORM_BUFFER,t,s.glName,r,n)}else i.bindBufferBase(H.w0.UNIFORM_BUFFER,t,null)}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(H.w0.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(H.w0.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(H.w0.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(H.w0.COPY_WRITE_BUFFER,null),i.bindFramebuffer(H.qi.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(H.qi.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(H.VY.COLOR_ATTACHMENT0)),i.bindFramebuffer(H.qi.DRAW_FRAMEBUFFER,null!=(r=null==(n=this._state.drawFramebuffer)?void 0:n.glName)?r:null)}else{var o,l;this._state.readFramebuffer=this._state.drawFramebuffer,i.bindFramebuffer(H.qi.FRAMEBUFFER,null!=(o=null==(l=this._state.drawFramebuffer)?void 0:l.glName)?o:null)}if(s&&this._state.vertexArrayObject){const t=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(t)}i.useProgram(null!=(t=null==(e=this._state.program)?void 0:e.glName)?t:null),i.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),i.bindRenderbuffer(i.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),!0===this._state.blend?i.enable(this.gl.BLEND):i.disable(this.gl.BLEND),i.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),i.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),i.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),i.clearDepth(this._state.clearDepth),i.clearStencil(this._state.clearStencil),i.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),i.cullFace(this._state.cullFace),i.depthFunc(this._state.depthFunction),i.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),!0===this._state.depthTest?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST),i.depthMask(this._state.depthWrite),i.frontFace(this._state.frontFace),i.lineWidth(1),!0===this._state.faceCulling?i.enable(i.CULL_FACE):i.disable(i.CULL_FACE),i.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),!0===this._state.polygonOffsetFill?i.enable(i.POLYGON_OFFSET_FILL):i.disable(i.POLYGON_OFFSET_FILL),i.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),!0===this._state.scissorTest?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST),i.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),i.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),!0===this._state.stencilTest?i.enable(i.STENCIL_TEST):i.disable(i.STENCIL_TEST),i.stencilMask(this._state.stencilWriteMask);for(let h=0;h<this.parameters.maxTextureImageUnits;h++){i.activeTexture(H.Ld+h),i.bindTexture(H.No.TEXTURE_2D,null),i.bindTexture(H.No.TEXTURE_CUBE_MAP,null),(0,pi.Z)(i)&&(i.bindTexture(H.No.TEXTURE_3D,null),i.bindTexture(H.No.TEXTURE_2D_ARRAY,null));const t=this._state.textureUnitMap[h];(0,a.pC)(t)&&i.bindTexture(t.descriptor.target,t.glName)}i.activeTexture(H.Ld+this._state.activeTexture),i.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),(0,Ri.hZ)()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}_loadExtensions(){this.type===xi.zO.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(t){var e;const i=this.capabilities.textureFilterAnisotropic,s=null!=(e=t.maxAnisotropy)?e:1/0,r=(0,pi.Z)(this.gl),n=this.gl,a={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:i?Math.min(this.gl.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY),s):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:r?n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:r?n.getParameter(n.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:r?n.getParameter(n.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:r?n.getParameter(n.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:r?n.getParameter(n.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:r?n.getParameter(n.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:r?n.getParameter(n.MAX_SAMPLES):1};return pt.x.TEXTURE_UNIT_FOR_UPDATES=a.maxTextureImageUnits-1,a}}function os(t,e,i,s){return e?s!==e&&t.bindBuffer(i,e.glName):t.bindBuffer(i,null),e}function ls(t,e){switch(t){case H.MX.POINTS:return 2*e;case H.MX.TRIANGLES:return e/3;case H.MX.TRIANGLE_STRIP:case H.MX.TRIANGLE_FAN:return e-2;default:return 0}}const hs=2e3;class us extends m.W{constructor(t,e){super(),this._trash=new Set,this._clipData=new Float32Array(8),this._upperLeft=(0,f.a)(),this._upperRight=(0,f.a)(),this._lowerLeft=(0,f.a)(),this._lowerRight=(0,f.a)(),this._mat2=(0,c.c)(),this._clipRendererInitialized=!1,this._renderRemainingTime=0,this._lastFrameRenderTime=0,this.renderRequested=!1,this.stage=this,this._stationary=!0;const{canvas:i=document.createElement("canvas"),alpha:l=!0,stencil:h=!0,contextOptions:u={}}=e;this._canvas=i;const d=(0,xi.sj)("2d",i,{alpha:l,antialias:!1,depth:!0,stencil:h});this.context=new as((0,a.pC)(d)?d:null,u),this.resourceManager=new p.Z,this.painter=new ci(this.context,this,this.resourceManager),(0,n.Z)("esri-2d-profiler")&&(this._debugOutput=document.createElement("div"),this._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),t.appendChild(this._debugOutput)),this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:this.context,painter:this.painter,timeline:e.timeline||new Ti.T,renderingOptions:e.renderingOptions,requireFBO:!1,profiler:new vi(this.context,this._debugOutput),dataUploadCounter:0},this._taskHandle=(0,o.A)({render:t=>this.renderFrame(t)}),this._taskHandle.pause(),this._lostWebGLContextHandle=(0,r.on)(i,"webglcontextlost",(()=>{this.emit("webgl-error",{error:new s.Z("webgl-context-lost")})})),i.setAttribute("style","width: 100%; height:100%; display:block;"),t.appendChild(i)}destroy(){this.removeAllChildren(),this._emptyTrash(),this._taskHandle.remove(),this._taskHandle=null,this._boundFBO=null,this._clipFBO&&(this._clipFBO.dispose(),this._clipFBO=null),this._clipVAO&&(this._clipVAO.dispose(),this._clipVAO=null,this._clipVBO=null),this._clipStencilProgram&&(this._clipStencilProgram.dispose(),this._clipStencilProgram=null),this._lostWebGLContextHandle&&(this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null),this._canvas.parentNode&&this._canvas.parentNode.removeChild(this._canvas),this._debugOutput&&this._debugOutput.parentNode&&this._debugOutput.parentNode.removeChild(this._debugOutput),this.highlightOptions=null,this.resourceManager.destroy(),this.painter.dispose(),this.context.dispose(),this._canvas=null}get background(){return this._background}set background(t){this._background=t,this.requestRender()}get highlightOptions(){return this._highlightOptions}set highlightOptions(t){this._highlightOptionsHandle&&(this._highlightOptionsHandle.remove(),this._highlightOptionsHandle=null),this._highlightOptions=t,this._highlightOptions&&(this._highlightOptionsHandle=(0,l.S1)(this._highlightOptions,"version",(()=>{this.painter.setHighlightOptions(t),this.requestRender()})))}get renderingOptions(){return this._renderingOptions}set renderingOptions(t){this._renderingOptions=t,this.requestRender()}get state(){return this._state}set state(t){this._state=t,this.requestRender()}get stationary(){return this._stationary}set stationary(t){this._stationary!==t&&(this._stationary=t,this.requestRender())}trashDisplayObject(t){this._trash.add(t),this.requestRender()}untrashDisplayObject(t){return this._trash.delete(t)}requestRender(){this._renderRemainingTime=hs,this.renderRequested||(this.renderRequested=!0,this.emit("will-render"),this._taskHandle.resume())}renderFrame(t){const e=this._lastFrameRenderTime?t.time-this._lastFrameRenderTime:0;this._renderRemainingTime-=e,this._renderRemainingTime<=0&&this._taskHandle.pause(),this._lastFrameRenderTime=t.time,this.renderRequested=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=t.time,this._renderParameters.deltaTime=t.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash(),this.emit("post-render")}_createTransforms(){return{dvs:(0,d.c)()}}renderChildren(t){for(const e of this.children)e.beforeRender(t);this._renderChildren(this.children,t);for(const e of this.children)e.afterRender(t)}_renderChildren(t,e){const i=this.context;e.profiler.recordStart("drawLayers"),e.dataUploadCounter=0,this._beforeRenderChildren(e),e.drawPhase=g.jx.MAP,this.painter.beforeRenderLayers(i,this.background);for(const s of t)s.processRender(e);this.painter.renderLayers(i),e.drawPhase=g.jx.HIGHLIGHT,this.painter.beforeRenderLayers(i);for(const s of t)s.processRender(e);if(this.painter.renderLayers(i),this._isLabelDrawPhaseRequired(t)){e.drawPhase=g.jx.LABEL,this.painter.beforeRenderLayers(i);for(const i of t)i.processRender(e);this.painter.renderLayers(i)}if((0,n.Z)("esri-tiles-debug")){e.drawPhase=g.jx.DEBUG,this.painter.beforeRenderLayers(i);for(const i of t)i.processRender(e);this.painter.renderLayers(i)}e.profiler.recordEnd("drawLayers"),this._afterRenderChildren()}_beforeRenderChildren(t){const{context:e}=this,{state:i,pixelRatio:s}=t;e.setClearDepth(1),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT);const{size:r,rotation:n}=i,a=Math.round(r[0]*s),o=Math.round(r[1]*s);if(this._boundFBO=e.getBoundFramebufferObject(),!i.spatialReference.isWrappable)return void(this._clipFrame=!1);const l=(0,h.t)(n),c=Math.abs(Math.cos(l)),d=Math.abs(Math.sin(l)),f=Math.round(a*c+o*d),p=Math.round(i.worldScreenWidth);if(f<=p)return void(this._clipFrame=!1);this._clipFBO&&this._clipFBO.width===a&&this._clipFBO.height===o||(this._clipFBO=new Ne.X(e,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.DEPTH_STENCIL_RENDER_BUFFER,width:a,height:o}));const m=(this.state.padding.left-this.state.padding.right)/2,g=(this.state.padding.bottom-this.state.padding.top)/2,b=.5*a,v=.5*o,E=1/a,T=1/o,w=p*s*.5,x=.5*(a*d+o*c),y=this._upperLeft,R=this._upperRight,F=this._lowerLeft,B=this._lowerRight;(0,_.s)(y,-w,-x),(0,_.s)(R,w,-x),(0,_.s)(F,-w,x),(0,_.s)(B,w,x),(0,u.a)(this._mat2,[b+m,v-g]),0!==n&&(0,u.r)(this._mat2,this._mat2,l),(0,_.t)(y,y,this._mat2),(0,_.t)(R,R,this._mat2),(0,_.t)(F,F,this._mat2),(0,_.t)(B,B,this._mat2);const C=this._clipData;C.set([2*F[0]*E-1,2*(o-F[1])*T-1,2*B[0]*E-1,2*(o-B[1])*T-1,2*y[0]*E-1,2*(o-y[1])*T-1,2*R[0]*E-1,2*(o-R[1])*T-1]),this._clipRendererInitialized||this._initializeClipRenderer(e),this._clipVBO.setData(C),this._boundFBO=e.getBoundFramebufferObject(),e.bindFramebuffer(this._clipFBO),e.setDepthWriteEnabled(!0),e.setStencilWriteMask(255),e.setClearColor(0,0,0,0),e.setClearDepth(1),e.setClearStencil(0),e.clear(e.gl.COLOR_BUFFER_BIT|e.gl.DEPTH_BUFFER_BIT|e.gl.STENCIL_BUFFER_BIT),e.setDepthWriteEnabled(!1),this._clipFrame=!0}_afterRenderChildren(){const t=this.context;if(t.logIno(),this._clipFrame&&this._clipRendererInitialized){if(t.bindFramebuffer(this._boundFBO),this._boundFBO=null,t.bindVAO(this._clipVAO),t.useProgram(this._clipStencilProgram),t.setDepthWriteEnabled(!1),t.setDepthTestEnabled(!1),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!1),t.setStencilOp(H.xS.KEEP,H.xS.KEEP,H.xS.REPLACE),t.setStencilWriteMask(255),t.setStencilFunction(H.wb.ALWAYS,1,255),t.drawElements(H.MX.TRIANGLES,6,H.g.UNSIGNED_SHORT,0),t.bindVAO(),t.setColorMask(!0,!0,!0,!0),null!=this.background){const{r:e,g:i,b:s,a:r}=this.background.color;t.setClearColor(r*e/255,r*i/255,r*s/255,r)}else t.setClearColor(0,0,0,0);t.clear(t.gl.COLOR_BUFFER_BIT),t.setBlendingEnabled(!0),t.setStencilFunction(H.wb.EQUAL,1,255),this.painter.blitTexture(t,this._clipFBO.colorTexture,H.cw.NEAREST,1),t.setStencilTestEnabled(!1)}}doRender(t){const e=this.context,{state:i,pixelRatio:s}=t;this._resizeCanvas(t),e.setViewport(0,0,s*i.size[0],s*i.size[1]),e.setDepthWriteEnabled(!0),e.setStencilWriteMask(255),super.doRender(t)}async takeScreenshot(t){const{framebufferWidth:e,framebufferHeight:i}={framebufferWidth:Math.round(this._renderParameters.state.size[0]*t.resolutionScale),framebufferHeight:Math.round(this._renderParameters.state.size[1]*t.resolutionScale)},s=1,r=this.context,n=this._state.clone();if(null!=t.rotation){const e=n.viewpoint;n.viewpoint.rotation=t.rotation,n.viewpoint=e}const a={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:n,pixelRatio:s,time:performance.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1},o=new Ne.X(r,{colorTarget:H.Lm.TEXTURE,depthStencilTarget:H.OU.DEPTH_STENCIL_RENDER_BUFFER,width:e,height:i}),l=r.getBoundFramebufferObject(),h=r.getViewport();r.bindFramebuffer(o),r.setViewport(0,0,e,i),this._renderChildren(t.children,a);const u=this._readbackScreenshot(o,{...t.cropArea,y:i-(t.cropArea.y+t.cropArea.height)});r.bindFramebuffer(l),r.setViewport(h.x,h.y,h.width,h.height),this.requestRender();const c=await u;let d;return 1===t.outputScale?d=c:(d=new ImageData(Math.round(c.width*t.outputScale),Math.round(c.height*t.outputScale)),(0,wi.TT)(c,d,!0)),(0,wi.gH)(d,{format:t.format,quality:t.quality,rotation:0,disableDecorations:!1},document.createElement("canvas"),{flipY:!0,premultipliedAlpha:!0})}async _readbackScreenshot(t,e){const i=(0,wi.r7)(e.width,e.height,document.createElement("canvas"));return await t.readPixelsAsync(e.x,e.y,e.width,e.height,H.VI.RGBA,H.Br.UNSIGNED_BYTE,new Uint8Array(i.data.buffer)),i}_resizeCanvas(t){const e=this._canvas,i=e.style,{state:{size:s},pixelRatio:r}=t,n=s[0],a=s[1],o=Math.round(n*r),l=Math.round(a*r);e.width===o&&e.height===l||(e.width=o,e.height=l),i.width=n+"px",i.height=a+"px"}_initializeClipRenderer(t){if(this._clipRendererInitialized)return!0;const e=(0,q.H)(t,Ei);if(!e)return!1;const i=X.f.createVertex(t,H.l1.STREAM_DRAW,this._clipData),s=new Uint16Array([0,1,2,2,1,3]),r=X.f.createIndex(t,H.l1.STATIC_DRAW,s),n=Ei.attributes,a={geometry:[new Pe.G("a_pos",2,H.g.FLOAT,0,8)]},o=new Z.U(t,n,a,{geometry:i},r);return this._clipStencilProgram=e,this._clipVBO=i,this._clipVAO=o,this._clipRendererInitialized=!0,!0}_emptyTrash(){for(;this._trash.size>0;){const t=Array.from(this._trash);this._trash.clear();for(const e of t)e.processDetach()}}_isLabelDrawPhaseRequired(t){let e=!1;for(const i of t){if(!(i instanceof m.W)){e=e||!1;break}if(i.hasLabels)return!0;e=e||this._isLabelDrawPhaseRequired(i.children)}return e}}var cs=i(61445),ds=i(92698),_s=i(30374),fs=i(89572),ps=i(58006),ms=(i(94315),i(77623)),gs=i(67752),bs=i(49701);const vs=2,Es=1,Ts=0,ws=1,xs=2;class ys{constructor(t,e){this.width=t,this.height=e;const i=Math.ceil(t/Es),s=Math.ceil(e/Es);this._cols=i,this._rows=s,this._cells=bs.p.create(i*s)}insertMetrics(t){const e=this._hasCollision(t);return e===Ts&&this._markMetrics(t),e}getCellId(t,e){return t+e*this._cols}has(t){return this._cells.has(t)}hasRange(t,e){return this._cells.hasRange(t,e)}set(t){this._cells.set(t)}setRange(t,e){this._cells.setRange(t,e)}_hasCollision(t){const e=t.id;let i=0,s=0;t.save();do{const e=t.boundsCount;i+=e;for(let i=0;i<e;i++){const e=t.boundsComputedAnchorX(i),r=t.boundsComputedAnchorY(i),n=t.boundsWidth(i)+vs,a=t.boundsHeight(i)+vs;switch(this._collide(e,r,n,a)){case xs:return xs;case ws:s++}}}while(t.peekId()===e&&t.next());return t.restore(),i===s?ws:Ts}_collide(t,e,i,s){const r=t-i/2,n=e-s/2,a=r+i,o=n+s;if(a<0||o<0||r>this.width||n>this.height)return ws;const l=(0,gs.uZ)(Math.floor(r/Es),0,this._cols),h=(0,gs.uZ)(Math.floor(n/Es),0,this._rows),u=(0,gs.uZ)(Math.ceil(a/Es),0,this._cols),c=(0,gs.uZ)(Math.ceil(o/Es),0,this._rows);for(let d=h;d<=c;d++)for(let t=l;t<=u;t++){const e=this.getCellId(t,d);if(this.has(e))return xs}return Ts}_mark(t,e,i,s){const r=t-i/2,n=e-s/2,a=r+i,o=n+s,l=(0,gs.uZ)(Math.floor(r/Es),0,this._cols),h=(0,gs.uZ)(Math.floor(n/Es),0,this._rows),u=(0,gs.uZ)(Math.ceil(a/Es),0,this._cols),c=(0,gs.uZ)(Math.ceil(o/Es),0,this._rows);for(let d=h;d<=c;d++)for(let t=l;t<=u;t++){const e=this.getCellId(t,d);this.set(e)}return!1}_markMetrics(t){const e=t.id;do{const e=t.boundsCount;for(let i=0;i<e;i++){const e=t.boundsComputedAnchorX(i),s=t.boundsComputedAnchorY(i),r=t.boundsWidth(i)+vs,n=t.boundsHeight(i)+vs;this._mark(e,s,r,n)}}while(t.peekId()===e&&t.next())}}var Rs=i(77495),Fs=i(19675);const Bs=Math.PI;function Cs(t,e){switch(e.transformationType){case Fs.hL.Additive:return Ss(t,e);case Fs.hL.Constant:return Os(e,t);case Fs.hL.ClampedLinear:return Ms(t,e);case Fs.hL.Proportional:return Is(t,e);case Fs.hL.Stops:return Ps(t,e);case Fs.hL.RealWorldSize:return Ds(t,e);case Fs.hL.Identity:return t;case Fs.hL.Unknown:return null}}function As(t,e){return"number"==typeof t?t:Cs(e,t)}function Ss(t,e){return t+(As(e.minSize,t)||e.minDataValue)}function Os(t,e){const i=t.stops;let s=i&&i.length&&i[0].size;return null==s&&(s=t.minSize),As(s,e)}function Ms(t,e){const i=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=As(e.minSize,t),r=As(e.maxSize,t);return t<=e.minDataValue?s:t>=e.maxDataValue?r:s+i*(r-s)}function Is(t,e){const i=t/e.minDataValue,s=As(e.minSize,t),r=As(e.maxSize,t);let n=null;return n=i*s,(0,gs.uZ)(n,s,r)}function Ps(t,e){const[i,s,r]=Ns(t,e.cache.ipData);if(i===s)return As(e.stops[i].size,t);{const n=As(e.stops[i].size,t);return n+(As(e.stops[s].size,t)-n)*r}}function Ds(t,e){const i=Rs.a[e.valueUnit],s=As(e.minSize,t),r=As(e.maxSize,t),{valueRepresentation:n}=e;let a=null;return a="area"===n?2*Math.sqrt(t/Bs)/i:"radius"===n||"distance"===n?2*t/i:t/i,(0,gs.uZ)(a,s,r)}function Ns(t,e){if(!e)return;let i=0,s=e.length-1;return e.some(((e,r)=>t<e?(s=r,!0):(i=r,!1))),[i,s,(t-e[i])/(e[s]-e[i])]}const Us=254,Ls=255,zs=0;function Gs(t,e){const i=[];t.forEachTile((t=>i.push(t))),i.sort(((t,e)=>t.instanceId-e.instanceId)),i.forEach((t=>{(0,a.pC)(t.labelMetrics)&&t.isReady&&e(t,t.labelMetrics.getCursor())}))}function ks(t){return"feature"===t.layer.type||"csv"===t.layer.type||"geojson"===t.layer.type||"ogc-feature"===t.layer.type||"stream"===t.layer.type||"subtype-group"===t.layer.type||"wfs"===t.layer.type}function Vs(t){return e=>(0,lt.F2)(Cs(e,t))}function Ws(t){const e="visualVariables"in t&&t.visualVariables;if(!e)return null;for(const i of e)if("size"===i.type)return Vs(i);return null}function Xs(t){for(const i of t){var e;const t="featureReduction"in i&&"cluster"===(null==(e=i.featureReduction)?void 0:e.type)&&i.featureReduction,s=[...i.labelingInfo||[],...t.labelingInfo||[]];if(i.labelsVisible&&s.length&&s.some((t=>"none"===t.deconflictionStrategy)))return!0}return!1}function Hs(t,e){if(!ks(e))return;const i="subtype-group"===e.layer.type?e.layer.sublayers.items:[e.layer],s=e.layer.geometryType,r=!Xs(i),n={};if("subtype-group"!==e.layer.type){if("heatmap"===e.layer.renderer.type)return;const t=Ws(e.layer.renderer);n[0]=t}const o=e.tileRenderer;if((0,a.Wi)(o))return;const l=e.layer.visible&&!e.suspended;t.push({tileRenderer:o,vvEvaluators:n,deconflictionEnabled:r,geometryType:s,visible:l})}class qs{run(t,e,i){const s=[];for(let r=t.length-1;r>=0;r--)Hs(s,t[r]);this._transformMetrics(s,e),this._runCollision(s,e,i)}_runCollision(t,e,i){const[s,r]=e.state.size,n=new ys(s*e.pixelRatio,r*e.pixelRatio);for(const{tileRenderer:a,deconflictionEnabled:o,visible:l}of t){const t=a.featuresView.attributeView;o?l?(this._prepare(a),this._collideVisible(n,a,i),this._collideInvisible(n,a)):Gs(a,((e,i)=>{for(;i.nextId();)t.setLabelMinZoom(i.id,Ls)})):Gs(a,((e,i)=>{for(;i.nextId();)t.setLabelMinZoom(i.id,zs)}))}}_isFiltered(t,e,i){const s=e.getFilterFlags(t),r=!i.hasFilter||!!(s&ct.Zd),n=!(0,a.pC)(i.featureEffect)||i.featureEffect.excludedLabelsVisible||!!(s&ct.iV);return!(r&&n)}_prepare(t){const e=t.featuresView.attributeView,i=new Set;Gs(t,((s,r)=>{for(;r.nextId();)i.has(r.id)||(i.add(r.id),this._isFiltered(r.id,e,t.layerView)?e.setLabelMinZoom(r.id,Us):e.getLabelMinZoom(r.id)!==zs?e.setLabelMinZoom(r.id,Ls):e.setLabelMinZoom(r.id,zs))}))}_collideVisible(t,e,i){const s=e.featuresView.attributeView,r=new Set;Gs(e,((e,n)=>{for(;n.nextId();)if(!r.has(n.id))if(e.key.level===i){if(0===s.getLabelMinZoom(n.id))switch(t.insertMetrics(n)){case ws:break;case xs:s.setLabelMinZoom(n.id,Us),r.add(n.id);break;case Ts:s.setLabelMinZoom(n.id,zs),r.add(n.id)}}else s.setLabelMinZoom(n.id,Us)}))}_collideInvisible(t,e){const i=e.featuresView.attributeView,s=new Set;Gs(e,((e,r)=>{for(;r.nextId();)if(!s.has(r.id)&&i.getLabelMinZoom(r.id)===Ls)switch(t.insertMetrics(r)){case ws:break;case xs:i.setLabelMinZoom(r.id,Ls),s.add(r.id);break;case Ts:i.setLabelMinZoom(r.id,zs),s.add(r.id)}}))}_transformMetrics(t,e){for(const{tileRenderer:i,geometryType:s,vvEvaluators:r}of t)Gs(i,((t,n)=>{const o=i.featuresView.attributeView,l=t.transforms.labelMat2d;l[4]=Math.round(l[4]),l[5]=Math.round(l[5]);const h=l[4],u=l[5],c="polyline"===s;for(;n.next();){const t=n.boundsCount,i=n.anchorX,s=n.anchorY;let d=n.size;const _=r[0];if((0,a.pC)(_)){const t=_(o.getVVSize(n.id));d=isNaN(t)||null==t||t===1/0?d:t}const f=n.directionX*(d/2),p=n.directionY*(d/2);for(let r=0;r<t;r++){let t=i,a=n.anchorY;if(c){let i=t+n.boundsX(r)+f,s=a+n.boundsY(r)+p;e.state.rotation?(i=l[0]*i+l[2]*s+l[4],s=l[1]*i+l[3]*s+l[5]):(i+=h,s+=u),n.setBoundsComputedAnchorX(r,Math.floor(i)),n.setBoundsComputedAnchorY(r,Math.floor(s))}else{e.state.rotation?(t=l[0]*i+l[2]*s+l[4],a=l[1]*i+l[3]*s+l[5]):(t+=h,a+=u);const o=t+n.boundsX(r)+f,c=a+n.boundsY(r)+p;n.setBoundsComputedAnchorX(r,o),n.setBoundsComputedAnchorY(r,c)}}}}))}}const Zs=32,Ys=at.Z.getLogger("esri.views.2d.layers.labels.LabelManager");let js=class extends((0,_s.p)(ds.Z)){constructor(t){super(t),this._applyVisibilityPassThrottled=(0,fs.P)(this._applyVisibilityPass,Zs,this),this.lastUpdateId=-1,this.updateRequested=!1,this.view=null}initialize(){this.collisionEngine=new qs}destroy(){this.collisionEngine=null,this._applyVisibilityPassThrottled.remove(),this._applyVisibilityPassThrottled=null}get updating(){return this.updateRequested}update(t){this._applyVisibilityPassThrottled(t)}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())}processUpdate(t){this._set("updateParameters",t),this.updateRequested&&(this.updateRequested=!1,this.update(t))}_applyVisibilityPass(t){try{const e=this.view.featuresTilingScheme.getClosestInfoForScale(t.state.scale).level;this.collisionEngine.run(this.view.allLayerViews.items,t,e)}catch(x){Ys.error(new s.Z("mapview-labeling","Encountered an error during label decluttering",x))}}};(0,cs._)([(0,ps.Cb)()],js.prototype,"updateRequested",void 0),(0,cs._)([(0,ps.Cb)({readOnly:!0})],js.prototype,"updateParameters",void 0),(0,cs._)([(0,ps.Cb)()],js.prototype,"updating",null),(0,cs._)([(0,ps.Cb)()],js.prototype,"view",void 0),js=(0,cs._)([(0,ms.j)("esri.views.2d.layers.labels.LabelManager")],js);const Ks=js;var $s=i(68493),Qs=i(57914),Js=i(57457),tr=i(49304),er=i(25063),ir=i(89545);const sr={container:"esri-zoom-box__container",overlay:"esri-zoom-box__overlay",background:"esri-zoom-box__overlay-background",box:"esri-zoom-box__outline"},rr={zoom:"Shift",counter:"Ctrl"};let nr=class extends ds.Z{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(t){this._handles&&this._handles.forEach((t=>{t.remove()})),this._handles=null,this._destroyOverlay(),this._set("view",t),t&&(t.on("drag",[rr.zoom],(t=>this._handleDrag(t,1)),ir.f.INTERNAL),t.on("drag",[rr.zoom,rr.counter],(t=>this._handleDrag(t,-1)),ir.f.INTERNAL))}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(t,e,i,s){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=s,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(t,e,i,s,r){const n=this.view,a=n.toMap((0,lt.vW)(t+.5*i,e+.5*s));let o=Math.max(i/n.width,s/n.height);-1===r&&(o=1/o),this._destroyOverlay(),this.navigation.end(),n.goTo({center:a,scale:n.scale*o})}_updateBox(t,e,i,s){const r=this._boxShape;r.setAttributeNS(null,"x",""+t),r.setAttributeNS(null,"y",""+e),r.setAttributeNS(null,"width",""+i),r.setAttributeNS(null,"height",""+s),r.setAttributeNS(null,"class",sr.box)}_updateBackground(t,e,i,s){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,i,s,this.view.width,this.view.height))}_createContainer(){const t=document.createElement("div");t.className=sr.container,this.view.root.appendChild(t),this._container=t}_createOverlay(){const t=this.view.width,e=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),i.setAttributeNS(null,"class",sr.background);const s=document.createElementNS("http://www.w3.org/2000/svg","rect"),r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),r.setAttributeNS(null,"class",sr.overlay),r.appendChild(i),r.appendChild(s),this._container.appendChild(r),this._backgroundShape=i,this._boxShape=s,this._overlay=r}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(t,e,i,s,r,n){const a=t+i,o=e+s;return"M 0 0 L "+r+" 0 L "+r+" "+n+" L 0 "+n+" ZM "+t+" "+e+" L "+t+" "+o+" L "+a+" "+o+" L "+a+" "+e+" Z"}_handleDrag(t,e){const i=t.x,s=t.y,r=t.origin.x,n=t.origin.y;let a,o,l,h;switch(i>r?(a=r,l=i-r):(a=i,l=r-i),s>n?(o=n,h=s-n):(o=s,h=n-s),t.action){case"start":this._start();break;case"update":this._update(a,o,l,h);break;case"end":this._end(a,o,l,h,e)}t.stopPropagation()}_redraw(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:t,y:e,width:i,height:s}=this._box;this._updateBox(t,e,i,s),this._updateBackground(t,e,i,s),this._rafId=requestAnimationFrame(this._redraw)}};(0,cs._)([(0,ps.Cb)()],nr.prototype,"navigation",void 0),(0,cs._)([(0,ps.Cb)()],nr.prototype,"view",null),nr=(0,cs._)([(0,ms.j)("esri.views.2d.navigation.ZoomBox")],nr);const ar=nr;i(80388);var or=i(18105),lr=i(65554);class hr{constructor(t){this.gain=t}update(t){if(this.hasLastValue){const e=this.computeDelta(t);this._updateDelta(e)}this.lastValue=t}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return void 0!==this.lastValue}get hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(t){return t-this.lastValue}_updateDelta(t){this.hasFilteredDelta?this.filteredDelta=(1-this.gain)*this.filteredDelta+this.gain*t:this.filteredDelta=t}}class ur{constructor(t,e,i){this._initialVelocity=t,this._stopVelocity=e,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(t){return t>this.duration}get friction(){return this._friction}value(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}valueDelta(t,e){const i=this.value(t);return this.value(t+e)-i}valueFromInitialVelocity(t,e){e=Math.min(e,this.duration);const i=1-this.friction;return t*(i**e-1)/Math.log(i)}}class cr extends ur{constructor(t,e,i,s,r){super(t,e,i),this.sceneVelocity=s,this.direction=r}value(t){return super.valueFromInitialVelocity(this.sceneVelocity,t)}}class dr{constructor(t=300,e=12,i=.84){this.minimumInitialVelocity=t,this.stopVelocity=e,this.friction=i,this.enabled=!0,this.time=new hr(.6),this.screen=[new hr(.4),new hr(.4)],this.scene=[new hr(.6),new hr(.6),new hr(.6)],this.tmpDirection=(0,Pi.c)()}add(t,e,i){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(i)<.015)return;this.screen[0].update(t[0]),this.screen[1].update(t[1]),this.scene[0].update(e[0]),this.scene[1].update(e[1]),this.scene[2].update(e[2]),this.time.update(i)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const t=this.screen[0].filteredDelta,e=this.screen[1].filteredDelta,i=Math.sqrt(t*t+e*e)/this.time.filteredDelta;return Math.abs(i)<this.minimumInitialVelocity?null:this.createMomentum(i,this.stopVelocity,this.friction)}createMomentum(t,e,i){(0,lr.s)(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const s=(0,lr.l)(this.tmpDirection);s>0&&(0,lr.a)(this.tmpDirection,this.tmpDirection,1/s);const r=s/this.time.filteredDelta;return new cr(t,e,i,r,this.tmpDirection)}}let _r=class extends ds.Z{constructor(t){super(t),this.animationTime=0,this.momentumEstimator=new dr(500,6,.92),this.momentum=null,this.tmpMomentum=(0,Pi.c)(),this.momentumFinished=!1,this.viewpoint=new Js.Z({targetGeometry:new tr.Z,scale:0,rotation:0}),(0,or.gx)((()=>this.momentumFinished),(()=>this.navigation.stop()))}begin(t,e){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(e),this.previousDrag=e}update(t,e){this.addToEstimator(e);let i=e.center.x,s=e.center.y;const r=this.previousDrag;i=r?r.center.x-i:-i,s=r?s-r.center.y:s,t.viewpoint=(0,er.Rx)(this.viewpoint,t.viewpoint,[i||0,s||0]),this.previousDrag=e}end(t,e){this.addToEstimator(e);const i=t.navigation.momentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this.previousDrag=null,this.navigation.end()}addToEstimator(t){const e=t.center.x,i=t.center.y,s=(0,lt.s1)(-e,i),r=(0,Pi.f)(-e,i,0);this.momentumEstimator.add(s,r,.001*t.timestamp)}onAnimationUpdate(t){this.navigation.animationManager.animateContinous(t.viewpoint,((e,i)=>{this.momentumFinished=!this.momentum||this.momentum.isFinished(this.animationTime);const s=.001*i;if(!this.momentumFinished){const i=this.momentum.valueDelta(this.animationTime,s);(0,lr.a)(this.tmpMomentum,this.momentum.direction,i),(0,er.Rx)(e,e,this.tmpMomentum),t.constraints.constrainByGeometry(e)}this.animationTime+=s}))}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}};(0,cs._)([(0,ps.Cb)()],_r.prototype,"momentumFinished",void 0),(0,cs._)([(0,ps.Cb)()],_r.prototype,"viewpoint",void 0),(0,cs._)([(0,ps.Cb)()],_r.prototype,"navigation",void 0),_r=(0,cs._)([(0,ms.j)("esri.views.2d.navigation.actions.Pan")],_r);const fr=_r;class pr{constructor(t=2.5,e=.01,i=.95,s=12){this.minimumInitialVelocity=t,this.stopVelocity=e,this.friction=i,this.maxVelocity=s,this.enabled=!0,this.value=new hr(.8),this.time=new hr(.3)}add(t,e){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(e)<.01)return;if(this.value.hasFilteredDelta){const e=this.value.computeDelta(t);this.value.filteredDelta*e<0&&this.value.reset()}}this.time.update(e),this.value.update(t)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let t=this.value.filteredDelta/this.time.filteredDelta;return t=(0,gs.uZ)(t,-this.maxVelocity,this.maxVelocity),Math.abs(t)<this.minimumInitialVelocity?null:this.createMomentum(t,this.stopVelocity,this.friction)}createMomentum(t,e,i){return new ur(t,e,i)}}class mr extends pr{constructor(t=3,e=.01,i=.95,s=12){super(t,e,i,s)}add(t,e){if(this.value.hasLastValue){const e=this.value.lastValue;let i=t-e;for(;i>Math.PI;)i-=2*Math.PI;for(;i<-Math.PI;)i+=2*Math.PI;t=e+i}super.add(t,e)}}class gr extends ur{constructor(t,e,i){super(t,e,i)}value(t){const e=super.value(t);return Math.exp(e)}valueDelta(t,e){const i=super.value(t),s=super.value(t+e)-i;return Math.exp(s)}}class br extends pr{constructor(t=2.5,e=.01,i=.95,s=12){super(t,e,i,s)}add(t,e){super.add(Math.log(t),e)}createMomentum(t,e,i){return new gr(t,e,i)}}let vr=class extends ds.Z{constructor(t){super(t),this._animationTime=0,this._momentumFinished=!1,this._rotationMomentumEstimator=new mr(.6,.15,.95),this._rotationDirection=1,this._zoomDirection=1,this._zoomMomentumEstimator=new br,this._zoomOnly=null,this.zoomMomentum=null,this.rotateMomentum=null,this.viewpoint=new Js.Z({targetGeometry:new tr.Z,scale:0,rotation:0}),this.watch("_momentumFinished",(t=>{t&&this.navigation.stop()}))}begin(t,e){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=e.angle,this._previousRadius=this._startRadius=e.radius,this._previousCenter=e.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,e.timestamp),this.addToZoomEstimator(e,1)}update(t,e){null===this._updateTimestamp&&(this._updateTimestamp=e.timestamp);const i=e.angle,s=e.radius,r=e.center,n=Math.abs(180*(i-this._startAngle)/Math.PI),a=Math.abs(s-this._startRadius),o=this._startRadius/s;if(this._previousRadius){const l=s/this._previousRadius;let h=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=h>=0?1:-1,this._zoomDirection=l>=1?1:-1,t.constraints.rotationEnabled?(null===this._zoomOnly&&e.timestamp-this._updateTimestamp>200&&(this._zoomOnly=a-n>0),null===this._zoomOnly||this._zoomOnly?h=0:this.addToRotateEstimator(i-this._startAngle,e.timestamp)):h=0,this.addToZoomEstimator(e,o),this.navigation.setViewpoint([r.x,r.y],1/l,h,[this._previousCenter.x-r.x,r.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=s,this._previousCenter=r}end(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}addToRotateEstimator(t,e){this._rotationMomentumEstimator.add(t,.001*e)}addToZoomEstimator(t,e){this._zoomMomentumEstimator.add(e,.001*t.timestamp)}canZoomIn(t){const e=t.scale,i=t.constraints.effectiveMaxScale;return 0===i||e>i}canZoomOut(t){const e=t.scale,i=t.constraints.effectiveMinScale;return 0===i||e<i}onAnimationUpdate(t){this.navigation.animationManager.animateContinous(t.viewpoint,((e,i)=>{const s=!this.canZoomIn(t)&&this._zoomDirection>1||!this.canZoomOut(t)&&this._zoomDirection<1,r=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),n=s||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),a=.001*i;if(this._momentumFinished=r&&n,!this._momentumFinished){const i=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,a))*this._rotationDirection*180/Math.PI:0;let s=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,a)):1;const r=(0,f.a)(),n=(0,f.a)();if(this._previousCenter){(0,_.s)(r,this._previousCenter.x,this._previousCenter.y),(0,er.Dq)(n,t.size,t.padding),(0,_.m)(r,r,n);const{constraints:a,scale:o}=t,l=o*s;s<1&&!a.canZoomInTo(l)?(s=o/a.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):s>1&&!a.canZoomOutTo(l)&&(s=o/a.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),(0,er.UZ)(e,t.viewpoint,s,i,r,t.size),t.constraints.constrainByGeometry(e)}}this._animationTime+=a}))}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}};(0,cs._)([(0,ps.Cb)()],vr.prototype,"_momentumFinished",void 0),(0,cs._)([(0,ps.Cb)()],vr.prototype,"viewpoint",void 0),(0,cs._)([(0,ps.Cb)()],vr.prototype,"navigation",void 0),vr=(0,cs._)([(0,ms.j)("esri.views.2d.navigation.actions.Pinch")],vr);const Er=vr,Tr=(0,f.a)(),wr=(0,f.a)();let xr=class extends ds.Z{constructor(t){super(t),this._previousCenter=(0,f.a)(),this.viewpoint=new Js.Z({targetGeometry:new tr.Z,scale:0,rotation:0})}begin(t,e){this.navigation.begin(),(0,_.s)(this._previousCenter,e.center.x,e.center.y)}update(t,e){const{state:{size:i,padding:s}}=t;(0,_.s)(Tr,e.center.x,e.center.y),(0,er.ni)(wr,i,s),t.viewpoint=(0,er.$H)(this.viewpoint,t.state.paddedViewState.viewpoint,(0,er.dI)(wr,this._previousCenter,Tr)),(0,_.c)(this._previousCenter,Tr)}end(){this.navigation.end()}};(0,cs._)([(0,ps.Cb)()],xr.prototype,"viewpoint",void 0),(0,cs._)([(0,ps.Cb)()],xr.prototype,"navigation",void 0),xr=(0,cs._)([(0,ms.j)("esri.views.2d.actions.Rotate")],xr);const yr=xr,Rr=10,Fr=1,Br=new Js.Z({targetGeometry:new tr.Z}),Cr=[0,0],Ar=250;let Sr=class extends ds.Z{constructor(t){super(t),this._endTimer=null,this.animationManager=null}initialize(){this.pan=new fr({navigation:this}),this.rotate=new yr({navigation:this}),this.pinch=new Er({navigation:this}),this.zoomBox=new ar({view:this.view,navigation:this})}destroy(){this.pan.destroy(),this.rotate.destroy(),this.pinch.destroy(),this.zoomBox.destroy(),this.pan=this.rotate=this.pinch=this.zoomBox=this.animationManager=null}begin(){this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(Ar)}async zoom(t,e=this._getDefaultAnchor()){if(this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return t<1?this.zoomIn(e):this.zoomOut(e);this.setViewpoint(e,t,0,[0,0])}async zoomIn(t){const e=this.view,i=e.constraints.snapToNextScale(e.scale);return this._zoomToScale(i,t)}async zoomOut(t){const e=this.view,i=e.constraints.snapToPreviousScale(e.scale);return this._zoomToScale(i,t)}setViewpoint(t,e,i,s){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,e,i,s),this.end()}setViewpointImmediate(t,e=0,i=[0,0],s=this._getDefaultAnchor()){this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,s,t,e,i)}continousRotateClockwise(){const t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(t=>{(0,er.$H)(t,t,-Fr)}))}continousRotateCounterclockwise(){const t=this.get("view.viewpoint");this.animationManager.animateContinous(t,(t=>{(0,er.$H)(t,t,Fr)}))}resetRotation(){this.view.rotation=0}continousPanLeft(){this._continuousPan([-Rr,0])}continousPanRight(){this._continuousPan([Rr,0])}continousPanUp(){this._continuousPan([0,Rr])}continousPanDown(){this._continuousPan([0,-Rr])}stop(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(t){const e=this.view.viewpoint;this.animationManager.animateContinous(e,(e=>{(0,er.Rx)(e,e,t),this.view.constraints.constrainByGeometry(e)}))}_startTimer(t){return null!==this._endTimer||(this._endTimer=setTimeout((()=>{this._endTimer=null;const t=performance.now()-this._lastEventTimestamp;t<Ar?this._endTimer=this._startTimer(t):this._set("interacting",!1)}),t)),this._endTimer}_getDefaultAnchor(){const{size:t,padding:{left:e,right:i,top:s,bottom:r}}=this.view;return Cr[0]=.5*(t[0]-i+e),Cr[1]=.5*(t[1]-r+s),Cr}async _zoomToScale(t,e=this._getDefaultAnchor()){const{view:i}=this,{constraints:s,scale:r,viewpoint:n,size:a,padding:o}=i,l=s.canZoomInTo(t),h=s.canZoomOutTo(t);if(!(t<r&&!l||t>r&&!h))return(0,er.gG)(Br,n,t/r,0,e,a,o),s.constrainByGeometry(Br),i.goTo(Br,{animate:!0})}_scaleRotateTranslateViewpoint(t,e,i,s,r){const{view:n}=this,{size:a,padding:o,constraints:l,scale:h,viewpoint:u}=n,c=h*i,d=l.canZoomInTo(c),_=l.canZoomOutTo(c);return(i<1&&!d||i>1&&!_)&&(i=1),(0,er.Rx)(u,u,r),(0,er.gG)(t,u,i,s,e,a,o),l.constrainByGeometry(t)}};(0,cs._)([(0,ps.Cb)()],Sr.prototype,"animationManager",void 0),(0,cs._)([(0,ps.Cb)({type:Boolean,readOnly:!0})],Sr.prototype,"interacting",void 0),(0,cs._)([(0,ps.Cb)()],Sr.prototype,"pan",void 0),(0,cs._)([(0,ps.Cb)()],Sr.prototype,"pinch",void 0),(0,cs._)([(0,ps.Cb)()],Sr.prototype,"rotate",void 0),(0,cs._)([(0,ps.Cb)()],Sr.prototype,"view",void 0),(0,cs._)([(0,ps.Cb)()],Sr.prototype,"zoomBox",void 0),Sr=(0,cs._)([(0,ms.j)("esri.views.2d.navigation.MapViewNavigation")],Sr);const Or=Sr;var Mr=i(50816),Ir=i(99659),Pr=i(75393);const Dr={shaders:{vertexShader:(0,V.w)("magnifier/magnifier.vert"),fragmentShader:(0,V.w)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};function Nr(t){return(0,q.H)(t,Dr)}var Ur=i(50740);async function Lr(t){const e=i.e(6054).then(i.bind(i,96054)),s=i.e(5068).then(i.bind(i,65068)),r=(0,Ur.t)((await e).default,{signal:t}),n=(0,Ur.t)((await s).default,{signal:t}),a={mask:await r,overlay:await n};return(0,ot.k_)(t),a}class zr extends Pr.s{constructor(){super(),this._handles=new Mr.Z,this._resourcePixelRatio=1,this.visible=!1}destroy(){this._handles.destroy(),this._handles=null,this._disposeRenderResources(),this._resourcesTask&&(this._resourcesTask.abort(),this._resourcesTask=null)}get background(){return this._background}set background(t){this._background=t,this.requestRender()}get magnifier(){return this._magnifier}set magnifier(t){this._magnifier=t,this._handles.removeAll(),this._handles.add([(0,l.S1)(t,"version",(()=>{this.visible=t.visible&&(0,a.pC)(t.position)&&t.size>0,this.requestRender()})),t.watch(["mask","overlay"],(()=>this._reloadResources())),t.watch("size",(()=>{this._disposeRenderResources(),this.requestRender()}))])}_createTransforms(){return{dvs:(0,d.c)()}}doRender(t){var e;const i=t.context;if(!this._resourcesTask)return void this._reloadResources();if(t.drawPhase!==g.jx.MAP||!this._canRender())return;this._updateResources(t);const s=this._magnifier;if((0,a.Wi)(s.position))return;const r=t.pixelRatio,n=s.size*r,o=1/s.factor,l=Math.ceil(o*n);this._readbackTexture.resize(l,l);const{size:h}=t.state,u=r*h[0],c=r*h[1],d=.5*l,_=.5*l,f=(0,gs.uZ)(r*s.position.x,d,u-d-1),p=(0,gs.uZ)(c-r*s.position.y,_,c-_-1);i.setBlendingEnabled(!0);const m=f-d,b=p-_,v=this._readbackTexture;i.bindTexture(v,0),i.gl.copyTexImage2D(v.descriptor.target,0,v.descriptor.pixelFormat,m,b,l,l,0);const E=null==(e=this.background)?void 0:e.color,T=E?[E.a*E.r/255,E.a*E.g/255,E.a*E.b/255,E.a]:[1,1,1,1],w=(f+s.offset.x*r)/u*2-1,x=(p-s.offset.y*r)/c*2-1,y=n/u*2,R=n/c*2,F=this._program;i.bindVAO(this._vertexArrayObject),i.bindTexture(this._overlayTexture,6),i.bindTexture(this._maskTexture,7),i.useProgram(F),F.setUniform4fv("u_background",T),F.setUniform1i("u_readbackTexture",0),F.setUniform1i("u_overlayTexture",6),F.setUniform1i("u_maskTexture",7),F.setUniform4f("u_drawPos",w,x,y,R),F.setUniform1i("u_maskEnabled",s.maskEnabled?1:0),F.setUniform1i("u_overlayEnabled",s.overlayEnabled?1:0),i.setStencilTestEnabled(!1),i.setColorMask(!0,!0,!0,!0),i.drawArrays(H.MX.TRIANGLE_STRIP,0,4),i.bindVAO()}_canRender(){return this.mask&&this.overlay&&null!=this._magnifier}_reloadResources(){this._resourcesTask&&this._resourcesTask.abort();const t=(0,a.pC)(this._magnifier)?this._magnifier.maskUrl:null,e=(0,a.pC)(this._magnifier)?this._magnifier.overlayUrl:null;this._resourcesTask=(0,ot.vr)((async i=>{const s=(0,a.Wi)(t)||(0,a.Wi)(e)?Lr(i):null,r=(0,a.pC)(t)?(0,rt["default"])(t,{responseType:"image",signal:i}).then((t=>t.data)):s.then((t=>t.mask)),n=(0,a.pC)(e)?(0,rt["default"])(e,{responseType:"image",signal:i}).then((t=>t.data)):s.then((t=>t.overlay)),[o,l]=await Promise.all([r,n]);this.mask=o,this.overlay=l,this._disposeRenderResources(),this.requestRender()}))}_disposeRenderResources(){this._readbackTexture=(0,a.O3)(this._readbackTexture),this._overlayTexture=(0,a.O3)(this._overlayTexture),this._maskTexture=(0,a.O3)(this._maskTexture),this._vertexArrayObject=(0,a.O3)(this._vertexArrayObject),this._program=(0,a.O3)(this._program)}_updateResources(t){if(t.pixelRatio!==this._resourcePixelRatio&&this._disposeRenderResources(),this._readbackTexture)return;const e=t.context;this._resourcePixelRatio=t.pixelRatio;const i=Math.ceil(this._magnifier.size*t.pixelRatio);this._program=Nr(e);const s=new Uint16Array([0,1,0,0,1,1,1,0]),r=Dr.attributes;this._vertexArrayObject=new Z.U(e,r,k.cD,{geometry:X.f.createVertex(e,H.l1.STATIC_DRAW,s)}),this.overlay.width=i,this.overlay.height=i,this._overlayTexture=new pt.x(e,{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,internalFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.NEAREST,flipped:!0,preMultiplyAlpha:!(0,Ir.zd)(this.overlay.src)||!t.context.driverTest.svgAlwaysPremultipliesAlpha},this.overlay),this.mask.width=i,this.mask.height=i,this._maskTexture=new pt.x(e,{target:H.No.TEXTURE_2D,pixelFormat:H.VI.ALPHA,internalFormat:H.VI.ALPHA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.NEAREST,flipped:!0},this.mask);const n=1/this._magnifier.factor;this._readbackTexture=new pt.x(e,{target:H.No.TEXTURE_2D,pixelFormat:H.VI.RGBA,internalFormat:H.VI.RGBA,dataType:H.Br.UNSIGNED_BYTE,wrapMode:H.e8.CLAMP_TO_EDGE,samplingMode:H.cw.LINEAR,flipped:!1,width:Math.ceil(n*i),height:Math.ceil(n*i)})}}},25749:function(t,e,i){i.d(e,{Bh:function(){return _},IB:function(){return l},j7:function(){return h},je:function(){return d},ve:function(){return u},wu:function(){return a}});var s=i(81789),r=i(17923),n=i(9408);const a=(0,n.wK)(r.zi.SRC_ALPHA,r.zi.ONE,r.zi.ONE_MINUS_SRC_ALPHA,r.zi.ONE_MINUS_SRC_ALPHA),o=(0,n["if"])(r.zi.ONE,r.zi.ONE),l=(0,n["if"])(r.zi.ZERO,r.zi.ONE_MINUS_SRC_ALPHA);function h(t){return t===s.Am.FrontFace?null:t===s.Am.Alpha?l:o}const u=5e5,c={factor:-1,units:-2};function d(t){return t?c:null}function _(t,e=r.wb.LESS){return t===s.Am.NONE||t===s.Am.FrontFace?e:r.wb.LEQUAL}},81789:function(t,e,i){var s,r,n,a,o,l,h,u,c,d,_,f,p,m;i.d(e,{Am:function(){return a},CE:function(){return _},Gv:function(){return r},JJ:function(){return p},MX:function(){return d},Rw:function(){return l},Vr:function(){return s},hU:function(){return h}}),function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"}(s||(s={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(r||(r={})),function(t){t[t.NONE=0]="NONE",t[t.SMAA=1]="SMAA"}(n||(n={})),function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"}(a||(a={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(o||(o={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(l||(l={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(h||(h={})),function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"}(u||(u={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(c||(c={})),function(t){t[t.Triangle=0]="Triangle",t[t.Point=1]="Point",t[t.Line=2]="Line"}(d||(d={})),function(t){t[t.STRETCH=1]="STRETCH",t[t.PAD=2]="PAD"}(_||(_={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(f||(f={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(p||(p={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(m||(m={}))},14843:function(t,e,i){i.d(e,{G:function(){return a}});var s=i(8693);class r{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(t,e){var i;return null==(i=this._outer.get(t))?void 0:i.get(e)}set(t,e,i){const s=this._outer.get(t);s?s.set(e,i):this._outer.set(t,new Map([[e,i]]))}delete(t,e){const i=this._outer.get(t);i&&(i.delete(e),0===i.size&&this._outer.delete(t))}forEach(t){this._outer.forEach(((e,i)=>t(e,i)))}}var n=i(91588);class a{constructor(t){this._rctx=t,this._store=new r}dispose(){this._store.forEach((t=>t.forEach((t=>t.dispose())))),this._store.clear()}acquire(t,e,i,r){const a=this._store.get(t,e);if((0,s.pC)(a))return a.ref(),a;const o=new n.$(this._rctx,t,e,i,r);return o.ref(),this._store.set(t,e,o),o}get test(){let t=0;return this._store.forEach((e=>e.forEach((e=>t+=e.hasGLName?2:1)))),{cachedWebGLObjects:t}}}},12470:function(t,e,i){i.d(e,{LF:function(){return s},po:function(){return r}});i(48675),i(3462);function s(t,e,i){for(let s=0;s<i;++s)e[2*s]=t[s],e[2*s+1]=t[s]-e[2*s]}function r(t,e,i,r){for(let o=0;o<r;++o)n[0]=t[o],s(n,a,1),e[o]=a[0],i[o]=a[1]}const n=new Float64Array(1),a=new Float32Array(2)},38991:function(t,e,i){function s(t){let e="";for(const i in t){const s=t[i];if("boolean"==typeof s)s&&(e+=`#define ${i}\n`);else if("number"==typeof s)e+=`#define ${i} ${s.toFixed()}\n`;else if("object"==typeof s){const t=s.options;let r=0;for(const i in t)e+=`#define ${t[i]} ${(r++).toFixed()}\n`;e+=`#define ${i} ${t[s.value]}\n`}}return e}i.d(e,{K:function(){return s}})},9408:function(t,e,i){i.d(e,{BK:function(){return c},LZ:function(){return u},if:function(){return n},jp:function(){return k},sm:function(){return E},wK:function(){return a},zp:function(){return h}});var s=i(81789),r=i(17923);function n(t,e,i=r.db.ADD,s=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:s[0],g:s[1],b:s[2],a:s[3]}}}function a(t,e,i,s,n=r.db.ADD,a=r.db.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:s,opRgb:n,opAlpha:a,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const o={face:r.LR.BACK,mode:r.Wf.CCW},l={face:r.LR.FRONT,mode:r.Wf.CCW},h=t=>t===s.Vr.Back?o:t===s.Vr.Front?l:null,u={zNear:0,zFar:1},c={r:!0,g:!0,b:!0,a:!0};function d(t){return x.intern(t)}function _(t){return R.intern(t)}function f(t){return B.intern(t)}function p(t){return A.intern(t)}function m(t){return O.intern(t)}function g(t){return I.intern(t)}function b(t){return D.intern(t)}function v(t){return U.intern(t)}function E(t){return z.intern(t)}class T{constructor(t,e){this.makeKey=t,this.makeRef=e,this.interns=new Map}intern(t){if(!t)return null;const e=this.makeKey(t),i=this.interns;return i.has(e)||i.set(e,this.makeRef(t)),i.get(e)}}function w(t){return"["+t.join(",")+"]"}const x=new T(y,(t=>({__tag:"Blending",...t})));function y(t){return t?w([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const R=new T(F,(t=>({__tag:"Culling",...t})));function F(t){return t?w([t.face,t.mode]):null}const B=new T(C,(t=>({__tag:"PolygonOffset",...t})));function C(t){return t?w([t.factor,t.units]):null}const A=new T(S,(t=>({__tag:"DepthTest",...t})));function S(t){return t?w([t.func]):null}const O=new T(M,(t=>({__tag:"StencilTest",...t})));function M(t){return t?w([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const I=new T(P,(t=>({__tag:"DepthWrite",...t})));function P(t){return t?w([t.zNear,t.zFar]):null}const D=new T(N,(t=>({__tag:"ColorWrite",...t})));function N(t){return t?w([t.r,t.g,t.b,t.a]):null}const U=new T(L,(t=>({__tag:"StencilWrite",...t})));function L(t){return t?w([t.mask]):null}const z=new T(G,(t=>({blending:d(t.blending),culling:_(t.culling),polygonOffset:f(t.polygonOffset),depthTest:p(t.depthTest),stencilTest:m(t.stencilTest),depthWrite:g(t.depthWrite),colorWrite:b(t.colorWrite),stencilWrite:v(t.stencilWrite)})));function G(t){return t?w([y(t.blending),F(t.culling),C(t.polygonOffset),S(t.depthTest),M(t.stencilTest),P(t.depthWrite),N(t.colorWrite),L(t.stencilWrite)]):null}class k{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(t,e,i,s){return(i||t!==e)&&(s(t),this._pipelineInvalid=!0),t}}}}]);
//# sourceMappingURL=4342.f66b51da.js.map