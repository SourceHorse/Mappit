"use strict";(self["webpackChunkmappitweb"]=self["webpackChunkmappitweb"]||[]).push([[9593],{71290:function(e,t,n){n.d(t,{QM:function(){return i},hy:function(){return s},uI:function(){return o}});n(48675),n(3462);var r=n(67752);const o=(()=>{if(!("document"in globalThis))return()=>null;const e=document.createElement("canvas"),t=e.getContext("2d"),n=512;return e.height=n,e.width=1,n=>{t.clearRect(0,0,1,e.height);const r=t.createLinearGradient(0,0,0,e.height);for(const{ratio:e,color:t}of n)r.addColorStop(Math.max(e,.001),`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a})`);return t.fillStyle=r,t.fillRect(0,0,1,e.height),t.getImageData(0,0,1,e.height).data}})();function i(e,t,n,r){const{blurRadius:o,fieldOffset:i,field:s}=t,a=new Float64Array(n*r),u=l(o),d=Math.round(3*o);let h,f=Number.NEGATIVE_INFINITY;const p=c(s,i),y=new Set;for(const l of e){const e=l.getCursor();for(;e.next();){const t=e.getObjectId();if(y.has(t))continue;y.add(t);const o=e.readLegacyPointGeometry(),i=128;if(o.x<-i||o.x>=n+i||o.y<-i||o.y>r+i)continue;const s=+p(e),l=Math.round(o.x)-d,c=Math.round(o.y)-d,m=Math.max(0,l),w=Math.max(0,c),g=Math.min(r,Math.round(o.y)+d),M=Math.min(n,Math.round(o.x)+d);for(let e=w;e<g;e++){const t=u[e-c];for(let r=m;r<M;r++){const o=u[r-l];h=a[e*n+r]+=t*o*s,h>f&&(f=h)}}}}return{matrix:a.buffer,max:f}}function s(e,t,n,r,o,i){e.canvas.width=e.canvas.height=t,e.clearRect(0,0,t,t);const s=e.getImageData(0,0,t,t);n&&r&&s.data.set(new Uint8ClampedArray(a(t,n,r,o,i))),e.putImageData(s,0,0)}function a(e,t,n,o,i){const s=new Uint32Array(e*e),a="buffer"in t?t:new Float64Array(t),l="buffer"in n?new Uint32Array(n.buffer):new Uint32Array(new Uint8Array(n).buffer),c=l.length/(i-o);for(let u=0;u<a.length;u++){const e=a[u],t=Math.floor((e-o)*c);s[u]=l[(0,r.uZ)(t,0,l.length-1)]}return s.buffer}function l(e){const t=Math.round(3*e),n=2*e*e,r=new Float64Array(2*t+1);for(let o=0;o<=r.length;o++)r[o]=Math.exp(-((o-t)**2)/n)/Math.sqrt(2*Math.PI)*(e/2);return r}function c(e,t){return null!=e?"string"==typeof t?t=>-1*+t.readAttribute(e):n=>+n.readAttribute(e)+t:e=>1}},80587:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(61445),o=n(30374),i=n(58006),s=(n(15055),n(81653),n(94315),n(77623));let a=class extends o.r{initialize(){}destroy(){}get supportsTileUpdates(){return!1}get spatialReference(){const e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}};(0,r._)([(0,i.Cb)({readOnly:!0})],a.prototype,"supportsTileUpdates",null),(0,r._)([(0,i.Cb)({constructOnly:!0})],a.prototype,"remoteClient",void 0),(0,r._)([(0,i.Cb)({constructOnly:!0})],a.prototype,"service",void 0),(0,r._)([(0,i.Cb)()],a.prototype,"spatialReference",null),(0,r._)([(0,i.Cb)({constructOnly:!0})],a.prototype,"tileInfo",void 0),(0,r._)([(0,i.Cb)({constructOnly:!0})],a.prototype,"tileStore",void 0),a=(0,r._)([(0,s.j)("esri.views.2d.layers.features.processors.BaseProcessor")],a);const l=a},29593:function(e,t,n){n.r(t),n.d(t,{default:function(){return p}});var r=n(61445),o=(n(81653),n(8693)),i=(n(93622),n(94315),n(15055),n(10771),n(77623)),s=n(67154),a=n(71290),l=n(19440),c=n(80587),u=n(87051);class d{constructor(e,t){this.offset=e,this.extent=t}}function h(e){const t=e.key,n=new Map,r=256,o=l.I_,i=e.tileInfoView.tileInfo.isWrappable;return n.set((0,u.M)(t,-1,-1,i).id,new d([-o,-o],[o-r,o-r,o,o])),n.set((0,u.M)(t,0,-1,i).id,new d([0,-o],[0,o-r,o,o])),n.set((0,u.M)(t,1,-1,i).id,new d([o,-o],[0,o-r,r,o])),n.set((0,u.M)(t,-1,0,i).id,new d([-o,0],[o-r,0,o,o])),n.set((0,u.M)(t,1,0,i).id,new d([o,0],[0,0,r,o])),n.set((0,u.M)(t,-1,1,i).id,new d([-o,o],[o-r,0,o,r])),n.set((0,u.M)(t,0,1,i).id,new d([0,o],[0,0,o,r])),n.set((0,u.M)(t,1,1,i).id,new d([o,o],[0,0,r,r])),n}let f=class extends c.Z{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}async update(e,t){const n=t.schema.processors[0];"heatmap"===n.type&&(0,s.Hg)(this._schema,n)&&(e.mesh=!0,this._schema=n)}onTileUpdate(e){for(const t of e.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(e){const t={clear:!0};return this._tileKeyToFeatureSets.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:t})}async onTileMessage(e,t,n){this._tileKeyToFeatureSets.has(e.key.id)||this._tileKeyToFeatureSets.set(e.key.id,new Map);const r=this._tileKeyToFeatureSets.get(e.key.id);if((0,o.pC)(t.addOrUpdate)&&t.addOrUpdate.hasFeatures&&r.set(t.addOrUpdate.instance,t),t.end){const t=[],r=h(e);this._tileKeyToFeatureSets.forEach(((n,i)=>{if(i===e.key.id)n.forEach((e=>(0,o.yw)(e.addOrUpdate,(e=>t.push(e)))));else if(r.has(i)){const e=r.get(i),[s,a]=e.offset;n.forEach((e=>(0,o.yw)(e.addOrUpdate,(e=>{const n=e.transform(s,a,1,1);t.push(n)}))))}}));const i=(0,a.QM)(t,this._schema.mesh,512,512),s={tileKey:e.key.id,intensityInfo:i},l=[i.matrix];return this.remoteClient.invoke("tileRenderer.onTileData",s,{...n,transferList:l})}}onTileError(e,t,n){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:e.id,error:t},n)}};f=(0,r._)([(0,i.j)("esri.views.2d.layers.features.processors.HeatmapProcessor")],f);const p=f},87051:function(e,t,n){n.d(t,{M:function(){return r}});n(66665);function r(e,t,n,r){const o=e.clone(),i=1<<o.level,s=o.col+t,a=o.row+n;return r&&s<0?(o.col=s+i,o.world-=1):s>=i?(o.col=s-i,o.world+=1):o.col=s,o.row=a,o}}}]);
//# sourceMappingURL=9593.fe3accc1.js.map